'use strict';(v=>{const d=c=>{const b=(()=>{let f,g;const l=[];l.notify=a=>{l.forEach(k=>{k(a)})};const h=[];h._push=h.push;h.push=(...a)=>{h._push.apply(h,a);h.check()};h.check=()=>{if(void 0!==f){let a;for(;h.length;)if(a=h.shift(),void 0===a.state||a.state===f)g=("function"===typeof a.f?a.f.call(m,g):a.f)||g}};var m={promise:function(){return m},done:function(a){h.push({state:!0,f:a});return m},fail:function(a){h.push({state:!1,f:a});return m},always:function(a){h.push({f:a});return m},progress:function(a){l.push(a);
return m},then:function(a,k,r){return d(n=>{[{fn:"done",forward:"resolve",f:a},{fn:"fail",forward:"reject",f:k},{fn:"progress",forward:"notify",f:r}].forEach(p=>{m[p.fn]((...t)=>{const q="function"===typeof p.f,u=q?p.f(g):void 0;u&&"function"===typeof u.promise?u.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[p.forward].apply(n,q?[u]:t)})})}).promise()},each:function(a){return m.then((k,...r)=>{k instanceof Array||(k=[k,...r]);return d.when(k.map(n=>a(n)))})},iterate:function(a){return m.then((k,
...r)=>{k instanceof Array||(k=[k,...r]);let n=0;const p=d(),t=()=>{if(n<k.length){var q=k[n++];(q=a(q))&&q.promise?q.promise().done(t).fail(p.reject):t()}else p.resolve(k)};t();return p.promise()})}};return{get:function(){return m},try_resolve:function(a){void 0===f&&(f=!0,g=a);h.check();return m},try_reject:function(a){void 0===f&&(f=!1,g=a);h.check();return m},do_notify:function(a){l.notify(a)}}})(),e={promise:function(){return b.get()},resolve:function(){return b.try_resolve.apply(this,arguments)},
reject:function(){return b.try_reject.apply(this,arguments)},notify:function(){return b.do_notify.apply(this,arguments)},consume:function(f){f.promise().done(e.resolve).fail(e.reject).progress(e.notify);return e.promise()}};c&&c(e);return e};d.Pledge=c=>{const b=d();b.resolve(c);return b.promise()};d.Breach=c=>{const b=d();b.reject(c);return b.promise()};d.onebyone=c=>{let b=[];return c.reduce((e,f)=>{const g=d();e.always(()=>{f().done(l=>{b=b.concat(l instanceof Array?l:[l])}).fail(()=>{b=b.concat(null)}).always(g.resolve)});
return g.promise()},d.Pledge()).then(()=>b)};d.or=c=>{let b;const e=d(),f=()=>{c.length?(b=c.shift())&&d.Pledge().then(b).done(g=>{e.resolve(g)}).fail(f):e.reject()};f();return e.promise()};d.sidebyside=(c,...b)=>{c instanceof Array||(c=[c,...b]);const e=d();let f=c.length;f?c.forEach(g=>{g&&g.promise&&g.promise().always(()=>{0===--f&&e.resolve()})}):e.resolve();return e.promise()};d.when=(c,...b)=>{c instanceof Array||(c=[c,...b]);const e=d();let f=c.length;const g=[];f?c.forEach(l=>{l&&l.promise?
l.promise().fail(()=>{e.reject(g);f=-1}).done(h=>{g.push(h);0===--f&&e.resolve(g)}):console.warn("promise: incompatible object given to when()",l)}):e.resolve(g);return e.promise()};d.sleep=c=>{const b=d();window.setTimeout(b.resolve,c);return b.promise()};v.Registry?v.Registry.register("promise","e1582c36",()=>d):"undefined"!==typeof require?module.exports.Deferred=d:v.Deferred=d})("undefined"!==typeof window?window:global);
