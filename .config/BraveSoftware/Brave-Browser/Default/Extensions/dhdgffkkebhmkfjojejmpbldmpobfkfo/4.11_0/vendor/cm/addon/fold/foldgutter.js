'use strict';(function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror"),require("./foldcode")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","./foldcode"],e):e(CodeMirror)})(function(e){function w(a){this.options=a;this.from=this.to=0}function q(a,b){a=a.findMarks(f(b,0),f(b+1,0));for(var c=0;c<a.length;++c)if(a[c].__isFold&&a[c].find().from.line==b)return a[c]}function r(a){if("string"==typeof a){var b=document.createElement("div");b.className=
a+" CodeMirror-guttermarker-subtle";return b}return a.cloneNode(!0)}function g(a,b,c){var d=a.state.foldGutter.options,m=b,x=a.foldOption(d,"minFoldSize"),t=a.foldOption(d,"rangeFinder");a.eachLine(b,c,function(y){var n=null;if(q(a,m))n=r(d.indicatorFolded);else{var h=f(m,0);(h=t&&t(a,h))&&h.to.line-h.from.line>=x&&(n=r(d.indicatorOpen))}a.setGutterMarker(y,d.gutter,n);++m})}function p(a){var b=a.getViewport(),c=a.state.foldGutter;c&&(a.operation(function(){g(a,b.from,b.to)}),c.from=b.from,c.to=b.to)}
function u(a,b,c){var d=a.state.foldGutter;d&&(d=d.options,c==d.gutter&&((c=q(a,b))?c.clear():a.foldCode(f(b,0),d.rangeFinder)))}function k(a){var b=a.state.foldGutter;if(b){var c=b.options;b.from=b.to=0;clearTimeout(b.changeUpdate);b.changeUpdate=setTimeout(function(){p(a)},c.foldOnChangeTimeSpan||600)}}function v(a){var b=a.state.foldGutter;if(b){var c=b.options;clearTimeout(b.changeUpdate);b.changeUpdate=setTimeout(function(){var d=a.getViewport();b.from==b.to||20<d.from-b.to||20<b.from-d.to?p(a):
a.operation(function(){d.from<b.from&&(g(a,d.from,b.from),b.from=d.from);d.to>b.to&&(g(a,b.to,d.to),b.to=d.to)})},c.updateViewportTimeSpan||400)}}function l(a,b){var c=a.state.foldGutter;c&&(b=b.line,b>=c.from&&b<c.to&&g(a,b,b+1))}e.defineOption("foldGutter",!1,function(a,b,c){c&&c!=e.Init&&(a.clearGutter(a.state.foldGutter.options.gutter),a.state.foldGutter=null,a.off("gutterClick",u),a.off("change",k),a.off("viewportChange",v),a.off("fold",l),a.off("unfold",l),a.off("swapDoc",k));b&&(c=a.state,
!0===b&&(b={}),null==b.gutter&&(b.gutter="CodeMirror-foldgutter"),null==b.indicatorOpen&&(b.indicatorOpen="CodeMirror-foldgutter-open"),null==b.indicatorFolded&&(b.indicatorFolded="CodeMirror-foldgutter-folded"),c.foldGutter=new w(b),p(a),a.on("gutterClick",u),a.on("change",k),a.on("viewportChange",v),a.on("fold",l),a.on("unfold",l),a.on("swapDoc",k))});var f=e.Pos});
