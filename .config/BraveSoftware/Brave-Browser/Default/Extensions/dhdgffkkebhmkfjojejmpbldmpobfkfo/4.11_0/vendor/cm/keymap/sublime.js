'use strict';(function(l){"object"==typeof exports&&"object"==typeof module?l(require("../lib/codemirror"),require("../addon/search/searchcursor"),require("../addon/edit/matchbrackets")):"function"==typeof define&&define.amd?define(["../lib/codemirror","../addon/search/searchcursor","../addon/edit/matchbrackets"],l):l(CodeMirror)})(function(l){function y(a,b){a.extendSelectionsBy(function(c){if(a.display.shift||a.doc.extend||c.empty()){var d=a.doc;c=c.head;if(0>b&&0==c.ch)var e=d.clipPos(k(c.line-
1));else{var f=d.getLine(c.line);if(0<b&&c.ch>=f.length)e=d.clipPos(k(c.line+1,0));else{d="start";for(var g=c.ch,m=0>b?0:f.length,q=0;g!=m;g+=b,q++){var n=f.charAt(0>b?g-1:g),p="_"!=n&&l.isWordChar(n)?"w":"o";"w"==p&&n.toUpperCase()==n&&(p="W");if("start"==d)"o"!=p&&(d="in",e=p);else if("in"==d&&e!=p)if("w"==e&&"W"==p&&0>b&&g--,"W"==e&&"w"==p&&0<b)e="w";else break}e=k(c.line,g)}}return e}return 0>b?c.from():c.to()})}function z(a,b){if(a.isReadOnly())return l.Pass;a.operation(function(){for(var c=
a.listSelections().length,d=[],e=-1,f=0;f<c;f++){var g=a.listSelections()[f].head;g.line<=e||(e=k(g.line+(b?0:1),0),a.replaceRange("\n",e,null,"+insertLine"),a.indentLine(e.line,null,!0),d.push({head:e,anchor:e}),e=g.line+1)}a.setSelections(d)});a.execCommand("indentAuto")}function x(a,b){var c=b.ch,d=c;for(a=a.getLine(b.line);c&&l.isWordChar(a.charAt(c-1));)--c;for(;d<a.length&&l.isWordChar(a.charAt(d));)++d;return{from:k(b.line,c),to:k(b.line,d),word:a.slice(c,d)}}function A(a,b){for(var c=a.listSelections(),
d=[],e=0;e<c.length;e++){var f=c[e],g=a.findPosV(f.anchor,b,"line",f.anchor.goalColumn),m=a.findPosV(f.head,b,"line",f.head.goalColumn);g.goalColumn=null!=f.anchor.goalColumn?f.anchor.goalColumn:a.cursorCoords(f.anchor,"div").left;m.goalColumn=null!=f.head.goalColumn?f.head.goalColumn:a.cursorCoords(f.head,"div").left;g={anchor:g,head:m};d.push(f);d.push(g)}a.setSelections(d)}function B(a){for(var b=a.listSelections(),c=[],d=0;d<b.length;d++){var e=b[d],f=e.head,g=a.scanForBracket(f,-1);if(!g)return!1;
for(;;){f=a.scanForBracket(f,1);if(!f)return!1;if(f.ch=="(){}[]".charAt("(){}[]".indexOf(g.ch)+1)){var m=k(g.pos.line,g.pos.ch+1);if(0==l.cmpPos(m,e.from())&&0==l.cmpPos(f.pos,e.to())){if(g=a.scanForBracket(g.pos,-1),!g)return!1}else{c.push({anchor:m,head:f.pos});break}}f=k(f.pos.line,f.pos.ch+1)}}a.setSelections(c);return!0}function C(a,b){if(a.isReadOnly())return l.Pass;for(var c=a.listSelections(),d=[],e,f=0;f<c.length;f++){var g=c[f];if(!g.empty()){var m=g.from().line;for(g=g.to().line;f<c.length-
1&&c[f+1].from().line==g;)g=c[++f].to().line;c[f].to().ch||g--;d.push(m,g)}}d.length?e=!0:d.push(a.firstLine(),a.lastLine());a.operation(function(){for(var q=[],n=0;n<d.length;n+=2){var p=d[n+1],r=k(d[n],0),v=k(p),w=a.getRange(r,v,!1);b?w.sort():w.sort(function(u,t){var D=u.toUpperCase(),E=t.toUpperCase();D!=E&&(u=D,t=E);return u<t?-1:u==t?0:1});a.replaceRange(w,r,v);e&&q.push({anchor:r,head:k(p+1,0)})}e&&a.setSelections(q,0)})}function F(a,b){a.operation(function(){for(var c=a.listSelections(),d=
[],e=[],f=0;f<c.length;f++){var g=c[f];g.empty()?(d.push(f),e.push("")):e.push(b(a.getRange(g.from(),g.to())))}a.replaceSelections(e,"around","case");f=d.length-1;for(var m;0<=f;f--)g=c[d[f]],m&&0<l.cmpPos(g.head,m)||(e=x(a,g.head),m=e.from,a.replaceRange(b(e.word),e.from,e.to))})}function G(a){var b=a.getCursor("from"),c=a.getCursor("to");if(0==l.cmpPos(b,c)){var d=x(a,b);if(!d.word)return;b=d.from;c=d.to}return{from:b,to:c,query:a.getRange(b,c),word:d}}function H(a,b){var c=G(a);if(c){var d=c.query,
e=a.getSearchCursor(d,b?c.to:c.from);(b?e.findNext():e.findPrevious())?a.setSelection(e.from(),e.to()):(e=a.getSearchCursor(d,b?k(a.firstLine(),0):a.clipPos(k(a.lastLine()))),(b?e.findNext():e.findPrevious())?a.setSelection(e.from(),e.to()):c.word&&a.setSelection(c.from,c.to))}}var h=l.commands,k=l.Pos;h.goSubwordLeft=function(a){y(a,-1)};h.goSubwordRight=function(a){y(a,1)};h.scrollLineUp=function(a){var b=a.getScrollInfo();if(!a.somethingSelected()){var c=a.lineAtHeight(b.top+b.clientHeight,"local");
a.getCursor().line>=c&&a.execCommand("goLineUp")}a.scrollTo(null,b.top-a.defaultTextHeight())};h.scrollLineDown=function(a){var b=a.getScrollInfo();if(!a.somethingSelected()){var c=a.lineAtHeight(b.top,"local")+1;a.getCursor().line<=c&&a.execCommand("goLineDown")}a.scrollTo(null,b.top+a.defaultTextHeight())};h.splitSelectionByLine=function(a){for(var b=a.listSelections(),c=[],d=0;d<b.length;d++)for(var e=b[d].from(),f=b[d].to(),g=e.line;g<=f.line;++g)f.line>e.line&&g==f.line&&0==f.ch||c.push({anchor:g==
e.line?e:k(g,0),head:g==f.line?f:k(g)});a.setSelections(c,0)};h.singleSelectionTop=function(a){var b;if((b=a.listSelections())&&1<b.length)b=b[0],a.setSelection(b.anchor,b.head,{scroll:!1});else return l.Pass};h.selectLine=function(a){for(var b=a.listSelections(),c=[],d=0;d<b.length;d++){var e=b[d];c.push({anchor:k(e.from().line,0),head:k(e.to().line+1,0)})}a.setSelections(c)};h.insertLineAfter=function(a){return z(a,!1)};h.insertLineBefore=function(a){return z(a,!0)};h.selectNextOccurrence=function(a){var b=
a.getCursor("from"),c=a.getCursor("to"),d=a.state.sublimeFindFullWord==a.doc.sel;if(0==l.cmpPos(b,c)){d=x(a,b);if(!d.word)return;a.setSelection(d.from,d.to);d=!0}else{b=a.getRange(b,c);b=d?new RegExp("\\b"+b+"\\b"):b;c=a.getSearchCursor(b,c);var e=c.findNext();e||(c=a.getSearchCursor(b,k(a.firstLine(),0)),e=c.findNext());if(!(b=!e))a:{b=a.listSelections();e=c.from();for(var f=c.to(),g=0;g<b.length;g++)if(b[g].from()==e&&b[g].to()==f){b=!0;break a}b=!1}if(b)return l.Pass;a.addSelection(c.from(),c.to())}d&&
(a.state.sublimeFindFullWord=a.doc.sel)};h.addCursorToPrevLine=function(a){A(a,-1)};h.addCursorToNextLine=function(a){A(a,1)};h.selectScope=function(a){B(a)||a.execCommand("selectAll")};h.selectBetweenBrackets=function(a){if(!B(a))return l.Pass};h.goToBracket=function(a){a.extendSelectionsBy(function(b){var c=a.scanForBracket(b.head,1);return c&&0!=l.cmpPos(c.pos,b.head)?c.pos:(c=a.scanForBracket(b.head,-1))&&k(c.pos.line,c.pos.ch+1)||b.head})};h.swapLineUp=function(a){if(a.isReadOnly())return l.Pass;
for(var b=a.listSelections(),c=[],d=a.firstLine()-1,e=[],f=0;f<b.length;f++){var g=b[f],m=g.from().line-1,q=g.to().line;e.push({anchor:k(g.anchor.line-1,g.anchor.ch),head:k(g.head.line-1,g.head.ch)});0!=g.to().ch||g.empty()||--q;m>d?c.push(m,q):c.length&&(c[c.length-1]=q);d=q}a.operation(function(){for(var n=0;n<c.length;n+=2){var p=c[n],r=c[n+1],v=a.getLine(p);a.replaceRange("",k(p,0),k(p+1,0),"+swapLine");r>a.lastLine()?a.replaceRange("\n"+v,k(a.lastLine()),null,"+swapLine"):a.replaceRange(v+"\n",
k(r,0),null,"+swapLine")}a.setSelections(e);a.scrollIntoView()})};h.swapLineDown=function(a){if(a.isReadOnly())return l.Pass;for(var b=a.listSelections(),c=[],d=a.lastLine()+1,e=b.length-1;0<=e;e--){var f=b[e],g=f.to().line+1,m=f.from().line;0!=f.to().ch||f.empty()||g--;g<d?c.push(g,m):c.length&&(c[c.length-1]=m);d=m}a.operation(function(){for(var q=c.length-2;0<=q;q-=2){var n=c[q],p=c[q+1],r=a.getLine(n);n==a.lastLine()?a.replaceRange("",k(n-1),k(n),"+swapLine"):a.replaceRange("",k(n,0),k(n+1,0),
"+swapLine");a.replaceRange(r+"\n",k(p,0),null,"+swapLine")}a.scrollIntoView()})};h.toggleCommentIndented=function(a){a.toggleComment({indent:!0})};h.joinLines=function(a){for(var b=a.listSelections(),c=[],d=0;d<b.length;d++){for(var e=b[d],f=e.from(),g=f.line,m=e.to().line;d<b.length-1&&b[d+1].from().line==m;)m=b[++d].to().line;c.push({start:g,end:m,anchor:!e.empty()&&f})}a.operation(function(){for(var q=0,n=[],p=0;p<c.length;p++){for(var r=c[p],v=r.anchor&&k(r.anchor.line-q,r.anchor.ch),w,u=r.start;u<=
r.end;u++){var t=u-q;u==r.end&&(w=k(t,a.getLine(t).length+1));t<a.lastLine()&&(a.replaceRange(" ",k(t),k(t+1,/^\s*/.exec(a.getLine(t+1))[0].length)),++q)}n.push({anchor:v||w,head:w})}a.setSelections(n,0)})};h.duplicateLine=function(a){a.operation(function(){for(var b=a.listSelections().length,c=0;c<b;c++){var d=a.listSelections()[c];d.empty()?a.replaceRange(a.getLine(d.head.line)+"\n",k(d.head.line,0)):a.replaceRange(a.getRange(d.from(),d.to()),d.from())}a.scrollIntoView()})};h.sortLines=function(a){C(a,
!0)};h.sortLinesInsensitive=function(a){C(a,!1)};h.smartBackspace=function(a){if(a.somethingSelected())return l.Pass;a.operation(function(){for(var b=a.listSelections(),c=a.getOption("indentUnit"),d=b.length-1;0<=d;d--){var e=b[d].head,f=a.getRange({line:e.line,ch:0},e),g=l.countColumn(f,null,a.getOption("tabSize")),m=a.findPosH(e,-1,"char",!1);f&&!/\S/.test(f)&&0==g%c&&(f=new k(e.line,l.findColumn(f,g-c,c)),f.ch!=e.ch&&(m=f));a.replaceRange("",m,e,"+delete")}})};h.delLineRight=function(a){a.operation(function(){for(var b=
a.listSelections(),c=b.length-1;0<=c;c--)a.replaceRange("",b[c].anchor,k(b[c].to().line),"+delete");a.scrollIntoView()})};h.upcaseAtCursor=function(a){F(a,function(b){return b.toUpperCase()})};h.downcaseAtCursor=function(a){F(a,function(b){return b.toLowerCase()})};h.setSublimeMark=function(a){a.state.sublimeMark&&a.state.sublimeMark.clear();a.state.sublimeMark=a.setBookmark(a.getCursor())};h.selectToSublimeMark=function(a){var b=a.state.sublimeMark&&a.state.sublimeMark.find();b&&a.setSelection(a.getCursor(),
b)};h.deleteToSublimeMark=function(a){var b=a.state.sublimeMark&&a.state.sublimeMark.find();if(b){var c=a.getCursor();if(0<l.cmpPos(c,b)){var d=b;b=c;c=d}a.state.sublimeKilled=a.getRange(c,b);a.replaceRange("",c,b)}};h.swapWithSublimeMark=function(a){var b=a.state.sublimeMark&&a.state.sublimeMark.find();b&&(a.state.sublimeMark.clear(),a.state.sublimeMark=a.setBookmark(a.getCursor()),a.setCursor(b))};h.sublimeYank=function(a){null!=a.state.sublimeKilled&&a.replaceSelection(a.state.sublimeKilled,null,
"paste")};h.showInCenter=function(a){var b=a.cursorCoords(null,"local");a.scrollTo(null,(b.top+b.bottom)/2-a.getScrollInfo().clientHeight/2)};h.findUnder=function(a){H(a,!0)};h.findUnderPrevious=function(a){H(a,!1)};h.findAllUnder=function(a){var b=G(a);if(b){for(var c=a.getSearchCursor(b.query),d=[],e=-1;c.findNext();)d.push({anchor:c.from(),head:c.to()}),c.from().line<=b.from.line&&c.from().ch<=b.from.ch&&e++;a.setSelections(d,e)}};h=l.keyMap;h.macSublime={"Cmd-Left":"goLineStartSmart","Shift-Tab":"indentLess",
"Shift-Ctrl-K":"deleteLine","Alt-Q":"wrapLines","Ctrl-Left":"goSubwordLeft","Ctrl-Right":"goSubwordRight","Ctrl-Alt-Up":"scrollLineUp","Ctrl-Alt-Down":"scrollLineDown","Cmd-L":"selectLine","Shift-Cmd-L":"splitSelectionByLine",Esc:"singleSelectionTop","Cmd-Enter":"insertLineAfter","Shift-Cmd-Enter":"insertLineBefore","Cmd-D":"selectNextOccurrence","Shift-Cmd-Space":"selectScope","Shift-Cmd-M":"selectBetweenBrackets","Cmd-M":"goToBracket","Cmd-Ctrl-Up":"swapLineUp","Cmd-Ctrl-Down":"swapLineDown","Cmd-/":"toggleCommentIndented",
"Cmd-J":"joinLines","Shift-Cmd-D":"duplicateLine",F9:"sortLines","Cmd-F9":"sortLinesInsensitive",F2:"nextBookmark","Shift-F2":"prevBookmark","Cmd-F2":"toggleBookmark","Shift-Cmd-F2":"clearBookmarks","Alt-F2":"selectBookmarks",Backspace:"smartBackspace","Cmd-K Cmd-K":"delLineRight","Cmd-K Cmd-U":"upcaseAtCursor","Cmd-K Cmd-L":"downcaseAtCursor","Cmd-K Cmd-Space":"setSublimeMark","Cmd-K Cmd-A":"selectToSublimeMark","Cmd-K Cmd-W":"deleteToSublimeMark","Cmd-K Cmd-X":"swapWithSublimeMark","Cmd-K Cmd-Y":"sublimeYank",
"Cmd-K Cmd-C":"showInCenter","Cmd-K Cmd-G":"clearBookmarks","Cmd-K Cmd-Backspace":"delLineLeft","Cmd-K Cmd-0":"unfoldAll","Cmd-K Cmd-J":"unfoldAll","Ctrl-Shift-Up":"addCursorToPrevLine","Ctrl-Shift-Down":"addCursorToNextLine","Cmd-F3":"findUnder","Shift-Cmd-F3":"findUnderPrevious","Alt-F3":"findAllUnder","Shift-Cmd-[":"fold","Shift-Cmd-]":"unfold","Cmd-I":"findIncremental","Shift-Cmd-I":"findIncrementalReverse","Cmd-H":"replace",F3:"findNext","Shift-F3":"findPrev",fallthrough:"macDefault"};l.normalizeKeyMap(h.macSublime);
h.pcSublime={"Shift-Tab":"indentLess","Shift-Ctrl-K":"deleteLine","Alt-Q":"wrapLines","Ctrl-T":"transposeChars","Alt-Left":"goSubwordLeft","Alt-Right":"goSubwordRight","Ctrl-Up":"scrollLineUp","Ctrl-Down":"scrollLineDown","Ctrl-L":"selectLine","Shift-Ctrl-L":"splitSelectionByLine",Esc:"singleSelectionTop","Ctrl-Enter":"insertLineAfter","Shift-Ctrl-Enter":"insertLineBefore","Ctrl-D":"selectNextOccurrence","Shift-Ctrl-Space":"selectScope","Shift-Ctrl-M":"selectBetweenBrackets","Ctrl-M":"goToBracket",
"Shift-Ctrl-Up":"swapLineUp","Shift-Ctrl-Down":"swapLineDown","Ctrl-/":"toggleCommentIndented","Ctrl-J":"joinLines","Shift-Ctrl-D":"duplicateLine",F9:"sortLines","Ctrl-F9":"sortLinesInsensitive",F2:"nextBookmark","Shift-F2":"prevBookmark","Ctrl-F2":"toggleBookmark","Shift-Ctrl-F2":"clearBookmarks","Alt-F2":"selectBookmarks",Backspace:"smartBackspace","Ctrl-K Ctrl-K":"delLineRight","Ctrl-K Ctrl-U":"upcaseAtCursor","Ctrl-K Ctrl-L":"downcaseAtCursor","Ctrl-K Ctrl-Space":"setSublimeMark","Ctrl-K Ctrl-A":"selectToSublimeMark",
"Ctrl-K Ctrl-W":"deleteToSublimeMark","Ctrl-K Ctrl-X":"swapWithSublimeMark","Ctrl-K Ctrl-Y":"sublimeYank","Ctrl-K Ctrl-C":"showInCenter","Ctrl-K Ctrl-G":"clearBookmarks","Ctrl-K Ctrl-Backspace":"delLineLeft","Ctrl-K Ctrl-0":"unfoldAll","Ctrl-K Ctrl-1":"foldAll","Ctrl-K Ctrl-J":"unfoldAll","Ctrl-Alt-Up":"addCursorToPrevLine","Ctrl-Alt-Down":"addCursorToNextLine","Ctrl-F3":"findUnder","Shift-Ctrl-F3":"findUnderPrevious","Alt-F3":"findAllUnder","Shift-Ctrl-[":"fold","Shift-Ctrl-]":"unfold","Ctrl-I":"findIncremental",
"Shift-Ctrl-I":"findIncrementalReverse","Ctrl-H":"replace",F3:"findNext","Shift-F3":"findPrev",fallthrough:"pcDefault"};l.normalizeKeyMap(h.pcSublime);h.sublime=h.default==h.macDefault?h.macSublime:h.pcSublime});
