(function(k){"object"==typeof exports&&"object"==typeof module?k(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],k):k(CodeMirror)})(function(k){function t(a,c,b){var f=a.getLineHandle(c.line),d=c.ch-1,g=b&&b.afterCursor;null==g&&(g=/(^| )cm-fat-cursor($| )/.test(a.getWrapperElement().className));f=!g&&0<=d&&r[f.text.charAt(d)]||r[f.text.charAt(++d)];if(!f)return null;g=">"==f.charAt(1)?1:-1;if(b&&b.strict&&0<g!=(d==c.ch))return null;var h=a.getTokenTypeAt(n(c.line,
d+1));a=u(a,n(c.line,d+(0<g?1:0)),g,h||null,b);return null==a?null:{from:n(c.line,d),to:a&&a.pos,match:a&&a.ch==f.charAt(0),forward:0<g}}function u(a,c,b,f,d){var g=d&&d.maxScanLineLength||1E4,h=d&&d.maxScanLines||1E3,e=[];d=d&&d.bracketRegex?d.bracketRegex:/[(){}[\]]/;h=0<b?Math.min(c.line+h,a.lastLine()+1):Math.max(a.firstLine()-1,c.line-h);for(var l=c.line;l!=h;l+=b){var m=a.getLine(l);if(m){var p=0<b?0:m.length-1,x=0<b?m.length:-1;if(!(m.length>g))for(l==c.line&&(p=c.ch-(0>b?1:0));p!=x;p+=b){var q=
m.charAt(p);if(d.test(q)&&(void 0===f||a.getTokenTypeAt(n(l,p+1))==f))if(">"==r[q].charAt(1)==0<b)e.push(q);else if(e.length)e.pop();else return{pos:n(l,p),ch:q}}}}return l-b==(0<b?a.lastLine():a.firstLine())?!1:null}function v(a,c,b){for(var f=a.state.matchBrackets.maxHighlightLineLength||1E3,d=[],g=a.listSelections(),h=0;h<g.length;h++){var e=g[h].empty()&&t(a,g[h].head,b);if(e&&a.getLine(e.from.line).length<=f){var l=e.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";d.push(a.markText(e.from,
n(e.from.line,e.from.ch+1),{className:l}));e.to&&a.getLine(e.to.line).length<=f&&d.push(a.markText(e.to,n(e.to.line,e.to.ch+1),{className:l}))}}if(d.length)if(y&&a.state.focused&&a.focus(),b=function(){a.operation(function(){for(var m=0;m<d.length;m++)d[m].clear()})},c)setTimeout(b,800);else return b}function w(a){a.operation(function(){a.state.matchBrackets.currentlyHighlighted&&(a.state.matchBrackets.currentlyHighlighted(),a.state.matchBrackets.currentlyHighlighted=null);a.state.matchBrackets.currentlyHighlighted=
v(a,!1,a.state.matchBrackets)})}var y=/MSIE \d/.test(navigator.userAgent)&&(null==document.documentMode||8>document.documentMode),n=k.Pos,r={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"};k.defineOption("matchBrackets",!1,function(a,c,b){b&&b!=k.Init&&(a.off("cursorActivity",w),a.state.matchBrackets&&a.state.matchBrackets.currentlyHighlighted&&(a.state.matchBrackets.currentlyHighlighted(),a.state.matchBrackets.currentlyHighlighted=null));c&&(a.state.matchBrackets="object"==typeof c?c:{},a.on("cursorActivity",
w))});k.defineExtension("matchBrackets",function(){v(this,!0)});k.defineExtension("findMatchingBracket",function(a,c,b){if(b||"boolean"==typeof c)b?(b.strict=c,c=b):c=c?{strict:!0}:null;return t(this,a,c)});k.defineExtension("scanForBracket",function(a,c,b,f){return u(this,a,c,b,f)})});
