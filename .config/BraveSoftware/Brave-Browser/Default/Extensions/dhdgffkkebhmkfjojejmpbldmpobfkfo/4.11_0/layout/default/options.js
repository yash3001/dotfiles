'use strict';window.requestFileSystem||(window.requestFileSystem=window.webkitRequestFileSystem);
Registry.require("promise layout convert xmlhttprequest crcrc curtain tools layout/default/tabview layout/default/htmlutil helper statistics i18n syncinfo uri layout/default/layout_helper porter parser hinter cloud".split(" "),()=>{const X=rea.FEATURES,Z=Registry.get("promise"),K=Registry.get("crcrc").cr,p=Registry.get("crcrc").crc,eb=Registry.get("layout/default/tabview"),z=Registry.get("layout/default/htmlutil"),Bb=Registry.get("statistics"),Aa=Registry.get("syncinfo"),Ha=Registry.get("convert"),
Ta=Registry.get("tools"),F=Registry.get("curtain"),d=Registry.get("i18n"),G=Registry.get("helper"),Ma=Registry.get("uri"),va=Registry.get("porter"),fb=window.Hinter=Registry.get("hinter"),Cb=Registry.get("parser"),gb=Registry.get("layout"),Ia=Registry.get("layout/default/layout_helper"),T=Ia.images,hb=Registry.get("cloud"),Ua=Ta.cache;let Va;gb.render(()=>{const Na={};let L={};const fa=[];let ib="0.0.0";const ta={},jb={};let ra={};const ba=(()=>{let a;let b,e,c;if(a=X.HTML5.LOCALSTORAGE){var g=a.getItem("export_tm_settings");
b="true"===g;g=a.getItem("export_externals");e="false"!==g;g=a.getItem("export_script_storage");c="false"!==g;if(g=a.getItem("cloud_config"))try{g=JSON.parse(Ha.Base64.decode(g))}catch(m){}}return{script_storage:c,add_tm_settings:b,include_externals:e,cloud_config:g}})();let ia;const R={},ja=function(a,b){let e,c;if((e=R[a])&&(c=e[b]))return c.apply(this,Array.prototype.slice.call(arguments,2))},Ja=a=>{var b=a.msg||a;if(a.once){if(jb[b])return!0;jb[b]=!0}b=confirm(b);let e={};b&&a.ok?e=a.ok:!b&&a.cancel&&
(e=a.cancel);if(a.ok||a.cancel)b=!0;e.url&&sendMessage({method:"newTab",url:e.url},()=>{});return b},Oa=(a,b)=>{try{const e=()=>{b&&X.OPTIONPAGE.CLOSE_ALLOWED&&window.close()};b?sendMessage({method:"newTab",url:a},e):rea.tabs.getSelected(null,c=>{rea.tabs.sendMessage(c.id,{method:"loadUrl",url:a,newtab:b},e)})}catch(e){console.log("lU: "+e.message)}};let kb=!1;const lb=a=>{if(!kb){var b=d.getLocale(),e=$("<div>").hide(),c=f=>{f?(e.html(""),e.append($('<div class="contrib_iframe" style="font-size: 2.5em;"></div>').append($('<div style="padding-top: 150px;">').text(f))),
window.setTimeout(c,1E3)):(e.fadeOut(1E3),window.setTimeout(F.hideDialog,1E3))};a=$('<iframe src="https://www.tampermonkey.net/contrib.php?embedded=2'+(b?"&locale="+b:"")+"&src="+(a||"e")+'" class="contrib_iframe"></iframe>');var g=[$('<button class="contrib_button">').html(d.getMessage("Remind_me_later")).click(()=>{Ba("later");c(d.getMessage("Ok"))}),$('<button class="contrib_button">').html(d.getMessage("I_contributed_already")).click(()=>{Ba("contributed");c(d.getMessage("Thank_you_very_much_"))}),
$('<button class="contrib_button">').html(d.getMessage("I_dont_want_to_contribute")).click(()=>{Ba("hide");c(d.getMessage("Ok"))})],m=()=>{h&&window.clearTimeout(h);g.forEach(f=>{f.prop("disabled",!1)})};g.forEach(f=>{f.prop("disabled",!0)});e.append(a,g);a.bind("load",m);var h=window.setTimeout(()=>{h=null;m()},15E3),k=()=>{const f=F.dialog(e[0]);!0===f?(e.fadeIn(1E3),Ba("dialog")):void 0===f&&window.setTimeout(k,500);kb=!0};k();window.addEventListener("message",f=>{const u=f.data.clicked||f.data.type;
var l=f.data.amount;var n=f.data.currency;const w=f.data.redirect_url;u&&(w&&Oa(w,!0),f.data.success?(l=$(".contrib_iframe"),n=l.data("oheight"),!n||0>n||1E3<n||(l.animate({height:n},1E3),Ba("contributed",u,{id:f.data.id}))):f.data.clicked&&(Ba("clicked",u,{amount:l||"?",currency:n||"?"}),$(".contrib_button").remove(),e.append($('<button class="contrib_button">').html(d.getMessage("Ok")).click(()=>{c()})),f.data.enlarge&&(l=$(".contrib_iframe"),l.data("oheight",l.height()),l.animate({height:740},
1E3))))},!1)}},wa=()=>{if(X.HTML5.LOCALSTORAGE)return X.HTML5.LOCALSTORAGE.getItem("sort_key")},Ca=()=>{if(X.HTML5.LOCALSTORAGE)return X.HTML5.LOCALSTORAGE.getItem("sort_sequence")},mb=a=>{if(X.HTML5.LOCALSTORAGE)return X.HTML5.LOCALSTORAGE.setItem("sort_key",a)},nb=a=>{if(X.HTML5.LOCALSTORAGE)return X.HTML5.LOCALSTORAGE.setItem("sort_sequence",a)},ob=a=>{const b=(k,f)=>k.tagName==f?k:k.parentNode?b(k.parentNode,f):null;let e="down"==Ca(),c=null,g=[],m=0;const h=Date.now();Object.keys(ra).forEach(k=>
{const f=ra[k];if(f)if(k=b(f.dom,"TR")){const u=b(k,"TBODY");c?u&&c!=u&&console.warn("options: different parents?!?!"):c=u;m++;let l,n;if(!(l=f.script.lastModified||f.script.lastUpdated)||(n=h-parseInt(l))&&isNaN(n))n=0;g.push({tr:k,sites:Wa.get(f.script),enabled:f.script.enabled,position:f.script.position?f.script.position:1E3+m,name:d.getTranslation(f.script,"name").toLowerCase(),homepage:[f.script.origin?Ma.parse(f.script.origin.url).hostname:"z",Xa(f.script)?Ma.parse(Xa(f.script)).hostname:"z"].join("_"),
updated:n,version:f.script.version||""});k.inserted=!1;k.parentNode&&k.parentNode.removeChild(k)}else console.log("options: unable to sort script at pos "+f.pos);else console.warn("options: something went wrong!",k)});g=(k=>{var f=q=>(x,r)=>x[q]-r[q];const u=q=>(x,r)=>Cb.versionCmp(String(x[q]),String(r[q])),l=q=>(x,r)=>x[q]<r[q]?-1:x[q]>r[q]?1:0,n=(q,x)=>(r,v)=>{r=(x^r[q]?"a":"b")+r.name;v=(x^v[q]?"a":"b")+v.name;return r<v?-1:r>v?1:0},w=wa();"pos"==w?f=f("position"):"enabled"==w?(f=n("enabled",
e),e=null):f="ver"==w?u("version"):"updated"==w?f("updated"):l(w);k.sort(f);return k})(g);e&&(g=g.reverse());for(let k=0;k<m;k++)c.appendChild(g[k].tr);$(".sorting").each((k,f)=>{k=$(f);f="pos"==wa()&&"up"==Ca();k[f?"fadeIn":"fadeOut"]()});a&&a()};Ua.create("sites").setOptions({timeout:600,check_interval:300,retimeout_on_get:!0}).init();const Wa=(()=>{let a={};const b=c=>7>c.toString().length?b("0"+c):c,e=c=>{if(c.includes||c.matches){const g={},m=[],h=c.includes.length?c.includes:c.matches;for(let k=
0;k<h.length;k++){const f=h[k];if(!f){console.log("o: Warn: script '"+c.name+"' has invalid include (index: "+k+")");continue}const u=Ua.items.sites.get(f),l=(void 0!==u?u:null)||z.getInfoFromUrl(f);void 0===u&&Ua.items.sites.set(f,l);l&&l.dom?g[l.dom]||(g[l.dom]=!0,m.push({include:f,info:l})):m.push({include:f})}return m}};return{init:function(c){a={};c.forEach(g=>{(g=e(g))&&g.length&&g.forEach(m=>{m.info&&(a[m.info.dom]=(a[m.info.dom]||0)+1)})})},get:function(c){c=e(c);if(!c||!c.length)return b(0);
c=G.map(c,g=>g.info?{score:1E3*a[g.info.dom]+g.info.dom.charCodeAt(0)||0,dom:g.info.dom}:{score:0,dom:""}).sort((g,m)=>m.score-g.score)[0];return b(c.score)+c.dom},topIcons:function(c,g){let m;const h=[];var k=e(c);if(!k||!k.length)return[];k=G.map(k,f=>{f.score=f.info?a[f.info.dom]||0:0;return f}).sort((f,u)=>u.score-f.score);G.each(k,f=>{var u=f.info;if(0==g--)return f=p("span","",c.uuid,"tbc"),f.textContent="...",h.push(f),!1;if(u){if("*"==u.tld)return m=z.createIcon(T.get("web"),"web",c.uuid,
f.include,f.include),h.push(m),!1;var l="com",n="";"*"!=u.tld&&"tld"!=u.tld&&(l=u.tld);u.subdom.length&&(n=u.subdom.join(".")+".");l=(n+u.dom+"."+l).replace(/\*/g,"");n="http://"+l+"/";u=X.RUNTIME.CHROME?"chrome://favicon/"+n:null;l=0==n.indexOf("http://userscripts.org/")||0==n.indexOf("http://userscripts.com/")?T.origin("uso"):"native"==L.favicon_service?n+"favicon.ico":"duckduckgo"==L.favicon_service?"https://icons.duckduckgo.com/ip2/"+encodeURIComponent(l)+".ico":"https://www.google.com/s2/favicons?domain="+
encodeURIComponent(l);m=z.createFavicon([l,u,()=>T.get("question_mark")].filter(w=>w),"favicon",c.uuid,f.include,f.include)}else m=z.createIcon(T.get("question_mark"),"favicon",c.uuid,f.include,f.include);h.push(m)});return h}}})();let Da=null;const la=()=>{Da&&(window.clearTimeout(Da),Da=null)},Ya=a=>{let b;const e=a.key||"general";(b=pb[e])&&$(b).remove();pb[e]=z.createGobalHint(a,$("body > div.status")[0])},Za=(a,b,e,c)=>{void 0===c&&(c=3E3);Ya({key:"success",text:a,image:b,class:e,delay:500,timeout:c,
done:function(){}})},ka=()=>{Za(d.getMessage("Operation_completed_successfully"),"button_ok","notice")},qb=(a,b)=>{void 0===b&&(b="button_ok");Za(a,b,"information",8E3)},xa=(a,b)=>{void 0===b&&(b="error");Za(a,b,"warning",8E3)},ma=a=>{Da||(Da=window.setTimeout(()=>{Da=null;F.wait(d.getMessage("Please_wait___"))},a||500))};let Ka=null,Ea=null;const oa=(a,b)=>{null!=Ka?(window.clearTimeout(Ka),Ka=null,oa(a?a:Ea.items,a?b:Ea.with_scripts)):(Ea={items:a,with_scripts:b},Ka=window.setTimeout(()=>{Ka=null;
Ea.with_scripts&&(ra={});Pa(null,Ea.items,null,ia);F.hide();$a();Ea=null},50))},Db=a=>{const b=Z();sendMessage({method:"determineScriptsToRun",url:a},e=>{b.resolve(e.scripts||[])});return b.promise()},Ba=(a,b,e)=>{const c=Z();sendMessage({method:"begEvent",action:a,type:b,extra:e},g=>{c.resolve(g)});return c.promise()},rb=(a,b)=>{const e=Z();try{ma(),sendMessage({method:"installScript",url:a.url,code:a.code,reload:b.reload},c=>{la();c.items?(ka(),oa(c.items,!1)):F.hide();c.err?e.reject(c):e.resolve(c)})}catch(c){console.log("sS: "+
c.message),e.reject({err:c.message})}return e.promise()},Eb=(a,b)=>{const e=[];let c=Z(),g;const m=h=>{c&&(h&&c.reject(),g&&g.disconnect(),c=null)};try{ma(),g=rea.extension.connect("exportToJson"),g.onMessage.addListener(h=>{if(c)if(h.partial&&e.push(h.partial),h.done){h=e.join("");let k;try{k=JSON.parse(h)}catch(f){}la();F.hide();k?c.resolve(k):c.reject();m()}else h.error&&m(!0)}),g.onDisconnect.addListener(()=>{m(!0)}),g.postMessage({method:"exportToJson",ids:a,options:b})}catch(h){console.log("eJ: "+
h.message),m(!0)}return c.promise()},ab=(a,b)=>{const e=Z();try{ma(),sendMessage({method:"importFromJson",json:a,reload:b.reload},c=>{la();c.reload?window.setTimeout(()=>{rea.page.reload()},500):c.items?(ka(),oa(c.items,!0)):F.hide();c.err?e.reject(c):e.resolve(c)})}catch(c){console.log("sS: "+c.message),e.reject({err:c.message})}return e.promise()},Fb=(a,b,e)=>{const c=Z();try{e.auto_save||ma(),sendMessage({method:"saveExternal",uuid:a,code:b,mimetype:e.mimetype,url:e.url,auto_save:e.auto_save},
g=>{e.auto_save||(ka(),la());g=g||{};g.items?oa(g.items,!0):F.hide();c.resolve(g)})}catch(g){console.log("sS: "+g.message),c.reject({err:g.message})}return c.promise()},bb=(a,b,e)=>{const c=Z();void 0===e.reload&&(e.reload=!0);try{e.auto_save||ma(),sendMessage({method:"saveScript",uuid:a,code:b,clean:e.clean,force:e.force,new_script:e.new_script,auto_save:e.auto_save,lastModTime:e.lastModTime,reload:e.reload},g=>{e.auto_save||(ka(),la());g=g||{};g.items?oa(g.items,!0):F.hide();!b&&e.reload&&F.hide();
c.resolve(g)})}catch(g){console.log("sS: "+g.message),c.reject({err:g.message})}return c.promise()},Qa=(a,b,e)=>{const c=Z();try{ma(),sendMessage({method:"setOption",name:a,value:b},g=>{la();ka();L=g.options||L;!e&&g.items?oa(g.items,!1):F.hide();c.resolve(g)})}catch(g){console.log("sO: "+g.message),c.reject({err:g.message})}return c.promise()},Gb=(a,b,e)=>{const c=Z();try{ma(),sendMessage({method:"buttonPress",name:a,data:b},g=>{la();!e&&g.items?(ka(),oa(g.items,!1)):F.hide();c.resolve(g)})}catch(g){console.log("sO: "+
g.message),c.reject({err:g.message})}return c.promise()},Fa=(a,b)=>{ma();sendMessage({method:"loadTree",complete:a.complete,uuid:a.uuid,url:a.url,referrer:a.referrer,layout:a.layout,filter:a.filter},e=>{la();e.items||(e.error?alert(e.error):confirm(d.getOriginalMessage("An_internal_error_occured_Do_you_want_to_visit_the_forum_"))&&(window.location.href="https://www.tampermonkey.net/bug"));b(e)})},Hb=(a,b,e)=>{Fa({referrer:"options.scripts.userscripts.matches",uuid:a,filter:b},c=>{F.hide();e(c.items)})},
sb=()=>{Fa({referrer:"options.scripts"},a=>{a.items?oa(a.items,!0):F.hide()})},ya=(a,b,e)=>{void 0==e&&(e=!0);try{a={method:"modifyScriptOptions",uuid:a,reload:e};for(const c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);ma();sendMessage(a,c=>{la();L=c.options||L;c.i18n&&d.setLocale(c.i18n);ka();c.items?oa(c.items,!0):F.hide()})}catch(c){console.log("mSo: "+c.message)}},tb=(a,b,e)=>{try{a={method:"saveStorageKey",uuid:a,key:b,value:e,id:"options"},ma(),sendMessage(a,()=>{la();ka();F.hide()})}catch(c){console.log("sSk: "+
c.message)}},ub=(a,b,e)=>{try{a={method:"download",details:{url:a,name:b,saveAs:!0},id:"options"},ma(),sendMessage(a,c=>{la();c.load?ka():c.error&&xa(d.getMessage("Action_failed"));F.hide();e&&e()})}catch(c){console.log("dDU: "+c.message)}},Ib=(a,b)=>{try{ma(),sendMessage({method:"buttonPress",name:"externals_delete",scriptuid:a,safe_url:b},e=>{la();ka();e.items?oa(e.items,!1):F.hide()})}catch(e){console.log("dEx: "+e.message)}},Jb=(a,b)=>{try{sendMessage({method:"buttonPress",name:"run_script_updates",
scriptuid:a},e=>{ka();b&&b(e.updatable)})}catch(e){console.log("rSu: "+e.message)}},Kb=(a,b,e)=>{try{sendMessage({method:"reportAnIssue",uuid:a,to:b},()=>{e&&e()})}catch(c){console.log("rRi: "+c.message)}},Ga=window.navigator.userAgent.includes("Mac")?"mac":"other";window.addEventListener("keydown",a=>{let b=!1;if("keydown"==a.type&&!a.defaultPrevented){if(27==a.keyCode){var e=ia.getTabById("dashboard");if(!e.isSelected())return;if(a.target&&"text"==a.target.type){$(a.target).blur();return}R.multiselect.toggleRow(!1);
b=!0}else if(("mac"!=Ga&&39==a.keyCode||"mac"==Ga&&40==a.keyCode)&&!a.ctrlKey&&a.altKey&&!a.shiftKey){if(e=ia.getNextTab())e.select(),b=!0}else("mac"!=Ga&&37==a.keyCode||"mac"==Ga&&38==a.keyCode)&&!a.ctrlKey&&a.altKey&&!a.shiftKey&&(e=ia.getPreviousTab())&&(e.select(),b=!0);if(b)return a.stopPropagation(),a.preventDefault(),!1}},!0);window.addEventListener("keydown",a=>{var b;let e=!1;if("keydown"==a.type&&!a.defaultPrevented){if(112==a.keyCode)(b=ia.getTabById("help"))&&b.select(),e=!0;else if((38==
a.keyCode||40==a.keyCode)&&a.shiftKey){b=ia.getTabById("dashboard");if(!b.isSelected())return;if((b=pa.length&&pa[pa.length-1])&&(b=$(b))){e=!0;var c=b.closest("tr");if(c.length){if(38==a.keyCode){c=c.prevAll("tr:visible:first");var g=!0}else c=c.nextAll("tr:visible:first"),g=!1;if(c.length){var m=c.find('input[name="scriptselectors"]');if(pa.includes(m[0])){pa.pop();b.prop("checked",!1);b.removeClass("selected");var h=b}else m.length&&(m.prop("checked",!0),m.addClass("selected"),pa.push(m[0]),void 0===
pa.direction&&(pa.direction=g),h=m);h&&(z.isScrolledIntoView(c,{padding:100})||$("html, body").animate({scrollTop:g?c.offset().top-100-c.height():c.offset().top-$(window).height()+100+2*c.height()},0),R.multiselect.single_click())}}}}else if(70==a.keyCode&&(a.ctrlKey||a.metaKey)){b=ia.getTabById("dashboard");if(!b.isSelected())return;R.multiselect.toggleRow(!0,!0);e=!0}else if(65==a.keyCode&&(a.ctrlKey||a.metaKey)){b=ia.getTabById("dashboard");if(!b.isSelected()||a.target&&"text"==a.target.type)return;
R.multiselect.un_selectAll(!0);e=!0}if(e)return a.stopPropagation(),a.preventDefault(),!1}},!1);let ua;const da=(()=>{const a={},b=()=>{ua=G.getUrlArgs(!0);Object.keys(a).forEach(h=>{h=a[h];g.is(h.main,h.sub)&&h.fn()})};b();let e;window.onhashchange=function(){e||b.apply(this,arguments)};const c=h=>{e=!0;h();e=!1},g={set:function(h){const k=g.get();let f;f="object"===typeof h?[h.main,h.sub].filter(u=>u):arguments;if(k.main!==f[0]||k.sub!==f[1])!f[0]&&f[1]?g.setSub(f[1]):c(()=>{window.location.hash=
"nav="+Array.prototype.join.call(f,"+");b()})},setSub:function(h){const k=g.get();k.sub!==h&&c(()=>{window.location.hash="nav="+(k.main?k.main:"")+"+"+h;b()})},get:function(){const h=ua.nav?ua.nav.split("+"):[];return{main:h[0],sub:h[1]}},is:function(h,k){const f=g.get();k=!k||f.sub===k;return(!h||f.main===h)&&k},isSub:function(h){return g.is(null,h)},registerListener:function(h,k,f){void 0===f&&(f=k,k=null);const u=[h,k].join("+");a[u]={main:h,sub:k,fn:f};g.is(h,k)&&f();return u},unregisterListener:function(h){delete a[h]},
clear:function(){g.set("")}},m=g.get();fa.push(()=>{var h=ia.getTabById(m.main);if(h)return h.select(!0);if(m.main)(h=ia.getTabById("dashboard"))&&h.select(!0),fa.push(()=>{window.setTimeout(()=>{g.set(m)},1)});else window.onhashchange()});return g})();(()=>{fa.push(()=>{L.statistics_enabled&&Bb.init("opt",rea.extension.manifest.version,!0,!1,!0)})})();const cb=G.getDebouncer(1E3),$a=()=>{for(;fa.length;)try{fa.shift()()}catch(a){console.warn("doneListeners:",a)}},Lb=(a,b)=>{const e=K("input",a.name,
a.id,"Save");e.inserted||(e.type="button",e.section=a,e.disabled=!0,e.value=d.getMessage("Save"),e.addEventListener("click",function(){if(!b||!b.warning||Ja(b.warning)){var c=$(this.section).find("input, select, textarea").toArray(),g=[],m=[];for(let k=0;k<c.length;k++){let f=null;var h=c[k];const u=h.key;if(!m.includes(h)){if("textarea"==h.tagName.toLowerCase())if(h.named)h=document.getElementsByName(h.name),f=[],G.each(h,l=>{f.push({name:l.named_name,value:l.value});m.push(l)});else if(h.array)f=
h.value.split("\n").map(l=>l.trim()).filter(l=>l);else if(h.json){let l;try{f=(l=h.value)&&(l=l.trim())?JSON.parse(l):null}catch(n){G.alert(d.getMessage("Unable_to_parse_0name0",h.name));return}}else f=h.value;else if("checkbox"==h.getAttribute("type"))f=h.checked;else if("select"==h.getAttribute("type")){let l=0;0<=h.selectedIndex&&h.selectedIndex<h.options.length&&(l=h.selectedIndex);f=h[l]?h[l].value:h.options[0].value}else"button"!=h.getAttribute("type")&&(f=h.value);u&&g.push(Qa(u,f,b&&b.reload))}}b&&
b.reload&&(F.wait(),Z.when(g).done(()=>{rea.page.reload()}))}},!1));return e},Ob=(a,b)=>{var e=(q,x,r,v,y)=>{let J;const B=p("th","settingsth",q.name,q.id,x),P=(N,W,ca)=>{N=document.getElementsByName("settingsth_a_up"+q.name);const ea=document.getElementsByName("settingsth_a_down"+q.name);for(J=0;J<N.length;J++)N[J].style.display="none";for(J=0;J<ea.length;J++)ea[J].style.display="none";"up"==Ca()?W.style.display="":ca.style.display=""},I=p("a","settingsth_a",q.name,q.id,x+"_a");I.setAttribute("name",
"settingsth_a"+q.name);const O=p("a","settingsth_a_up",q.name,q.id,x+"_a_up");O.setAttribute("name","settingsth_a_up"+q.name);const U=p("a","settingsth_a_down",q.name,q.id,x+"_a_down");U.setAttribute("name","settingsth_a_down"+q.name);x=()=>{P(I,O,U)};const H=()=>{P(I,O,U)},M=()=>{window.setTimeout(()=>{wa()==v?nb("down"==Ca()?"up":"down"):mb(v);ob(H)},1)};B.inserted||(B.appendChild(I),B.appendChild(U),B.appendChild(O),I.addEventListener("click",M),O.addEventListener("click",M),U.addEventListener("click",
M),I.textContent=r+" ",I.href="#",O.innerHTML="&#x25B4;",O.href="#",U.innerHTML="&#x25BE;",U.href="#");y&&!wa()?(mb(v),nb("up"),window.setTimeout(x,1)):v==wa()&&window.setTimeout(x,1);return B};let c,g,m;let h,k;h=K("tbody",a.name,a.id,"body");k=K("thead",a.name,a.id,"head");if(a.scriptTab){var f=Mb(a),u=Nb(a);c=K("table",a.name,a.id,"main");c.inserted||c.setAttribute("class","scripttable multiselect");var l=p("th","script_sel",a.name,a.id,"thead_sel");l.appendChild(f.selAllm);var n=p("th","left",
a.name,a.id,"thead_multi_action");n.setAttribute("colspan",X.RUNTIME.MOBILE?3:11);n.appendChild(f.actionBox);n.appendChild(u);u=p("th","right",a.name,a.id,"thead_multi_close");u.appendChild(f.close);m=p("tr","multiselectrow",a.name,a.id,"filler_multi");m.appendChild([l,n,u]);l=p("tr","multiselectscrolldummy",a.name,a.id,"scrolldummy");n=p("th","left",a.name,a.id,"scrolldummyth");n.setAttribute("colspan",X.RUNTIME.MOBILE?3:11);l.appendChild([n]);g=p("tr","scripttr multiselectreplaced",a.name,a.id,
"filler");n=p("th","script_sel",a.name,a.id,"thead_sel");n.appendChild(f.selAll);f=e(a,"thead_pos","#","pos");u=e(a,"thead_en",d.getMessage("Enabled"),"enabled");const q=e(a,"thead_name",d.getMessage("Name"),"name",!0),x=p("th","settingsth",a.name,a.id,"thead_del");x.textContent=d.getMessage("Actions");if(X.RUNTIME.MOBILE)G.each([n,f,u,q,x],r=>{g.appendChild(r)});else{const r=e(a,"thead_ver",d.getMessage("Version"),"ver"),v=p("th","settingsth ",a.name,a.id,"thead_type");var w=p("span","script_type",
a.name,a.id,"thead_type_span");w.textContent=d.getMessage("Type");v.appendChild(w);const y=p("th","settingsth",a.name,a.id,"thead_sync");y.textContent="";w=e(a,"thead_sites",d.getMessage("Sites"),"sites");w.width="25%";const J=p("th","settingsth",a.name,a.id,"thead_features");J.textContent=d.getMessage("Features");const B=e(a,"thead_homepage",d.getMessage("Homepage"),"homepage");e=e(a,"thead_updated",d.getMessage("Last_updated"),"updated");const P=p("th","settingsth",a.name,a.id,"thead_sort");a=p("span",
"sorting",a.name,a.id,"thead_sort_span");a.textContent=d.getMessage("Sort");"pos"==wa()&&"up"==Ca()||a.setAttribute("style","display: none;");P.appendChild(a);fa.push(()=>{L.sync_enabled&&(y.textContent=d.getMessage("Imported"))});G.each([n,f,u,q,r,v,y,w,J,B,e,P,x],I=>{g.appendChild(I)})}k.appendChild([m,l,g]);g.inserted||(R.multiselect.checkScroll=()=>{const r=$(k),v=r.is(":visible")&&$(m).is(":visible")&&0<$(b).scrollTop();r.toggleClass("multiscrolling",v)},$(b).scroll(R.multiselect.checkScroll))}else c=
p("table","settingstable",a.name,a.id,"main");c.appendChild(k);c.appendChild(h);return{table:c,head:k,body:h}},vb=(a,b,e,c)=>{let g,m;let h=[];var k=(l,n)=>{if(e)if(e.save_button)$(l).on("change",()=>{e.save_button.disabled=!1}),$(n).on("input propertychange",()=>{e.save_button.disabled=!1});else if(console.error("Section needs a save button!",e),Registry.isDevVersion("layout/default/layout_helper"))throw Error("Section needs a save button!");};if(b.divider)return null;b.image&&(b.image_id=T.get(b.image));
if(b.checkbox){var f=function(){let l=!0;const n=this;n.warning&&(l=Ja(n.warning),l||(n.checked=!n.checked));l&&Qa(this.key,n.checked,n.reload).always(()=>{n.reload&&rea.page.reload(500)})};e&&e.need_save&&(f=m=null);g=z.createCheckbox(b.name,b,f);h.push(g.elem);e&&e.save_button&&k(null,g.input)}else if(b.button)f=function(){let l=!0;const n=this;n.warning&&(l=Ja(n.warning));l&&Gb(n.key,n.data,n.ignore).always(()=>{n.reload&&rea.page.reload(500)})},g=z.createButton(b.name,b,f),h.push(g);else if(b.named)g=
z.createNamedSettings(b.name,b),h.push({element:g.elem,validation:g.label}),k(null,g.textareas);else if(b.input)g=z.createTextarea(b.name,b),h.push({element:g.elem,validation:g.label}),k(null,g.textarea);else if(b.text)g=z.createInput(b.name,b),h.push(g.elem),k(g.input);else if(b.color)g=z.createColorChooser(b.name,b),h.push(g.elem),k(g.input);else if(b.password)g=z.createPassword(b.name,b),h.push(g.elem),k(g.input);else if(b.select)m=function(){let l=!0;const n=this;n.warning&&(l=Ja(n.warning),l||
(n.value=n.oldvalue));l&&Qa(n.key,z.getValue(n),n.reload).always(()=>{n.reload&&rea.page.reload(500)})},e&&e.need_save&&(m=b.enabler?function(){const l=document.getElementsByName("enabled_by_"+this.key),n=(this.selectedIndex<this.options.length?this.options[this.selectedIndex]:this.options[0]).getAttribute("enables"),w=n?JSON.parse(n):{};G.each(l,q=>{void 0===w[q.key]||w[q.key]?q.setAttribute("style",G.staticVars.visible):q.setAttribute("style",G.staticVars.invisible)})}:null),g=z.createDropDown(b.name,
b,b.select,m,function(){let l;this.selectedOptions.length&&this.selectedOptions[0].warning&&this.selectedOptions[0].value!==this.oldvalue&&(l=Ja(this.selectedOptions[0].warning),l||(this.value=this.previousValue||this.oldvalue));this.previousValue=this.value}),h.push(g.elem),e&&e.save_button&&k(g.select),a&&b.enabler&&(()=>{const l=m,n=g;fa.push(()=>{l.apply(n.select,[])})})();else if(b.url)f=K("a",b.name,b.id),f.href="#",f.url=b.url,f.newtab=b.newtab,f.inserted||(m=function(){Oa(this.url,this.newtab)},
f.addEventListener("click",m)),f.textContent=b.name,h=Array(13),h[3]=f;else if(b.main_menu_item){f=K("div",b.name,b.id);f.textContent=b.name;k=K("div",b.name,b.id,"tab_content");var u=Ob(b,k);k.appendChild(u.table);let l=null;const n=c.appendTab(b.id,f,k,w=>{w.then(()=>{l&&(Na.global?l():fa.push(l));da.set(b.id);document.title=b.name})});da.registerListener(b.id,()=>{n.select()});b.referrer&&(l=()=>{l=null;ma(50);Fa({referrer:b.referrer},w=>{w.items&&w.items.forEach(q=>{vb(a,q,e,c)});$a();la();F.hide()})});
b.items&&Pa(u.body,b.items,null,c);!Na.global&&b.selected_default&&fa.push(()=>{c.getSelectedTab()||n.select()})}else b.sub_menu_item?(k=p("div","section type_"+b.id,b.name,b.id,"section"),f=p("div","section_head",b.name,b.id,"head"),u=p("table","section_content",b.name,b.id,"content"),f.textContent=b.name,k.appendChild(f),b.desc&&z.setHelp(b.desc,f,f,b),k.appendChild(u),b.need_save&&(b.save_button=Lb(u,b)),Pa(u,b.items,b,c),b.save_button&&u.appendChild(b.save_button),h.push(k)):b.userscript?(h=Pb(b,
a,c),b.userscript&&(ra[b.uuid]={dom:a,script:b}),a.setAttribute("class","scripttr"),b.nnew?a.setAttribute("style","display: none;"):cb.is("script_refresh")||(fa.push(()=>{Wa.init(G.map(ra,l=>l.script));R.multiselect.single_click();ob();Na.scripts=!0;cb.clear()}),cb.add("script_refresh"))):b.globalhint?Ya(G.copy(b.options,{onclick:b.options.info_url?()=>{Oa(b.options.info_url,!0)}:null})):(f=K("span","",b.uuid||b.id+b.name),f.textContent=b.name,h=Array(13),h[3]=f);h.forEach(l=>{if(l){void 0!==b.level&&
(l.element||l).setAttribute("style",b.level>L.configMode?G.staticVars.invisible:G.staticVars.visible||"");if(b.hint){const n=K("span","",b.uuid||b.id+b.name,"hint");n.textContent=b.hint;l.appendChild(n)}b.validation&&Qb(b,l.validation||l.element||l);b.width&&l.setAttribute("class","width-172-"+b.width)}});a&&(u=a.getAttribute("class"),f=" hide",!1===b.visible?u=(u||"")+f:u&&(u=u.replace(f,"")),a.setAttribute("class",u));return h},Pa=(a,b,e,c)=>{Object.keys(b).forEach(g=>{const m=b[g],h=a?p("tr","settingstr",
m.uuid||m.id+m.name,"pi"):null;(g=vb(h,m,e,c))&&g.length&&(a&&a.appendChild(h),G.each(g,(k,f)=>{let u=k,l="";"Object"===G.toType(k)&&(u=k.element,l=k.style||"");f=p("td",l+" settingstd","",m.uuid||m.id+m.name,f);k&&f.appendChild(u);h&&h.appendChild(f)}))})},Qb=(a,b)=>{var e;a.validation&&(a.validation.url&&(e=function(){Oa(this.url,!0)}),e=z.createAfterIcon(a,e))&&(e.url=a.validation?a.validation.url:void 0,b.appendChild(e))},Rb=a=>{const b=c=>c.url?{meta:{name:Ma.parse(c.url).pathname.split("/").pop(),
url:c.url,sri:c.sri,ts:c.ts,mimetype:c.mimetype,modified:c.modified},source:c.data.content}:void 0,e=c=>c;return{source:a.code,meta:{name:a.name,uuid:a.uuid,modified:a.lastModified,file_url:a.file_url&&a.file_url.trim()?a.file_url:void 0},storage:a.storage,options:a.options,settings:{enabled:a.enabled,position:a.position},resources:a.resources?a.resources.map(b).filter(e):[],requires:a.requires?a.requires.map(b).filter(e):[]}},db=a=>{const b=a.meta||{},e=a.settings||{},c=g=>({url:g.meta.url,sri:g.meta.sri,
ts:g.meta.ts,mimetype:g.meta.mimetype,modified:g.meta.modified,content:g.source});return{source:a.source,name:b.name,uuid:b.uuid,file_url:b.file_url,options:a.options,storage:a.storage,lastModified:b.modified,enabled:e.enabled,position:e.position,resources:a.resources?a.resources.map(c):[],requires:a.requires?a.requires.map(c):[]}},Ra=(a,b)=>{const e=Z(),c=[];Eb(a,b).done(g=>{g.scripts.forEach(m=>{m.uuid&&m.userscript&&!m.system&&!m.nnew&&(m.code&&""!=m.code.trim()?c.push(Rb(m)):console.log("options: Strange script: "+
m.name))});e.resolve({scripts:c,global_settings:g.global_settings})}).fail(()=>{e.reject()});return e.promise()},Sb=a=>{let b,e;const c=K("div","help","help","tab_help_h"),g=c.textContent=d.getMessage("Help"),m=K("div","help","help","tab_help");return a.appendTab("help",c,m,h=>{h.then(()=>{da.set("help");document.title=g;if(!e){F.wait();const f=p("div","section","help","help","ta");var k=p("div","section_head","help","help","head_ta");const u=p("div","section_content","help","help","content_ta");
k.textContent=d.getMessage("Editor");f.appendChild([k,u]);const l=p("dl","dl-horizontal shortcuts","help","help","dl");u.appendChild(l);k=p("dt","keymapping","help","help","dt_mapping");b=p("dd","keymapping","help","help","dd_mapping");k.textContent=d.getMessage("Key_Mapping");b.textContent=L.editor_keyMap;l.appendChild([k,b]);if("vim"==L.editor_keyMap)b=p("dd","keymapping","help","help","dd_unsup"),b.textContent=d.getMessage("Please_check_the_0editor0_documentation_for_more_details_","VIM"),l.appendChild(b);
else if("emacs"==L.editor_keyMap)b=p("dd","keymapping","help","help","dd_unsup"),b.textContent=d.getMessage("Please_check_the_0editor0_documentation_for_more_details_","Emacs"),l.appendChild(b);else{const n=[];e={};const w=q=>{q=q.split(/-+/);const x=q.pop(),r=[];let v;-1!=(v=["up","down","left","right"].indexOf(x.toLowerCase()))&&r.push("#cursor");x.toLowerCase().match(/f[0-9]{1,2}/)&&r.push("#function");return r.length?r.join("-")+q.join("-")+v+x:("0000"+(100-Math.min(x.length,4))).slice(-4)+x+
q.join("-")};[G.assign({Esc:"backOrClose"},"mac"!=Ga?{"Alt-Left":"previousTab","Alt-Right":"nextTab"}:{"Alt-Up":"previousTab","Alt-Down":"nextTab"}),CodeMirror.keyMap[L.editor_keyMap],"mac"!=Ga?CodeMirror.keyMap.pcDefault:CodeMirror.keyMap.macDefault,CodeMirror.keyMap["default"]].forEach(q=>{Object.keys(q).forEach(x=>{e[x]||"fallthrough"==x||(n.push({name:x,fn:q[x].replace?q[x].replace(/([A-Z])/g," $1").replace(/ [A-Z]/g,r=>r.toLowerCase()):q[x],sort:w(x)}),e[x]=!0)})});n.sort((q,x)=>q.sort<x.sort?
-1:q.sort>x.sort?1:0);n.forEach(q=>{const x=K("dt","help","help","dt_"+q.sort),r=K("dd","help","help","dd_"+q.sort);x.textContent=q.name;r.textContent=q.fn;l.appendChild([x,r])})}m.appendChild(f);F.hide()}})})};let La=()=>{if(X.RUNTIME.SHARED_OBJECT_URLS)return window.saveAs=(a,b)=>{const e=URL.createObjectURL(a);ub(e,b,()=>{URL.revokeObjectURL(e)})},Z.Pledge();if(X.RUNTIME.SAFARI)return window.saveAs=(a,b)=>{Ha.blob2dataUri(a,e=>ub(e,b))},Z.Pledge();if(X.RUNTIME.EDGE&&window.navigator&&window.navigator.msSaveBlob)return window.saveAs=
(a,b)=>{window.navigator.msSaveBlob(a,b)},Z.Pledge();{const a=Z();Registry.vendor(["vendor/saveas/filesaver"],()=>{La=Z.Pledge;a.resolve()});return a.promise()}};const Tb=a=>{const b={name:"utils",id:"utils"};var e=K("div",b.name,b.id,"tab_util_h");const c=e.textContent=d.getMessage("Utilities"),g=K("div",b.name,b.id,"tab_util");a.appendTab(b.id,e,g,C=>{C.then(()=>{da.set(b.id);document.title=c})}).show();a=p("div","tv_util",b.name,b.id,"tab_util_cont");let m=()=>{hb.init(C=>{let S=Z();const Q=rea.extension.connect("tabWatch");
Q.onMessage.addListener(Y=>{S&&((Y=Y.tab)?S.notify(Y):(S.resolve(),S=null,Q.disconnect()))});Q.onDisconnect.addListener(()=>{S&&S.resolve()});Q.postMessage({method:"tabWatch",url:C.url});return{promise:S.promise(),close:function(){S&&S.resolve();Q.disconnect()}}});m=null},h={};const k=C=>{let S,Q;S="webdav"==C&&(Q=ba.cloud_config)?{url:Q.url,basic_auth:Ha.Base64.encode(Q.user+":"+Q.pass)}:{};return h[C]=h[C]||hb[C](S)},f=()=>Ra(null,{storage:ba.script_storage,global_settings:ba.add_tm_settings,externals:ba.include_externals}).then(C=>
{F.wait();return va.zip.create(C.scripts,C.global_settings).progress(F.wait).done(()=>ka()).fail(()=>xa(d.getMessage("Action_failed")))}),u=C=>{for(let S=0,Q;Q=C[S];S++)va.zip.read(Q).progress(F.wait).then(Y=>ab({scripts:G.map(Y.scripts,t=>db(t)),global_settings:Y.global_settings},{reload:!0})).done(Y=>{Y.err&&G.alert(Y.err)}).fail(()=>{G.alert(d.getMessage("Unable_to_parse_this_"))}).always(F.hide)};var l=z.createButton(b.name,b.id+"_i_ta",d.getMessage("Import"),()=>{va.json.read(I.value).then(C=>
ab({scripts:G.map(C.scripts,S=>db(S)),global_settings:C.global_settings},{reload:!0})).done(C=>{C.err&&G.alert(C.err)}).fail(()=>{G.alert(d.getMessage("Unable_to_parse_this_"))})}),n=z.createFileSelect(d.getMessage("Import"),{name:"zip",id:b.id},C=>{F.wait();return u(C)}),w=z.createFileSelect(d.getMessage("Import"),{name:"file",id:b.id},C=>{F.wait();for(let S,Q=0;S=C[Q];Q++)Ta.readAsText(S).then(Y=>va.json.read(Y).then(t=>ab({scripts:G.map(t.scripts,E=>db(E)),global_settings:t.global_settings},{reload:!0}),
function(){return rb({code:Y},{reload:!0})})).done(Y=>{Y.err&&G.alert(Y.err)}).fail(()=>{G.alert(d.getMessage("Unable_to_parse_this_"))}).always(F.hide)}),q=z.createButton(b.name,b.id+"_i_cloud",d.getMessage("Show_backups"),()=>{F.wait();const C=N.select.value,S=N.select.selectedOptions[0].text;m&&m();k(C).list().progress(Q=>{0<Q.total&&F.wait(S+": "+Math.floor(Q.loaded/Q.total*100)+"%")}).then(Q=>{Q=Q.filter(Y=>Y.name.match(/\.zip$/));return Q.length?Q:Z.Breach("empty")}).then(Q=>{const Y=Z(),t=
$('<table class="nowrap file_select">');$('<thead><tr><th colspan="3">'+d.getMessage("Please_select_a_file")+":</th></tr></thead>").appendTo(t);Q.sort((E,A)=>E.modified-A.modified).forEach(E=>{const A=$('<input class="button" type="button" value="'+d.getMessage("Import")+'">').click(()=>{Y.resolve(E);F.hideDialog();F.wait()}),D=$('<input class="button" type="button" value="'+d.getMessage("Delete")+'">').click(()=>{V.hide();k(C).delete(E)}),V=$("<tr><td>"+[z.safeTagsReplace(E.name),Ia.formatBytes(E.size,
2),(new Date(E.modified)).toLocaleString().replace((new Date).toLocaleDateString(),d.getMessage("Today"))].join("</td><td>")+"</td></tr>");$("<td>").append(A,D).appendTo(V);V.appendTo(t)});Q=$('<input class="button" type="button" value="'+d.getMessage("Cancel")+'">').click(()=>{Y.reject("cancel");F.hideDialog()});$("<tfoot>").append($("<tr>").append($('<td colspan="3">').append(Q))).appendTo(t);F.hide();F.dialog(t[0]);return Y.promise()}).then(Q=>k(C).get(Q).progress(Y=>{0<Y.total&&F.wait(S+": "+
Math.floor(Y.loaded/Y.total*100)+"%")})).then(Q=>u([Q])).fail(Q=>{let Y;"empty"===Q?Y=d.getMessage("No_backups_found"):"cancel"!=Q&&("auth_failed"==Q?console.warn("cloud: Authentication failed"):Y=d.getMessage("Error")+": "+(Q||d.getMessage("Action_failed")));Y&&G.alert(Y);F.hide()})});e=z.createButton(b.name,b.id+"_i_url",d.getMessage("Install"),()=>{F.wait();return rb({url:ea.value},{reload:!0}).fail(C=>{C=C.err?C.err:d.getMessage("Unable_to_parse_this_");G.alert(C)}).always(F.hide)});var x=z.createButton(b.name,
b.id+"_e_ta",d.getMessage("Export"),()=>{F.wait();Ra(null,{storage:ba.script_storage,global_settings:ba.add_tm_settings,externals:ba.include_externals}).then(C=>va.json.create(C.scripts,C.global_settings)).done(C=>{I.value=C;ka()}).fail(()=>xa(d.getMessage("Action_failed"))).always(F.hide)}),r=z.createButton(b.name,b.id+"_e_file",d.getMessage("Export"),()=>{F.wait();Ra(null,{storage:ba.script_storage,global_settings:ba.add_tm_settings,externals:ba.include_externals}).then(C=>va.json.create(C.scripts,
C.global_settings).then(S=>La().done(()=>{const Q=new Blob([S],{type:"text/plain"});saveAs(Q,G.safeFileName("tampermonkey-backup-"+X.RUNTIME.BROWSER+"-"+(new Date).toISOString().replace(/[.:]/g,"-")+".txt"));ka()}))).fail(()=>xa(d.getMessage("Action_failed"))).always(F.hide)}),v=z.createButton(b.name,b.id+"_e_zip",d.getMessage("Export"),()=>f().then(C=>La().done(()=>{saveAs(C,G.safeFileName("tampermonkey-backup-"+X.RUNTIME.BROWSER+"-"+(new Date).toISOString().replace(/[.:]/g,"-")+".zip"))})).always(F.hide)),
y=z.createButton(b.name,b.id+"_e_zip",d.getMessage("Export"),()=>{const C=Z(),S=N.select.value,Q=N.select.selectedOptions[0].text,Y=t=>f().then(E=>{F.wait(Q+"...");m&&m();return k(S).put(t+".zip",E).progress(A=>{0<A.total&&F.wait(Q+":"+Math.floor(A.loaded/A.total*100)+"%")})}).fail(E=>{G.alert(d.getMessage("Error")+": "+(E||d.getMessage("Action_failed")))}).always(F.hide);G.prompt(d.getMessage("Name"),"backup-"+X.RUNTIME.BROWSER+"-"+(new Date).toISOString().replace(/[.:]/g,"-"),t=>{t?C.consume(Y(t)):
C.reject("aborted")});return C.promise()}),J=z.createCheckbox(d.getMessage("Include_TM_settings"),{id:b.id+"_e_export_tm_settings",enabled:"true"},function(){ba.add_tm_settings=this.checked;X.HTML5.LOCALSTORAGE&&X.HTML5.LOCALSTORAGE.setItem("export_tm_settings",ba.add_tm_settings)});J.elem.setAttribute("style","padding-left: 2px");J.input.checked=ba.add_tm_settings;var B=z.createCheckbox(d.getMessage("Include_script_storage"),{id:b.id+"_e_export_storage",enabled:"true"},function(){ba.script_storage=
this.checked;X.HTML5.LOCALSTORAGE&&X.HTML5.LOCALSTORAGE.setItem("export_script_storage",ba.script_storage)});B.elem.setAttribute("style","padding-left: 2px; display: inline");B.input.checked=ba.script_storage;var P=z.createCheckbox(d.getMessage("Include_script_externals"),{id:b.id+"_e_export_externals",enabled:"true"},function(){ba.include_externals=this.checked;X.HTML5.LOCALSTORAGE&&X.HTML5.LOCALSTORAGE.setItem("export_externals",ba.include_externals)});P.elem.setAttribute("style","padding-left: 2px");
P.input.checked=ba.include_externals;var I=p("textarea","importta",b.name,b.id,"ta");I.setAttribute("spellcheck","false");const O=p("div","section",b.name,b.id,"ta");var U=p("div","section_head",b.name,b.id,"head_ta");const H=p("div","section_content",b.name,b.id,"content_ta");U.textContent=d.getMessage("General");H.appendChild(B.elem);H.appendChild(J.elem);H.appendChild(P.elem);O.appendChild(U);O.appendChild(H);J=p("div","section",b.name,b.id,"ta");B=p("div","section_head",b.name,b.id,"head_ta");
P=p("div","section_content",b.name,b.id,"content_ta");B.textContent=d.getMessage("TextArea");P.appendChild(x);P.appendChild(l);P.appendChild(I);J.appendChild(B);J.appendChild(P);l=p("div","section",b.name,b.id,"sb");x=p("div","section_head",b.name,b.id,"head_sb");B=p("div","section_content",b.name,b.id,"content_sb");x.textContent=d.getMessage("Zip");l.appendChild(x);l.appendChild(B);B.appendChild(v);B.appendChild(n.elem);n=p("div","section",b.name,b.id,"sb");v=p("div","section_head",b.name,b.id,"head_sb");
x=p("div","section_content",b.name,b.id,"content_sb");const M=function(){$(W).toggle("webdav"===this.value);const C=k(this.value);$(ca).toggle(C&&!!C.revoke)};var N=z.createDropDown(d.getMessage("Type"),{id:"cloud_type",value:"edge"==X.RUNTIME.BROWSER?"onedrive":"drive"},[{name:d.getMessage("Google_Drive"),value:"drive"},"safari"==X.RUNTIME.BROWSER?null:{name:d.getMessage("Dropbox"),value:"dropbox"},{name:d.getMessage("OneDrive"),value:"onedrive"},"safari"==X.RUNTIME.BROWSER?null:{name:d.getMessage("Yandex_Disk"),
value:"yandex"},"safari"==X.RUNTIME.BROWSER?null:{name:d.getMessage("WebDAV"),value:"webdav"}].filter(C=>C),M);U=C=>function(){h={};let S;(ba.cloud_config=ba.cloud_config||{})[C]=this.value;(S=X.HTML5.LOCALSTORAGE)&&S.setItem("cloud_config",Ha.Base64.encode(JSON.stringify(ba.cloud_config)))};B=z.createInput(d.getMessage("URL"),{id:"select_cloud_url",uuid:b.uuid,value:(ba.cloud_config?ba.cloud_config.url:null)||""},U("url"));P=z.createInput(d.getMessage("Login"),{id:"select_cloud_username",uuid:b.uuid,
value:(ba.cloud_config?ba.cloud_config.user:null)||""},U("user"));U=z.createInput(d.getMessage("Password"),{id:"select_cloud_password",uuid:b.uuid,password:!0,value:(ba.cloud_config?ba.cloud_config.pass:null)||""},U("pass"));const W=[B.elem,P.elem,U.elem];fa.push(()=>{M.apply(N.select,[])});v.textContent=d.getMessage("Cloud");n.appendChild(v);n.appendChild(x);x.appendChild([N.elem].concat(W));x.appendChild(y);x.appendChild(q);const ca=z.createButton("revoke_token_button",b.uuid,d.getMessage("Revoke_Access_Token"),
()=>{$(ca).prop("disabled",!0);k(N.select.value).revoke().always(()=>{$(ca).prop("disabled",!1)})});x.appendChild(ca);q=p("div","section",b.name,b.id,"fi");y=p("div","section_head",b.name,b.id,"head_fi");v=p("div","section_content",b.name,b.id,"content_fi");y.textContent=d.getMessage("File");q.appendChild(y);q.appendChild(v);v.appendChild(r);v.appendChild(w.elem);const ea=p("input","updateurl_input",b.name,b.id,"url");ea.setAttribute("type","text");ea.setAttribute("spellcheck","false");w=p("div",
"section",b.name,b.id,"ur");r=p("div","section_head",b.name,b.id,"head_ur");y=p("div","section_content",b.name,b.id,"content_ur");r.textContent=d.getMessage("Install_from_URL");w.appendChild(r);w.appendChild(y);y.appendChild(ea);y.appendChild(e);a.appendChild(O);"undefined"!==typeof Blob&&a.appendChild(n);X.RUNTIME.CAN_SAVEAS_ZIP&&a.appendChild(l);"undefined"!==typeof Blob&&a.appendChild(q);a.appendChild(J);a.appendChild(w);G.each([J],C=>{let S=C.getAttribute("class");S=50>L.configMode?S+" hide":
S.replace(" hide","");C.setAttribute("class",S)});g.appendChild(a)},Ub=()=>{const a=p("div","content_wrapper","options","main");var b=p("div","status","options","status");$(document.body).append(a,b).addClass("main");b=p("div","head_container","opt","head_container");const e=p("div","tv_container_fit","opt","tv_container"),c=K("a","head_link","heads","head_link");c.href="https://www.tampermonkey.net";c.target="_blank";const g=p("div","float","heads","head1"),m=p("img","banner","heads");m.src=T.brand("tampermonkey");
const h=p("div","float head","heads","head2"),k=p("div","header_title","heads"),f=p("div","version","version","version");f.textContent=" by Jan Biniok";const u=K("div","search","box",""),l=p("div","footer","footer");k.innerHTML="Tampermonkey<sup>\u00ae</sup>";const n=p("div","social","social");n.textContent=" by Jan Biniok";n.appendChild(z.createSocialButtons());k.appendChild(n);g.appendChild(m);h.appendChild(k);h.appendChild(f);c.appendChild(g);c.appendChild(h);b.appendChild(c);b.appendChild(u);
a.appendChild(b);a.appendChild(e);window.tab_view=ia=eb.create("_main",e);ia.setFooter(l);fa.unshift(()=>{Tb(ia);Sb(ia)});fa.push(()=>{void 0!==ua.contribute&&window.setTimeout(()=>{lb("f")},100);Na.global=!0});window.onbeforeunload=w=>{let q;ia.getAllTabs().forEach(x=>{q=q||x.modified()});return q?d.getMessage("There_are_unsaved_changed_"):void 0}},sa=(a,b,e,c)=>{void 0===c&&(c={});const g=b.item,m=g.uuid+(c.orig||"")+b.id;var h=(c.orig?"orig_":"use_")+b.id;const k=r=>"select_"+G.createUniqueId(r,
g.uuid)+"_sel1",f=p("div","cludes",a,m,"cb1");var u=K("span",a,m,"cb2");if(c.orig){var l="merge_"+b.id;l=z.createCheckbox(a,{id:l,uuid:g.uuid,enabled:g.options&&g.options.override&&g.options.override[l]?!0:!1},function(){if("checkbox"==this.type){const r={};r[this.key]=this.checked;ya(this.uuid,r)}});u.appendChild(l.elem)}else u.textContent=a;const n=p("select","cludes",h,g.uuid,"sel1");n.innerHTML="";n.setAttribute("size","6");n.setAttribute("multiple","true");for(h=0;h<e.length;h++)l=document.createElement("option"),
l.value=l.text=e[h],n.appendChild(l);f.appendChild(u);g.desc&&z.setHelp(g.desc,f,u,g);f.appendChild(n);const w=r=>{const v=[];r=r&&r.options;for(let y=0,J=r.length;y<J;y++)r[y].selected&&v.push(r[y]);return v};h=()=>{var r=k("use_"+("excludes"==b.id?"includes":"excludes"));const v=document.getElementById(r);r=w(n);let y=!1;const J="matches"==b.id;r.forEach(B=>{const P=J?"/"+Ma.getRegExpFromMatch(B.value,!0)+"/":B.value;B&&!v.querySelector('option[value="'+P+'"]')&&(B=B.cloneNode(!0),J&&(B.value=P,
B.textContent=P),v.appendChild(B),y=!0)});y&&x()};l=()=>{const r=prompt(d.getMessage("Enter_the_new_rule"));if(r){const v=document.createElement("option");v.value=v.text=r.trim();n.appendChild(v);x()}};u=()=>{const r=n.options[n.selectedIndex];if(r){var v=prompt(d.getMessage("Enter_the_new_rule"),r.value);v&&(r.value=r.text=v.trim(),x())}};e=()=>{let r=!1;w(n).forEach(v=>{v&&(v.parentNode.removeChild(v),r=!0)});r&&x()};const q=r=>{const v=[];for(let y=0;y<r.options.length;y++)v.push(r.options[y].value);
return v};var x=()=>{const r={includes:q(document.getElementById(k("use_includes"))),matches:q(document.getElementById(k("use_matches"))),excludes:q(document.getElementById(k("use_excludes"))),connects:q(document.getElementById(k("use_connects"))),temp_connects:q(document.getElementById(k("use_temp_connects"))),blockers:q(document.getElementById(k("use_blockers")))};ya(g.uuid,r);return!0};c.other_name?(a=K("button",a,m,"btn1",!0),a.textContent=d.getMessage("Add_as_0clude0",c.other_name),a.addEventListener("click",
h,!1),f.appendChild(a)):c.orig||(c=K("button",a,m,"btn2",!0),c.textContent=d.getMessage("Add")+"...",c.addEventListener("click",l,!1),f.appendChild(c),c=K("button",a,m,"btn3",!0),c.textContent=d.getMessage("Edit")+"...",c.addEventListener("click",u,!1),f.appendChild(c),a=K("button",a,m,"btn4",!0),a.textContent=d.getMessage("Remove"),a.addEventListener("click",e,!1),f.appendChild(a));return{elem:f}},Xa=a=>a.homepage?a.homepage:a.namespace&&0==a.namespace.search(/https?:\/\//)?a.namespace:null,Yb=(a,
b,e,c,g)=>{e=K("div",b.uuid,"script_tab_head");const m=e.inserted,h=p("table","noborder p100100 heading",b.uuid,"h_table");var k=p("tr","",b.uuid,"h_tr1"),f=p("td","nameNicon64",b.uuid,"h_td1"),u=p("td","",b.uuid,"h_td2");h.appendChild(k);k.appendChild(f);k.appendChild(u);u.setAttribute("style","width: 99%");k=K("img",b.uuid,"heading_icon");var l=b.icon64?b.icon64:b.icon;k.src=l;var n=p("div","nameNname64",b.uuid,"heading_name");n.textContent=d.getTranslation(b,"name");l&&f.appendChild(k);u.appendChild(n);
f=p("div","author",b.uuid,"author");b.author?f.textContent="by "+b.author:b.copyright&&(f.innerHTML="&copy; ",f.textContent+=b.copyright);u.appendChild(f);u=p("table","noborder p100100",b.uuid,"table");f=p("tr","script_tab_head",b.uuid,"tr1");k=p("tr","details",b.uuid,"tr2");l=p("td","",b.uuid,"td1");n=p("td","",b.uuid,"td2");e.appendChild(h);l.appendChild(e);f.appendChild(l);k.appendChild(n);u.appendChild(f);u.appendChild(k);c.appendChild(u);const w=eb.create("_details"+b.uuid,n,{tv:"tv tv_alt",
tv_table:"tv_table tv_table_alt",tr_tabs:"tr_tabs tr_tabs_alt",tr_content:"tr_content tr_content_alt",td_content:"td_content td_content_alt",td_tabs:"td_tabs td_tabs_alt",tv_tabs_align:"tv_tabs_align tv_tabs_align_alt",tv_tabs_fill:"tv_tabs_fill tv_tabs_fill_alt",tv_tabs_table:"tv_tabs_table tv_tabs_table_alt",tv_contents:"tv_contents tv_contents_alt",tv_tab_selected:"tv_tab tv_selected tv_tab_alt tv_selected_alt",tv_tab_close:"tv_tab_close",tv_tab:"tv_tab tv_tab_alt",tv_content:"tv_content tv_content_alt"},
!0),q=wb(b,w,{do_close:g,set_tab_class:(B,P)=>{a.toggleClass(B,P)},navid:"editor",treeid:"source"}),x=b.nnew||b.system?{}:Vb(b,w),r=b.nnew||b.system||!b.storage_key_count||80>L.configMode?{}:Wb(b,w),v=b.nnew||b.system||!b.requires.length&&!b.resources.length?{}:Xb(b,w);if(m)return ta["tab"+b.uuid];const y=()=>{let B;return(B=w.getSelectedTab())&&B.isCloseable()?v.getEditor():q.getEditor()},J=B=>{let P=!1;if("keydown"==B.type&&a.isSelected()&&!B.defaultPrevented){if(27==B.keyCode){if(!L.editor_enabled||
"vim"!=L.editor_keyMap){var I;(I=w.getSelectedTab())&&I.isCloseable()?I.close():window.setTimeout(g,1);P=!0}}else if(L.editor_enabled){const O={save:!0,find:!0,findNext:!0,findPrev:!0,replace:!0,replaceAll:!0},U=y();I=CodeMirror.keyName(B);U&&!U.hasFocus()&&"handled"==CodeMirror.lookupKey(I,U.getOption("keyMap"),H=>{if(O[H])return U.execCommand(H),!0})&&(P=!0)}else 83==B.keyCode&&(B.ctrlKey||B.metaKey)&&(I=y())&&(I.save(),P=!0);if(P)return B.stopPropagation(),B.preventDefault(),!1}};c={onShow:()=>
{G.each([x,q,r,v],B=>{if(B.onShow)B.onShow()});window.addEventListener("keydown",J,!1)},onClose:B=>{let P;G.each([x,q,r,v],I=>{if(I.onClose&&I.onClose(B))return P=!0,!1});P||window.removeEventListener("keydown",J,!1);return P},onSelect:B=>{B.then(()=>{if(b.uuid){const P=da.get().sub,I=w.getTabById(P);da.set(b.uuid,(I?P:null)||"editor");document.title=d.getTranslation(b,"name")}});G.each([x,q,v],P=>{if(P.onSelect)P.onSelect(B)})}};return ta["tab"+b.uuid]=c},Vb=(a,b)=>{const e=K("div",a.uuid,"script_setting_h"),
c=K("div",a.uuid,"script_settings_c");e.textContent=d.getMessage("Settings");const g=function(){const D={};if("checkbox"==this.type)D[this.key]=!!this.checked,ya(this.uuid,D);else if("button"==this.type)D[this.key]=!this.oldvalue,ya(this.uuid,D);else if("text"==this.type||"textarea"==this.type||"select-one"==this.type){const V=z.getValue(this);D[this.key]=V;ya(this.uuid,D)}};var m=z.createCheckbox(d.getMessage("Enabled"),{id:"enabled",uuid:a.uuid,name:"upd",enabled:a.enabled},g).elem;const h=z.createPosition(d.getMessage("Position_")+
": ",{id:"position",uuid:a.uuid,name:"pos",pos:a.position,posof:a.positionof},g),k=z.createDropDown(d.getMessage("Run_at"),{id:"run_at",uuid:a.uuid,name:"run-at",value:a.run_at},[{name:"document-start",value:"document-start"},{name:"document-body",value:"document-body"},{name:"document-end",value:"document-end"},{name:"document-idle",value:"document-idle"},{name:"context-menu",value:"context-menu"},{name:d.getMessage("Default"),value:null}],g),f=z.createDropDown(d.getMessage("No_frames"),{id:"noframes",
uuid:a.uuid,name:"no_frames",value:a.noframes},[{name:d.getMessage("Yes"),value:!0},{name:d.getMessage("No"),value:!1},{name:d.getMessage("Default"),value:null}],g),u=z.createCheckbox(d.getMessage("Check_for_Updates"),{id:"check_for_updates",uuid:a.uuid,name:"upd",enabled:a.check_for_updates}),l=z.createInput(d.getMessage("Update_URL_"),{id:"file_url",uuid:a.uuid,name:"uu",value:a.file_url});l.input.setAttribute("class","updateurl_input");l.elem.setAttribute("class","updateurl");a.is_external&&l.input.setAttribute("readonly",
"true");var n=D=>(a.options&&a.options.override?a.options.override[D]:null)||[],w=sa(d.getMessage("Original_includes"),{id:"includes",item:a},n("orig_includes"),{orig:!0,other_name:d.getMessage("User_excludes")}),q=sa(d.getMessage("Original_matches"),{id:"matches",item:a},n("orig_matches"),{orig:!0,other_name:d.getMessage("User_excludes")}),x=sa(d.getMessage("Original_excludes"),{id:"excludes",item:a},n("orig_excludes"),{orig:!0,other_name:d.getMessage("User_includes")}),r=p("div","clear",a.uuid,
"clear");const v=sa(d.getMessage("User_includes"),{id:"includes",item:a},n("use_includes")),y=sa(d.getMessage("User_matches"),{id:"matches",item:a},n("use_matches")),J=sa(d.getMessage("User_excludes"),{id:"excludes",item:a},n("use_excludes")),B=sa(d.getMessage("Original_domain_whitelist"),{id:"connects",item:a},a.connects,{orig:!0}),P=sa(d.getMessage("Temporary_domain_whitelist"),{id:"temp_connects",item:a},a.temp_connects),I=sa(d.getMessage("User_domain_whitelist"),{id:"connects",item:a},n("use_connects"));
n=sa(d.getMessage("User_domain_blacklist"),{id:"blockers",item:a},n("use_blockers"));var O=z.createCheckbox(d.getMessage("Apply_compatibility_options_to_required_script_too"),{id:"compatopts_for_requires",uuid:a.uuid,name:"",enabled:a.compatopts_for_requires},g),U=z.createCheckbox(d.getMessage("Fix_wrappedJSObject_property_access"),{id:"compat_wrappedjsobject",uuid:a.uuid,name:"",enabled:a.compat_wrappedjsobject},g),H=z.createCheckbox(d.getMessage("Convert_CDATA_sections_into_a_chrome_compatible_format"),
{id:"compat_metadata",uuid:a.uuid,name:"",enabled:a.compat_metadata},g),M=z.createCheckbox(d.getMessage("Replace_for_each_statements"),{id:"compat_foreach",uuid:a.uuid,name:"",enabled:a.compat_foreach},g),N=z.createCheckbox(d.getMessage("Fix_for_var_in_statements"),{id:"compat_forvarin",uuid:a.uuid,name:"",enabled:a.compat_forvarin},g),W=z.createCheckbox(d.getMessage("Convert_Array_Assignements"),{id:"compat_arrayleft",uuid:a.uuid,name:"",enabled:a.compat_arrayleft},g),ca=z.createCheckbox(d.getMessage("Add_toSource_function_to_Object_Prototype"),
{id:"compat_prototypes",uuid:a.uuid,name:"",enabled:a.compat_prototypes},g);const ea=[O,U,H,M,N,W,ca];O=p("div","section",a.uuid,"ta_opt");H=p("div","section_head",a.uuid,"head_ta_opt");U=p("div","section_content",a.uuid,"content_ta_opt");H.textContent=d.getMessage("Settings");O.appendChild(H);O.appendChild(U);H=p("div","section",a.uuid,"ta_upd");N=p("div","section_head",a.uuid,"head_ta_upd");M=p("div","section_content",a.uuid,"content_ta_upd");N.textContent=d.getMessage("Updates");H.appendChild(N);
H.appendChild(M);N=p("div","section",a.uuid,"ta_cludes");ca=p("div","section_head",a.uuid,"head_ta_cludes");W=p("div","section_content",a.uuid,"content_ta_cludes");ca.textContent=d.getMessage("Includes_Excludes");N.appendChild(ca);N.appendChild(W);ca=p("div","section",a.uuid,"ta_security");var C=p("div","section_head",a.uuid,"head_ta_security");const S=p("div","section_content",a.uuid,"content_ta_security");C.textContent=d.getMessage("XHR_Security");ca.appendChild(C);ca.appendChild(S);C=p("div","section",
a.uuid,"ta_compat");const Q=p("div","section_head",a.uuid,"head_ta_compat"),Y=p("div","section_content",a.uuid,"content_ta_compat");Q.textContent=d.getMessage("GM_compat_options_");C.appendChild(Q);C.appendChild(Y);U.appendChild(m);U.appendChild(h);U.appendChild(k.elem);U.appendChild(f.elem);m=z.createButton("save_update_button",a.uuid,d.getMessage("Save"),()=>{g.apply(u.input,[]);a.is_external||g.apply(l.input,[])});M.appendChild([u.elem,l.elem,m]);W.appendChild([w.elem,q.elem,x.elem,r,v.elem,y.elem,
J.elem]);S.appendChild([B.elem,P.elem,I.elem,n.elem]);c.appendChild([O,H,N,ca]);for(w=0;w<ea.length;w++)Y.appendChild(ea[w].elem);a.awareOfChrome&&Object.keys(ea).forEach(D=>{ea[D].input.setAttribute("disabled","disabled");ea[D].elem.setAttribute("title",d.getMessage("This_script_runs_in_Chrome_mode"))});c.appendChild(C);const t=z.createTextarea(null,{name:"",uuid:a.uuid,id:"comment",value:a.options.comment});t.elem.setAttribute("class","script_setting_wrapper");w=K("div",a.uuid,"save");q=z.createButton("save_button",
a.uuid,d.getMessage("Save"),()=>{g.apply(t.textarea,[])});w.appendChild(q);q=p("div","section",a.uuid,"ta_comment");x=p("div","section_head",a.uuid,"head_ta_comment");r=p("div","section_content",a.uuid,"content_ta_comment");x.textContent=d.getMessage("Comment");q.appendChild(x);q.appendChild(r);r.appendChild(t.elem);r.appendChild(w);c.appendChild(q);w=p("div","section",a.uuid,"ta_det");q=p("div","section_head",a.uuid,"head_ta_det");x=p("div","section_content",a.uuid,"content_ta_det");q.textContent=
d.getMessage("Details");w.appendChild(q);w.appendChild(x);q.textContent=d.getMessage("Details");const E=p("table","script_details",a.uuid,"script_details");[{label:d.getMessage("Size"),value:Ia.formatBytes((a.code?a.code:a).length,2)},{label:d.getMessage("UUID"),value:a.uuid}].forEach(D=>{const V=p("tr","external_desc",a.uuid,D.label,"tr"),aa=p("td","external_desc",a.uuid,D.label,"td1"),na=p("td","",a.uuid,D.label,"td2");aa.textContent=D.label;na.textContent=D.value;V.appendChild(aa);V.appendChild(na);
E.appendChild(V)});x.appendChild(E);c.appendChild(w);const A=b.appendTab("settings",e,c,D=>{D.then(()=>{da.setSub("settings")})});da.registerListener(a.uuid,"settings",()=>{A.select()});return{}},xb=(a,b,e,c)=>{const g=p("table","externals",a.uuid,"outer_req2html",b,!0);let m=0;const h=[{label:d.getMessage("URL"),prop:"display_url"},{label:d.getMessage("Size"),prop:"data",fn:function(k){let f="?";k&&(void 0!==k.length?f=k.length:void 0!==k.content&&(f=k.content.length));return Ia.formatBytes(f,2)}},
{label:d.getMessage("MIME_Type"),prop:"mimetype"},{label:d.getMessage("Subresource_Integrity"),prop:"sri",fn:function(k){return k?k.type+"="+k.value:d.getMessage("_not_set_")}},{label:d.getMessage("Last_updated"),prop:"ts",fn:function(k){return k?(new Date(k)).toString():null}}];h.push({label:d.getMessage("User_modified"),prop:"modified",klass:"validation",title:d.getMessage("This_external_resource_will_not_auto_update__Please_delete_it_in_order_to_enable_updates_again_"),icon:T.get("info"),fn:function(k){return k?
d.getMessage("Yes"):null}});a[b].forEach(k=>{const f=m+G.createUniqueId(k.url)+b;h.forEach(n=>{var w;const q=p("tr","",a.uuid,n.prop,"tr"+f),x=p("td","external_label",a.uuid,n.prop,"td1"+f),r=p("td","external_desc",a.uuid,n.prop,"td2"+f);x.textContent=n.label;r.textContent=w=(n.fn?n.fn:v=>v)(k[n.prop]);null!==w&&(n.klass&&$(r).addClass(n.klass),n.title&&r.setAttribute("title",n.title),n.icon&&(w=p("span","validation",a.uuid,"validation","span"+f),w.appendChild(z.createIcon(n.icon+" red","warning",
a.uuid,f+"no_require_update_warning")),r.appendChild(w)),q.appendChild(x),q.appendChild(r),g.appendChild(q))});var u=p("tr","external_desc_buttons",a.uuid,k.url,"tr"+f);const l=p("td","",a.uuid,"buttons","td"+f);u.appendChild(l);g.appendChild(u);if(k.ts){if("requires"==b||k.editable){u=K("span",a.uuid,"edit_external"+f);const w=z.createImageTextButton(a.uuid,"edit_external"+f,d.getMessage("Edit"),"edit",()=>{Zb(e,a.uuid,k,c)});u.appendChild(w);l.appendChild(u)}u=K("span",a.uuid,"delete_external"+
f);const n=z.createImageTextButton(a.uuid,"delete_external"+f,d.getMessage("Delete"),"delete",()=>{Ib(a.uuid,k.url);n.parentNode&&n.parentNode.removeChild(n)});u.appendChild(n);l.appendChild(u)}m++});if(!m){const k=p("tr","script_desc",a.uuid,m,"tr"),f=p("td","script_desc",a.uuid,m,"td1");f.textContent=d.getMessage("No_entry_found");k.appendChild(f);g.appendChild(k)}return g},Zb=(a,b,e,c)=>{const g="externals-"+b+"-"+e.url;R[g]={};const m=$b({uuid:g,script_uuid:b,mimetype:e.mimetype,name:d.getMessage("Externals")+
" - "+e.url,file_url:e.url,referrer:"options.scripts.userscripts"},a,()=>{c(m.getEditor())},()=>{delete ta["tab"+g];delete ta["editor"+g];delete R[g]});m.show()},Xb=(a,b)=>{let e;const c=n=>{e=n},g=K("div","",a.uuid,"script_external_h");g.textContent=d.getMessage("Externals");const m=K("div","",a.uuid,"script_externals_c"),h=p("div","section",a.uuid,"ta_requires");var k=p("div","section_head",a.uuid,"head_ta_requires"),f=p("div","section_content",a.uuid,"content_ta_requires");k.textContent=d.getMessage("Requires");
h.appendChild(k);h.appendChild(f);f.appendChild(xb(a,"requires",b,c));k=p("div","section",a.uuid,"ta_resources");f=p("div","section_head",a.uuid,"head_ta_resources");const u=p("div","section_content",a.uuid,"content_ta_resources");f.textContent=d.getMessage("Resources");k.appendChild(f);k.appendChild(u);u.appendChild(xb(a,"resources",b,c));m.appendChild(h);m.appendChild(k);const l=b.appendTab("externals",g,m,n=>{n.then(()=>{da.setSub("externals")})});da.registerListener(a.uuid,"externals",()=>{l.select()});
return{getEditor:function(){return e}}},Wb=(a,b)=>{const e=(l,n)=>{if("string"===typeof l){const w=l[0];l=l.substr(1);switch(w){case "b":return"true"===l;case "n":return Number(l);case "o":try{return JSON.parse(l)}catch(q){console.log("values: parseValueFromStorage: "+q)}return n;default:return l}}else return n},c=K("div","",a.uuid,"script_storage_h");c.textContent=d.getMessage("Storage");const g=K("div","",a.uuid,"script_storages_c"),m=p("div","section",a.uuid,"ta_storage");var h=p("div","section_head",
a.uuid,"head_ta_storage");const k=p("div","section_content",a.uuid,"content_ta_storage");h.textContent=d.getMessage("Storage");m.appendChild(h);m.appendChild(k);const f=p("textarea","storageta",a.uuid,"storage");f.setAttribute("wrap","off");f.setAttribute("wrap","off");f.setAttribute("spellcheck","false");h=z.createButton("storage_save_button",a.uuid,d.getMessage("Save"),()=>{let l=null;try{l=JSON.parse(f.value)}catch(q){G.alert(d.getMessage("Unable_to_parse_this_"));return}const n=Object.keys(l),
w=Object.keys(a.storage);n.concat(w).filter((q,x,r)=>r.lastIndexOf(q)===x).forEach(q=>{if(!n.includes(q))tb(a.uuid,q);else if(!w.includes(q)||l[q]!==a.storage[q]){var x=a.uuid;{var r=l[q];const v=(typeof r)[0];switch(v){case "o":try{r=v+JSON.stringify(r)}catch(y){console.log(y),r=void 0}break;default:r=v+r}}tb(x,q,r)}})});k.appendChild(f);k.appendChild(h);g.appendChild(m);const u=b.appendTab("storage",c,g,l=>{l.then(()=>{da.setSub("storage")})});da.registerListener(a.uuid,"storage",()=>{(()=>{if(a.referrer&&
void 0===a.storage){const l=Z();Fa({referrer:a.referrer+".storage",uuid:a.uuid},n=>{if(n.items){const w={},q=n.items[0];Object.keys(q).forEach(x=>{w[x]=e(q[x])});l.resolve(w)}else l.reject();F.hide()});return l.promise()}return Z.Pledge(a.storage)})().done(l=>{f.value=f.value||JSON.stringify(l,null,4);a.storage=l;f.removeAttribute("disabled")}).fail(()=>{f.setAttribute("disabled",!0)});u.select()});return{}},wb=(a,b,e)=>{const c=p("tr","editor_container p100100",a.uuid,"container"),g=e.mimetype||
"text/javascript",m=!g||/(application|text)\/(?:x-)?(?:java|ecma)script/.test(g);if(!a.nnew&&ja(a.uuid,"lastI"))return ta["editor"+a.uuid]||{};a.nnew&&(a.code=L.script_templates[0].value.replace("<$URL$>",ua.url?Ha.Base64.decode(ua.url):"http://*/*"));const h=K("div",a.uuid,"script_editor_h"),k=h.inserted,f=K("div",a.uuid,"script_editor_c"),u=p("tr","editormenubar",a.uuid,"container_menu");var l=p("tr","editorbuttonbar",a.uuid,"container_button_menu"),n=p("table","editor_container_o p100100 noborder",
a.uuid,"container_o");n.appendChild(l);n.appendChild(u);n.appendChild(c);f.appendChild(n);const w=()=>{let t=!1;c.editor&&(t=L.editor_enabled?t|(c.editor.changed&&c.editor.mirror.historySize().undo):c.editor.value!=a.code);return t},q=()=>{CodeMirror.commands.trimTrailingSpacesIfEnabled(c.editor.mirror);ja(a.uuid,"saveEm")},x=(t,E,A)=>{e.do_close&&e.do_close(E,A)};n=()=>{confirm(d.getMessage("Really_factory_reset_this_script_"))&&R[a.uuid].fullReset(t=>{t.cleaned&&e.do_close&&e.do_close(!0,!1)})};
const r=t=>{(t||confirm(d.getMessage("Really_reset_all_changes_")))&&c.editor&&(L.editor_enabled?(c.editor.mirror.setValue(a.code),y(!1)):c.editor.value=a.code)};var v=()=>{e.do_close&&e.do_close(!0,!1);R[a.uuid].deleteScript()};const y=t=>{c.editor.changed!=t&&(e.set_tab_class&&e.set_tab_class("modified",t),C.toggleClass("modified",t));c.editor.changed=t};var J=()=>{window.setTimeout(()=>{let t;L.editor_enabled&&(t=c.editor)&&(F.wait(),window.setTimeout(()=>{(()=>{const E=t.mirror.performLint(!0);
return E&&E.then?E:Z.Pledge(E)})().then(()=>{const E=t.mirror.state.lint?t.mirror.state.lint.marked:null;if(E&&E.length){1===E.length?xa(d.getMessage("One_error_or_hint_was_found_")):xa(d.getMessage("0count0_errors_or_hints_were_found_",E.length));for(let D,V=0;D=E[V];V++){var A=void 0;let aa;void 0!==D.line&&void 0!==D.column?(aa=D.line,A=D.column):D.lines&&D.lines.length&&(A=D.lines[0],aa=A.lineNo()+1,A=A.markedSpans&&A.markedSpans.length?A.markedSpans[0].from+1:1);if(aa&&A){t.mirror.setCursor(aa-
1,A-1);t.mirror.focus();break}}}else qb(d.getMessage("No_syntax_errors_were_found_"));F.hide()})},100))},1)};const B=p("td","",a.uuid,"editor_buttonmenu_td");l.appendChild(B);const P=p("ul","editormenu",a.uuid,"editormenu");l=p("td","",a.uuid,"editormenu_td");l.appendChild(P);let I,O;const U=(t,E)=>{let A,D;t&&(A=$(t),D=E?A.hasClass("visible"):!1);$("ul.editormenu .submenu").removeClass("visible");t?(A.toggleClass("visible",!D),O=D?null:t):O=null;t&&D||(I=V=>{let aa;I&&(aa=$(V.target))&&!aa.closest(".editormenu").length&&
(U(),document.body.removeEventListener("click",I),I=null)},document.body.addEventListener("click",I))},H=(t,E)=>{const A=p("li","entry",a.uuid,t,"editormenuentry",!0),D=K("label",a.uuid,t,"editormenulabel_id");D.textContent=E;const V=p("table","submenu noborder",a.uuid,"editormenucontent"+t);A.appendChild([D,V]);A.addEventListener("click",aa=>{$(aa.target).closest(".entry").hasClass("list")||U(V,!0)});A.addEventListener("mousemove",function(){O&&O!=this&&U(V)});return{elem:A,content:V}},M=t=>()=>
{c.editor.mirror.focus();c.editor.mirror.execCommand(t)},N={file:{text:d.getMessage("File"),entries:[{text:d.getMessage("Save"),command:"save",image:T.get("filesave"),cb:q},{text:d.getMessage("Save_to_disk"),command:"save_to_disk",image:T.get("save_to_disk"),cb:()=>{ja(a.uuid,"saveToDisk")}},{type:"sep"},{command:"cancel",text:d.getMessage("Editor_reset"),image:T.get("editor_cancel"),cb:r}].concat(a.nnew||a.is_external?[]:[{text:d.getMessage("Check_for_Updates"),command:"update",image:T.get("update"),
disabled:a.options.check_for_updates&&a.file_url&&"none"!=a.file_url?!1:d.getMessage("Update_check_is_disabled"),cb:()=>{if(!w()||confirm(d.getMessage("Really_reset_all_changes_")))r(!0),ja(a.uuid,"scriptUpdate")}},{text:d.getMessage("Remove"),command:"remove",image:T.get("delete"),cb:v}]).concat([{type:"sep"},{text:d.getMessage("Close"),command:"close",image:T.get("exit"),cb:x}])},edit:{text:d.getMessage("Edit"),entries:[{text:d.getMessage("Undo"),command:"undo"},{text:d.getMessage("Redo"),command:"redo"},
{type:"sep"},{text:d.getMessage("Select_All"),command:"selectAll"},{type:"sep"},{text:d.getMessage("Toggle_Comment"),command:"toggleComment"},{text:d.getMessage("Toggle_Comment_Indented"),command:"toggleCommentIndented"},{text:d.getMessage("Toggle_Block_Comment"),command:"toggleBlockComment",modes:["js"]},{type:"sep"},{id:"edit_lines",text:d.getMessage("Lines"),modes:["js"],entries:[{text:d.getMessage("Indent"),command:"intelligentTab"},{text:d.getMessage("Indent_Less"),command:"indentLess"},{text:d.getMessage("Indent_More"),
command:"indentMore"},{text:d.getMessage("Auto_Indent_all"),command:"reindentall"},{type:"sep"},{text:d.getMessage("Move_Line_Up"),command:"swapLineUp"},{text:d.getMessage("Move_Line_Down"),command:"swapLineDown"},{text:d.getMessage("Duplicate_Lines"),command:"duplicateLine"},{text:d.getMessage("Delete_Line"),command:"deleteLine"},{text:d.getMessage("Join_Lines"),command:"joinLines"},{type:"sep"},{text:d.getMessage("Insert_Line_Before"),command:"insertLineBefore"},{text:d.getMessage("Insert_Line_After"),
command:"insertLineAfter"}]},{id:"edit_text",text:d.getMessage("Text"),entries:[{text:d.getMessage("Upper_Case"),command:"upcaseAtCursor"},{text:d.getMessage("Lower_Case"),command:"downcaseAtCursor"},{type:"sep"},{text:d.getMessage("Delete_Line_Left"),command:"delLineLeft"},{text:d.getMessage("Delete_Line_Right"),command:"delLineRight"},{text:d.getMessage("Delete_to_Previous_Word_Boundary"),command:"delGroupBefore"},{text:d.getMessage("Delete_to_Next_Word_Boundary"),command:"delGroupAfter"},{text:d.getMessage("Delete_Line"),
command:"deleteLine"},{type:"sep"},{text:d.getMessage("Transpose"),command:"transposeChars"}]},{id:"edit_sort",text:d.getMessage("Sort"),entries:[{text:d.getMessage("Lines"),command:"sortLines"},{text:d.getMessage("Line_Case_Insensitive"),command:"sortLinesInsensitive"}]},{id:"edit_folding",text:d.getMessage("Folding"),entries:[{text:d.getMessage("Fold"),command:"fold"},{text:d.getMessage("Unfold"),command:"unfold"},{text:d.getMessage("Fold_All"),command:"foldAll"},{text:d.getMessage("Unfold_All"),
command:"unfoldAll"}]},{id:"edit_sublime_mark",text:d.getMessage("Sublime_Mark"),entries:[{text:d.getMessage("Set_Sublime_Mark"),command:"setSublimeMark"},{text:d.getMessage("Select_to_Sublime_Mark"),command:"selectToSublimeMark"},{text:d.getMessage("Swap_with_Sublime_Mark"),command:"swapWithSublimeMark"},{text:d.getMessage("Delete_to_Sublime_Mark"),command:"deleteToSublimeMark"},{text:d.getMessage("Yank_Sublime_Mark"),command:"sublimeYank"}]}]},selection:{text:d.getMessage("Selection"),entries:[{text:d.getMessage("Incremental_Find"),
command:"selectMatchingPartsOfCurrentSelection"},{text:d.getMessage("Split_into_Lines"),command:"splitSelection"},{type:"sep"},{text:d.getMessage("Incremental_Find"),command:"selectMatchingPartsOfCurrentSelection"},{type:"sep"},{text:d.getMessage("Select_Line"),command:"selectLine"},{text:d.getMessage("Select_Scope"),command:"selectScope"},{text:d.getMessage("Select_Bookmarks"),command:"selectBookmarks"},{text:d.getMessage("Select_between_Brackets"),command:"selectBetweenBrackets"},{text:d.getMessage("Select_Next_Occurrence"),
command:"selectNextOccurrence"}]},find:{text:d.getMessage("Find"),entries:[{text:d.getMessage("Find"),command:"find"},{text:d.getMessage("Replace"),command:"replace"},{text:d.getMessage("Replace_All"),command:"replaceAll"},{type:"sep"},{text:d.getMessage("Find_Next"),command:"findNext"},{text:d.getMessage("Find_Previous"),command:"findPrev"},{text:d.getMessage("Find_Under"),command:"findUnder"},{text:d.getMessage("Find_All_Under"),command:"findAllUnder"},{text:d.getMessage("Find_Under_Previous"),
command:"findUnderPrevious"},{type:"sep"},{text:d.getMessage("Incremental_Find"),command:"selectMatchingPartsOfCurrentSelection"}]},goto:{text:d.getMessage("GoTo"),entries:[{text:d.getMessage("Jump_to_line"),command:"jump"},{text:d.getMessage("Document_Start"),command:"goDocStart"},{text:d.getMessage("Document_End"),command:"goDocEnd"},{text:d.getMessage("Group_Left"),command:"goGroupLeft"},{text:d.getMessage("Group_Right"),command:"goGroupRight"},{text:d.getMessage("Closing_Bracket"),command:"goToBracket"},
{text:d.getMessage("Line_Up"),command:"goLineUp"},{text:d.getMessage("Line_Down"),command:"goLineDown"},{type:"sep"},{text:d.getMessage("Center_Cursor"),command:"showInCenter"},{type:"sep"},{id:"bookmarks",text:d.getMessage("Bookmarks"),entries:[{text:d.getMessage("Toggle"),command:"toggleBookmark"},{text:d.getMessage("Clear_All"),command:"clearBookmarks"},{type:"sep"},{text:d.getMessage("Next_Bookmark"),command:"nextBookmark"},{text:d.getMessage("Prev_Bookmark"),command:"prevBookmark"}]}]},dev:{text:d.getMessage("Developer"),
entries:[{command:"macro",text:d.getMessage("Insert_constructor"),modes:["js"]}].concat(!a.system&&L.editor_enabled&&m?[{type:"sep"},{text:d.getMessage("Run_syntax_check"),command:"lint_script",image:T.get("check"),cb:J},{text:d.getMessage("Auto_Indent_all"),command:"reindentall"}]:[]).concat(a.nnew||a.is_external?[]:[{type:"sep"},{text:d.getMessage("Full_reset"),command:"reset",image:T.get("script_cancel"),cb:n}]).concat(a.nnew?[{type:"sep"},{id:"templates",text:d.getMessage("Templates"),entries:L.script_templates.map(t=>
({text:t.name,command:t.name,image:T.get("dot"),cb:function(){if(!w()||confirm(d.getMessage("Really_reset_all_changes_"))){var E=t.value;c.editor&&(L.editor_enabled?(c.editor.mirror.setValue(E),y(!1)):c.editor.value=E)}}}))}]:[])}},W=(t,E)=>{const A=E[0];let D,V;if(D=t[A])return W(D,E.slice(1));t.entries&&t.entries.some(aa=>{if(aa.command==A)return V=aa,!0;if(aa.entries&&(V=W(aa,E)))return!0});return V};"file.save_to_disk file.save file.cancel dev.reset find.findNext find.findPrev edit.replace goto.jump edit.reindentall dev.lint_script file.close".split(" ").forEach(t=>
{(t=W(N,t.split(".")))&&(t.image?B.appendChild(z.createImageButton(a.uuid,t.id||t.command,t.text,t.image,t.cb||M(t.command))):B.appendChild(z.createButton(t.id||t.command,a.uuid,t.text,t.cb||M(t.command))))});const ca=(t,E)=>{const A=E||CodeMirror.keyMap[L.editor_keyMap];let D,V;Object.keys(A).every(aa=>A[aa]==t?(D=aa,!1):!0);if(D)return D;if(A.fallthrough&&(V=CodeMirror.keyMap[A.fallthrough])&&V!==A)return ca(t,V)},ea=(t,E)=>E.map((A,D)=>{if(!A.modes||A.modes.includes(m?"js":"other")){if("sep"==
A.type){var V=t+D;A=p("tr","entry sep",a.uuid,"editorsubmenusep_tr"+V);D=K("td",a.uuid,"editorsubmenusep_td"+V);V=K("hr",a.uuid,"editorsubmenusep"+V);D.setAttribute("colspan",4);A.appendChild(D);D.appendChild(V);return A}if(A.command){var aa=t+"_"+A.command,na=A.text,za=A.image;D=ca(A.command);V=A.disabled;var ha=A.cb||M(A.command);A=!!A.cb||CodeMirror.commands.hasOwnProperty(A.command);var qa=p("tr","entry "+(!V&&A?"":"disabled"),a.uuid,aa,"editorsubmenuentry_tr",!0);var Sa=za?p("i","far fa-"+za,
a.uuid,aa,"editorsubmenuentry_i",!0):p("i","far",a.uuid,aa,"editorsubmenuentry_i",!0);za=K("td",a.uuid,"editorsubmenuentry_td_i"+aa);za.appendChild(Sa);Sa=p("td","label",a.uuid,"editorsubmenuentry_td_l"+aa);Sa.textContent=na;aa=p("td","shortcut",a.uuid,"editorsubmenuentry_td_m"+aa);aa.setAttribute("colspan",2);D&&(aa.textContent=D);qa.appendChild([za,Sa,aa]);V?"string"==typeof V&&qa.setAttribute("title",V):A&&qa.addEventListener("click",ha);return A=qa}ha=D=t+A.id;aa=A.text;na=A.image;V=p("tr","entry list",
a.uuid,ha,"editorsubmenulistentry",!0);qa=na?p("i","far fa-"+na,a.uuid,ha,"editorsubmenulistentry_i",!0):p("i","far",a.uuid,ha,"editorsubmenulistentry_i",!0);na=K("td",a.uuid,"editorsubmenulistentry_td_i"+ha);na.appendChild(qa);qa=p("td","label",a.uuid,"editorsubmenulistentry_td_l"+ha);qa.textContent=aa;za=p("td",a.uuid,"editorsubmenulistentry_td_m"+ha);aa=K("td",a.uuid,"editorsubmenulistentry_td_s"+ha);V.appendChild([na,qa,za,aa]);na=p("span","submenulist",a.uuid,"editorsubmenulistcontent"+ha);qa=
p("span","submenumore",a.uuid,"editorsubmenulistmore"+ha);ha=p("i","more far fa-caret-right",a.uuid,ha,"editorsubmenulistentrymore_i",!0);qa.appendChild([ha,na]);aa.appendChild([ha,qa]);ha=na;A=ea(D,A.entries);if(0<A.length)return ha.appendChild(A),V}}).filter(A=>A);Object.keys(N).forEach(t=>{const E=N[t],A=H(t,E.text);t=ea(t,E.entries);0<t.length&&(P.appendChild(A.elem),A.content.appendChild(t))});n=p("textarea","editorta",a.uuid,"editor");n.setAttribute("wrap","off");n.setAttribute("spellcheck",
"false");v=p("td","editor_outer",a.uuid,"edit");J=p("div","editor_100 editor_border",a.uuid,"edit");v.appendChild(J);u.appendChild(l);c.inserted||(J.appendChild(n),c.appendChild(v));R[a.uuid].saveToDisk=()=>{if(c.editor){var t=L.editor_enabled?c.editor.mirror.getValue():c.editor.value;F.wait();return La().done(()=>{const E=new Blob([t],{type:"text/plain"});saveAs(E,G.safeFileName(a.name+(a.is_external?"":".user.js")))}).always(()=>{F.hide()})}};a.system||(R[a.uuid].saveEm=a.is_external?t=>{if(c.editor){var E=
L.editor_enabled?c.editor.mirror.getValue():c.editor.value;Fb(a.script_uuid,E,{url:a.file_url,mimetype:a.mimetype,auto_save:t&&t.auto_save}).done(A=>{A.success?y(!1):A.aborted||t&&t.auto_save||(A.messages&&A.messages.errors&&A.messages.errors.length?G.alert(A.messages.errors.join("\n")):G.alert(d.getMessage("Unable_to_parse_this_")))})}}:t=>{if(c.editor){var E=!0;L.showFixedSrc&&(E=confirm(d.getMessage("Do_you_really_want_to_store_fixed_code_",d.getMessage("Show_fixed_source"))));var A=L.editor_enabled?
c.editor.mirror.getValue():c.editor.value;E&&bb(a.uuid,A,{clean:!1,new_script:a.nnew,auto_save:t&&t.auto_save,reload:!0,lastModTime:R[a.uuid].saveEm_lastModTime}).done(D=>{D.installed?a.nnew?e.do_close&&e.do_close(!0,!1):(y(!1),D.lastModified&&(a.lastModTime=D.lastModified)):D.aborted||t&&t.auto_save||(D.messages&&D.messages.errors&&D.messages.errors.length?G.alert(D.messages.errors.join("\n")):G.alert(d.getMessage("Unable_to_parse_this_")))});return E}});const C=b.insertTab(null,e.navid,h,f,t=>{t.then(()=>
{da.setSub(e.navid);if(e.on_tab_select)e.on_tab_select()})},e.on_tab_close);C.setHeading(e.tab_name||d.getMessage("Editor"),50);da.registerListener(a.uuid,e.navid,()=>{C.select();L.editor_enabled&&c.editor&&(c.editor.refresh(),c.editor.mirror.focus())});if(k)return ta["editor"+a.uuid];const S=(t,E,A,D)=>{t=D.getValue();if((t=D.getHelper(CodeMirror.Pos(0,0),"lint")(t,A,D))&&t.then)return t.then(E);E(t)},Q=t=>{Qa("editor_theme",t,!0).done(()=>{qb("Theme switched to "+t)})},Y=()=>{L.editor_autoSave&&
w()&&ja(a.uuid,"saveEm",{auto_save:!0})};b={getTab:function(){return C},getEditor:function(){if(c.editor)return L.editor_enabled?c.editor.mirror:{save:q}},onShow:()=>{(()=>{if(a.referrer&&void 0===a.code){const t=Z();Fa(G.copy(e.tree_opts||{},{referrer:a.referrer+"."+e.treeid,uuid:a.uuid}),E=>{E.items?(a.code=E.items[0],t.resolve()):t.reject();F.hide()});return t.promise()}return Z.Pledge()})().done(()=>{var t=f.getElementsByTagName("textarea");R[a.uuid].lastI=()=>a;if(t.length&&!c.editor){t=t[0];
const E=()=>{c.editor&&y(!!c.editor.mirror.historySize().undo)};if(L.editor_enabled){const A=t.parentNode;A.removeChild(t);c.editor=new MirrorFrame(A,{mode:g,theme:L.editor_theme,fontSize:L.editor_fontSize,themeOptions:{all:gb.getEditorThemes().map(D=>D.value),onChange:Q},value:a.code,indentUnit:Number(L.editor_indentUnit),tabSize:Number(L.editor_tabSize),indentWithTabs:"tabs"==L.editor_indentWithTabs,smartIndent:"classic"!=L.editor_tabMode,indentByTab:"indent"==L.editor_tabMode,electricChars:"true"==
L.editor_electricChars.toString(),lineNumbers:!0,lineWrapping:L.editor_lineWrapping,extraKeys:{Enter:"newlineAndIndentContinueComment"},keyMap:L.editor_keyMap,bookmarkGutter:!0,gutters:["gutter","CodeMirror-linenumbers","CodeMirror-foldgutter","CodeMirror-lint-markers","CodeMirror-bookmarks"],matchBrackets:!0,foldGutter:!0,styleActiveLine:!0,specifyMoreJsTokens:m,styleSelectedText:!0,autoTrimTrailingSpace:"true"==L.editor_trimTrailingSpacesFromModifiedLines.toString(),hintOptions:m?{keywords:Object.keys(fb.globals)}:
void 0,lint:m?{lintOnChange:L.editor_autoLint,autoLintMaxLen:L.editor_autoLintMaxLen,async:!0,getAnnotations:S,hint_config:L.editor_linter_config||fb.config}:void 0,showTrailingSpace:L.editor_highlightTrailingWhitespace},{save:q,close:x},{change:E,blur:Y},d.getMessage)}else c.editor=t,t.value=a.code;if(e.on_editor_load)e.on_editor_load()}}).fail(()=>{e.do_close&&e.do_close(!1,!0)})},onClose:function(t){if(!t&&w()){if(t=confirm(d.getMessage("There_are_unsaved_changed_")))c.editor=null,delete R[a.uuid].lastI;
return!t}c.editor=null;delete R[a.uuid].lastI;return!1}};return ta["editor"+a.uuid]=b},$b=(a,b,e,c)=>{let g;a.is_external=!0;const m=()=>{g&&!h.onClose()&&(c(),g&&g.remove(),g=null)},h=wb(a,b,{tab_name:a.name,navid:a.uuid,treeid:"external",mimetype:a.mimetype,tree_opts:{url:a.file_url,uuid:a.script_uuid},do_close:function(){window.setTimeout(m,100)},on_tab_close:m,on_tab_select:e,on_editor_load:e});g=h.getTab();h.show=()=>{h.onShow();g.select()};return h},Pb=(a,b,e)=>{R[a.uuid]||(R[a.uuid]={});let c,
g;var m=a.icon,h=[];h.push("clickable");(a.blacklisted||a.foisted)&&h.push("crossedout");const k=p("span",h.join(" "),a.uuid,"sname");var f=p(m?"img":"span","nameNicon16 icon16 "+(m?"nameNicon16":"nameNOicon16"),a.uuid,"sname_img");const u=p("span","nameNname16 "+(a.enabled?"":"greyed"),a.uuid,"sname_name");k.appendChild(f);h=Xa(a);var l=d.getTranslation(a,"name");u.textContent=l;var n=K("span",a.uuid,"spos");n.textContent=a.position||"";l=K("span",a.uuid,"sversion");l.textContent=a.version?a.version:
"";m&&(f.src=a.icon);m=[];f=(H,M,N)=>{const W=p("span",N||"",H.uuid,"wrap");M&&("Array"===G.toType(M)?G.each(M,ca=>{W.appendChild(ca)}):W.appendChild(M));return W};const w=()=>{window.setTimeout(()=>{const H=Object.keys(ra);for(let M,N=0;M=H[N];N++){const W=ra[M].script;if(W.uuid==a.uuid){Pa(b,[W],null,e);break}}$a()},1)},q=(H,M)=>{void 0===M&&(M=!H);g&&g.onClose&&g.onClose(H)||(a.uuid&&da.is(a.uuid)&&da.clear(),c&&(c.remove(),c=null),delete ta["tab"+a.uuid],delete ta["editor"+a.uuid],k.parentNode&&
k.parentNode.removeChild(k),M&&w())},x=H=>{if(g&&g.onSelect)g.onSelect(H)},r=R[a.uuid].scriptClick=(H,M)=>{if(!c){{if(a.nnew){var N=p("div","head_icon",a.uuid,"details_h");N.appendChild(z.createIcon(a.image_id,"",a.uuid,"new_script_head"))}else N=K("div",a.uuid,"details_h");const W=K("div",a.uuid,"details_c");c=e.insertTab(null,a.uuid,N,W,x,a.nnew?null:q);a.nnew||(N=a.version?" "+a.version:"",N=d.getMessage("Edit")+" - "+d.getTranslation(a,"name")+N,c.setHeading(N,50));g=Yb(c,a,b,W,q)}}if(g&&g.onShow)g.onShow();
c.show();H&&1==H.button||M||c.select();u.setAttribute("open","true")};"true"==u.getAttribute("open")&&r(null,!0);var v=(H,M)=>{H=H.getTime();M=M.getTime();var N=Math.abs(H-M);M=Math.round(N/6E4);H=Math.round(N/36E5);N=Math.round(N/864E5);return 60>=M?M+" min":48>=H?H+" h":N+" d"};const y=K("span","",a.uuid,"last_updated",!0);let J="?";if(a.nnew||a.system)J="";else if(R[a.uuid].scriptUpdate=()=>{const H=y.textContent;y.textContent="";y.appendChild(z.createIcon(T.get("download"),"down",a.uuid,"spinner"));
Jb(a.uuid,M=>{y.textContent=H;M?($(y).addClass("green"),y.title=d.getMessage("There_is_an_update_for_0name0_avaiable_",a.name),q(!0),sb()):($(y).addClass("red"),y.title=d.getMessage("No_update_found__sry_"))})},a.options.check_for_updates&&a.file_url&&"none"!=a.file_url?(y.addEventListener("click",()=>{ja(a.uuid,"scriptUpdate")}),y.setAttribute("class","clickable"),y.title=d.getMessage("Check_for_Updates")):(y.setAttribute("class","greyed italic"),y.title=d.getMessage("Update_check_is_disabled")),
a.lastModified||a.lastUpdated)try{J=v(new Date,new Date(a.lastModified||a.lastUpdated))}catch(H){console.log("o: error calculating time "+H.message)}y.textContent=J;let B=K("div",a.uuid,"imported"),P="";fa.push(()=>{L.sync_enabled&&(P=a.nnew||a.system?"":a.sync&&a.sync.imported?a.sync.imported==Aa.types.eCHROMESYNC?X.RUNTIME.FIREFOX?'<img src="'+T.brand("firefox")+'" class="icon16" title="Firefox Sync"/>':'<img src="'+T.brand("chrome")+'" class="icon16" title="Google Sync"/>':a.sync.imported==Aa.types.eGDRIVE?
'<img src="'+T.brand("gdrive")+'" class="icon16" title="Google Drive"/>':a.sync.imported==Aa.types.eDROPBOX?'<img src="'+T.brand("dropbox")+'" class="icon16" title="Dropbox"/>':a.sync.imported==Aa.types.eWEBDAV?'<img src="'+T.brand("webdav")+'" class="icon16" title="WebDAV"/>':a.sync.imported==Aa.types.eYANDEX?'<img src="'+T.brand("yandex")+'" class="icon16" title="Yandex"/>':a.sync.imported==Aa.types.eONEDRIVE?'<img src="'+T.brand("onedrive")+'" class="icon16" title="OneDrive"/>':'<i class="icon16 far fa-'+
T.get("question_mark")+'" />':"",B.innerHTML=P,B=null)});v=K("span",a.uuid,"hp");if(a.origin){var I=K("a",a.uuid,"hp_origin");I.setAttribute("href",a.origin.url);I.setAttribute("target","_blank");var O=z.createImage(T.origin(a.origin.token),"",a.uuid,a.origin.token);I.appendChild(O);v.appendChild(I)}!h||a.origin&&a.origin.url===h||(I=K("a",a.uuid,"hp_script"),I.setAttribute("href",h),I.setAttribute("target","_blank"),O=z.createIcon(T.get("home"),"",a.uuid,"homepage",""),I.appendChild(O),v.appendChild(I));
R[a.uuid].saveEm_lastModTime=a.lastModified;R[a.uuid].fullReset=H=>{bb(a.uuid,null,{clean:!0,reload:!0}).done(H||(()=>{}));b.parentNode.removeChild(b)};R[a.uuid].reportAnIssue=H=>{Kb(a.uuid,H)};R[a.uuid].deleteScript=(H,M)=>{1==(M||confirm(d.getMessage("Really_delete_0name0__",a.name)))&&(bb(a.uuid,null,{reload:!M}),b.parentNode.removeChild(b))};I=[];!a.nnew&&!a.system&&a.origin&&a.origin.abuse_url&&(O=z.createIcon(T.get("flag"),"",a.uuid,"issue",d.getMessage("Report_an_issue_to_the_script_hoster_"),
()=>{ja(a.uuid,"reportAnIssue","hoster")}),I.push(O));a.nnew||a.system||!a.origin&&!a.supportURL||(O=z.createIcon(T.get("bug"),"",a.uuid,"bug",d.getMessage("Report_a_bug"),()=>{ja(a.uuid,"reportAnIssue","author")}),I.push(O));a.nnew||a.system||(a.remote_url&&(O=z.createIcon(T.get("cloud"),"",a.uuid,"cloud_edit",d.getMessage("Edit"),()=>{sendMessage({method:"newTab",url:a.remote_url},()=>{})}),I.push(O)),O=z.createIcon(T.get("edit"),"",a.uuid,"edit",d.getMessage("Edit"),()=>{ja(a.uuid,"scriptClick")}),
I.push(O));a.nnew||a.system||(O=z.createIcon(T.get("delete"),"",a.uuid,"delete",d.getMessage("Delete"),()=>{ja(a.uuid,"deleteScript")}),I.push(O));X.RUNTIME.MOBILE?k.inserted||u.addEventListener("click",()=>{$(b).toggleClass("show_details")}):k.inserted||(k.addEventListener("click",r),k.addEventListener("auxclick",r));k.appendChild(u);O=[a.name];a.description&&O.push(d.getTranslation(a,"description"));if(a.blacklisted||a.foisted)O=[a.blacklisted||a.foisted];k.title=O.join("\n\n").replace(/"/g,'"');
m.push(a.nnew||a.system?null:{element:ac(a),style:"script_sel"});m.push(n);m.push((()=>{var H=null;H=a.blacklisted||a.foisted?"enabler_warning":a.enabled?a.contexter?"enabler_enabled enabler_later":"enabler_enabled":"enabler_disabled";const M=a.blacklisted||a.foisted||(a.enabled?d.getMessage("Enabled"):d.getMessage("Disabled"));H=z.createEnabler(H,a.uuid,"enabled",{append:"enabled",disabled:!!a.blacklisted,title:M},()=>{ja(a.uuid,"switchEnabled")});R[a.uuid].switchEnabled=(N,W,ca)=>{void 0===W&&(W=
!a.enabled);ya(a.uuid,{enabled:W,whitewash:!!a.foisted},ca)};return H})());m.push({element:k,style:"script_name"});if(X.RUNTIME.MOBILE){n=(H,M,N,W)=>{const ca=p("dt","script_info "+(W?W:""),a.name,a.uuid,"dt_mapping"+M);W=p("dd","script_info "+(W?W:""),a.name,a.uuid,"dd_mapping"+M);ca.textContent=M;"string"===typeof N?W.textContent=N:W.appendChild(N);H.appendChild([ca,W])};O=p("dl","script_details",a.name,a.uuid,"script_details_dl");k.appendChild(O);n(O,d.getMessage("Version"),l);n(O,d.getMessage("Type"),
yb(a),"script_type");n(O,d.getMessage("Sites"),zb(a));var U;(U=Ab(a))&&n(O,d.getMessage("Features"),U);h&&n(O,d.getMessage("Homepage"),v);J&&n(O,d.getMessage("Last_updated"),y);m.push(f(a,I,"actions"))}else for(m.push({element:l,style:"script_version"}),m.push(yb(a)),m.push(B),m.push(zb(a)),m.push(Ab(a)),m.push(v),m.push(y),m.push(bc(a)),m.push(f(a,I,"actions")),U=m.length;10>U;U++)m.push(null);da.registerListener(a.uuid,()=>{r()});a.nnew&&fa.push(()=>{r(null,!0)});return m},yb=a=>{const b=p("span",
"script_type","",a.uuid,"pos_type",!0);if(a.nnew)return b;a.userscript&&(a=z.createImage(T.origin("uso"),"",a.uuid,"user_script",d.getMessage("This_is_a_userscript")),b.appendChild(a));return b},Ab=a=>{let b,e;let c=null;const g=[];if(a.nnew)return null;a.system&&(b=z.createIcon(T.get("lock"),"",a.uuid,"lock",d.getMessage("This_is_a_system_script")),g.push(b));a.warnings&&a.warnings.forEach((f,u)=>{b=z.createIcon(T.get("critical"),"compat",a.uuid,"warning_"+u,f);$(b).addClass("flashing");g.push(b)});
a.awareOfChrome&&(b=z.createImage("https://www.google.com/images/icons/product/chrome-16.png","",a.uuid,"chrome_mode",d.getMessage("This_script_runs_in_Chrome_mode")),g.push(b));if(a.requires.length){var m=!a.requires.filter(f=>f.modified).length;b=z.createIcon(T.get("script_download")+(m?"":" red"),"",a.uuid,"requires",G.map(G.select(a.requires,f=>f&&f.url),f=>f.url).join("\n"),()=>{da.set(a.uuid,"externals")});g.push(b)}a.resources.length&&(m=!a.resources.filter(f=>f.modified).length,b=z.createIcon(T.get("resources")+
(m?"":" red"),"",a.uuid,"resources",G.map(G.select(a.resources,f=>f&&f.url),f=>f.url).join("\n"),()=>{da.set(a.uuid,"externals")}),g.push(b));m=!1;var h={includes:!0,matches:!0};for(e in h)if(a[e]){for(h=0;h<a[e].length;h++)if(a[e][h]&&(0==a[e][h].search(/\/\^?http(s|\.\*?|s\?|\[[^\]]*s[^\]]*\]|\([^\)]*s[^\)]*\))+/)||0==a[e][h].search(/http[s\*]{1,1}|\*/))){b=z.createIcon(T.get("encrypted"),"",a.uuid,"encrypt",d.getMessage("This_script_has_access_to_https_pages"));g.push(b);m=!0;break}if(m)break}const k=
{};a.grant.forEach(f=>{k[f]=!0});k.GM_xmlhttpRequest&&(b=z.createIcon(T.get("web"),"",a.uuid,"web",d.getMessage("This_script_has_full_web_access")),g.push(b));k.GM_setValue&&(b=z.createIcon(T.get("db"),"",a.uuid,"db",d.getMessage("This_script_stores_data")),g.push(b));k.unsafeWindow&&(b=z.createIcon(T.get("windowlist"),"",a.uuid,"unsafeWindow",d.getMessage("This_script_has_access_to_webpage_scripts")),g.push(b));for(e in a.options)if(-1!=e.indexOf("compat_")&&a.options[e]){b=z.createIcon(T.get("critical"),
"compat",a.uuid,"crit",d.getMessage("One_or_more_compatibility_options_are_set"));g.push(b);break}g.length&&(c=K("span","",a.uuid,"pos_features",!0),c.appendChild(g,!0));return c},cc=(()=>{let a=null,b=null,e=null,c=0,g=0,m=0;const h=q=>{var x=e.x+q.pageX;a.style.top=e.y+q.pageY+"px";a.style.left=x+"px"};let k,f,u;const l=q=>{if(a&&!k){var x=null;let v,y,J,B;h(q);f&&(window.clearTimeout(f),f=null);for(;x!=m;)if(x=m,v=b.previousSibling,y=b.nextSibling,J=b.parentNode,B=n(b),q.pageY>B.y+c+g&&y){J.removeChild(y);
J.insertBefore(y,b);m++;var r=!1}else q.pageY<B.y&&1<m&&(J.removeChild(v),y?J.insertBefore(v,y):J.appendChild(v),m--,r=!0);x=Math.min(.03*document.documentElement.clientHeight,100);if(void 0!==r){y=r?$(v):$(y);if(y.length&&!z.isScrolledIntoView(y,{padding:x})){r=r?y.offset().top-x-y.height():y.offset().top-document.documentElement.clientHeight+x+2*y.height();k=!0;const P=r-document.body.scrollTop;$("html, body").animate({scrollTop:r},0,()=>{window.setTimeout(()=>{k=!1;f=window.setTimeout(()=>{f=null;
u===q&&l({pageX:u.pageX,pageY:u.pageY+P})},100)},100)})}q.stopPropagation&&(q.stopPropagation(),q.preventDefault());u=q;return!1}}},n=q=>{q=q.getBoundingClientRect();return{x:Math.floor(q.left+window.pageXOffset),y:Math.floor(q.top+window.pageYOffset)}},w=q=>{a.style.position="static";const x={};x[a.key]=m;ya(a.uuid,x);a=b=e=null;document.removeEventListener("mousemove",l);document.removeEventListener("scroll",l);document.removeEventListener("mouseup",w);q.stopPropagation();q.preventDefault();return!1};
return{start:function(q,x){{const r=this.parentNode.parentNode,v=r.parentNode,y=v.parentNode.parentNode;a=this;b=v;c=b.offsetHeight;g=b.offsetHeight-r.clientHeight;e=n(y);e.x=-e.x-a.offsetWidth/2;e.y=-e.y-b.offsetHeight/2+2*g;a.style.position="absolute";h(q)}m=x;document.addEventListener("mousemove",l);document.addEventListener("scroll",l);document.addEventListener("mouseup",w);q.stopPropagation();q.preventDefault();return!1}}})(),bc=a=>{const b=p("span","sorting","",a.uuid,"pos_images",!0);if(a.nnew)return b;
"pos"==wa()&&"up"==Ca()||b.setAttribute("style","display: none;");if(1<a.position||a.position<a.positionof){const e=p("span","clickable movable","position",a.uuid,!0);e.innerHTML="&#9776;";e.title=d.getMessage("Click_here_to_move_this_script");e.uuid=a.uuid;e.key="position";e.addEventListener("mousedown",function(c){cc.start.apply(this,[c,a.position])});b.appendChild(e)}return b},zb=a=>{let b=K("span","",a.uuid,"site_images"),e=null;b.inserted&&(e=b,e.setAttribute("id",e.id+"foo"),b=K("span","",a.uuid,
"site_images"));Wa.topIcons(a,7).forEach(c=>{b.appendChild(c,!0)});e&&e.parentNode.removeChild(e);return b},Nb=a=>{const b=p("div","search_filter",a.name,a.id,"filter");if(b.inserted)return b;const e=$(b);let c=null,g,m,h;const k=(r,v)=>{if(!g||r)c&&window.clearTimeout(c),l.show(),c=window.setTimeout(()=>{n=null;m=q;h=f.value;var y=document.getElementsByName("scriptselectors");const J=[];for(let B=0;B<y.length;B++)J.push(y[B]);g=!0;"matching_url"!=m&&"auto"!=m||!h.match(w.matching_url.match)?y=Z.Pledge():
(x=w.matching_url.update_interval||x,y=Db(h));y.then(B=>{const P=new RegExp(G.escapeForRegExp(h),"i"),I=new RegExp(G.escapeForRegExp(h)),O=Ta.createQueue(32),U=[],H=J.map(M=>()=>{let N,W,ca,ea;if(!(W=ra[M.s_id])||!(ca=W.script)||!(ea=W.dom)||m!=q||h!=f.value)return Z.Breach();U.push(()=>{$(ea).toggle(!!N);M.is_hidden=!N});return(()=>{if(e.is(":visible")){if("auto"==m)return Z.or(Object.keys(w).map(C=>()=>{const S=w[C];return S.check?S.check(ca,S.ignore_case?P:I,B):Z.Breach()}));{const C=w[m];if(C.check)return C.check(ca,
C.ignore_case?P:I,B)}}else return Z.Pledge();return Z.Breach()})().done(()=>{N=!0}).fail(()=>{N=!1})});return Z.sidebyside(H.map(M=>O.add(M))).always(()=>U.forEach(M=>M()))}).always(()=>{g=!1;m!=q||h!=f.value?k(!1,1):l.fadeOut()})},v||x)},f=p("input","filter_text","sms","all",null);f.setAttribute("spellcheck","false");let u="";f.inserted||f.addEventListener("keyup",()=>{u!=f.value&&(u=f.value,k())});const l=$(z.createIcon(T.get("download"),"wait_for_filter",a.uuid));l.attr("style","vertical-align: middle;");
l.hide();R.filter={onShow:function(r){k(!0);r&&$(f).focus()},onHide:function(){f.value="";k(!0,1)}};let n;const w={auto:{name:d.getMessage("Auto"),update_interval:500},name:{name:"@name",sync:function(r,v){return-1!=r.name.search(v)},ignore_case:!0},namespace:{name:"@namespace",sync:function(r,v){return r.namespace&&-1!=r.namespace.search(v)},ignore_case:!0},author:{name:"@author",sync:function(r,v){return r.author&&-1!=r.author.search(v)},ignore_case:!0},grant:{name:"@grant",default:"GM_",sync:function(r,
v){return r.grant&&0<r.grant.filter(y=>-1!=y.search(v)).length},ignore_case:!0},includes:{name:"@include/@match",sync:function(r,v){return r.includes&&0<r.includes.filter(y=>-1!=y.search(v)).length||r.matches&&0<r.matches.filter(y=>-1!=y.search(v)).length},ignore_case:!0},code:{name:d.getMessage("Source_Code"),async:function(r,v){const y=Z();if(!n){const J=Z();n=J.promise();Hb(null,{code:v.toString()},B=>{J.resolve(B)})}n.done(J=>{window.setTimeout(()=>{(J.includes(r.uuid)?y.resolve:y.reject)()},
0)});return y.promise()},ignore_case:!0},comment:{name:d.getMessage("Comment"),sync:function(r,v){return r.comment&&-1!=r.comment.search(v)},ignore_case:!0},url:{name:d.getMessage("Update_URL_"),default:"https://",sync:function(r,v){return r.file_url&&-1!=r.file_url.search(v)},ignore_case:!0},matching_url:{name:d.getMessage("Matching_URL"),update_interval:1500,default:"http://",match:/^https?:\/\/.*/,sync:function(r,v,y){return y&&y.includes(r.uuid)}}};Object.keys(w).forEach(r=>{const v=w[r];v.check=
v.sync||v.async?function(){if(v.sync)return v.sync.apply(this,arguments)?Z.Pledge():Z.Breach();if(v.async)return v.async.apply(this,arguments)}:null});let q="auto",x=w.auto.update_interval;a=z.createDropDown(d.getMessage("Filter_by"),{value:0,uuid:"sms-filter",name:"select"},Object.keys(w).map(r=>({name:w[r].name,value:r})),function(){var r=this.value;r!=q&&(q=r,x=((r=w[q])?r.update_interval:null)||w.auto.update_interval,r=(r?r.default:null)||"",f.value=f.value||r,k())});a.elem.setAttribute("class",
"label");b.appendChild(a.elem);b.appendChild(f);b.appendChild(l[0]);ua.filter&&fa.push(()=>{R.multiselect.toggleRow(!0,!0);f.value=ua.filter});return b};let pa=[];const ac=a=>{const b=K("input","",a.uuid,"sel");b.type="checkbox";b.s_id=a.uuid;b.name="scriptselectors";b.inserted||b.addEventListener("click",e=>{pa=[];b&&pa.push(b);e.ctrlKey||e.metaKey?R.multiselect.un_selectAll():R.multiselect.single_click()});return b},Mb=a=>{const b=p("input","multiselectcb","sms","all",null),e=p("div","filter multiselectcb clickable",
"sms2","all",null);b.inserted||(b.type="checkbox",b.addEventListener("click",R.multiselect.un_selectAll),e.addEventListener("click",()=>{R.multiselect.toggleRow()}));let c=0;var g=[{name:d.getMessage("__Please_choose__"),value:0},{name:d.getMessage("Enable"),value:1},{name:d.getMessage("Disable"),value:2},{name:d.getMessage("Toggle_Enable"),value:7}];(X.RUNTIME.CAN_SAVEAS_ZIP||"undefined"!==typeof Blob)&&g.push({name:d.getMessage("Export"),value:3});g=g.concat([{name:d.getMessage("Trigger_Update"),
value:5},{name:d.getMessage("Factory_Reset"),value:8},{name:d.getMessage("Remove"),value:6}]);g=z.createDropDown(d.getMessage("Apply_this_action_to_the_selected_scripts"),{value:0,uuid:"sms-select",name:"select"},g,function(){0==this.value?m.setAttribute("disabled","true"):m.removeAttribute("disabled");c=this.value});const m=z.createButton("MultiSelectButton","start_button",d.getMessage("Start"),()=>{if(0==c)console.log("option: ?!?!");else{var h=null;6==c?h=d.getMessage("Really_delete_the_selected_items_"):
8==c&&(h=d.getMessage("Really_factory_reset_the_selected_items_"));if(!h||confirm(h)){var k=document.getElementsByName("scriptselectors"),f=[];for(h=0;h<k.length;h++)f.push(k[h]);k={};var u=!1,l=100;for(h=0;h<f.length;h++)if(f[h].checked&&!f[h].is_hidden)if(1==c||2==c||7==c){var n="switchEnabled";let w;const q=ra[f[h].s_id]?ra[f[h].s_id].script:null;7==c?q&&(w=!q.enabled||!!q.foisted):2==c&&q&&q.foisted||(w=1==c);void 0!==w&&(ja(f[h].s_id,n,null,w,!1),u=!0)}else 3==c?k[f[h].s_id]=!0:5==c?(n="scriptUpdate",
ja(f[h].s_id,n)):6==c?(n="deleteScript",ja(f[h].s_id,n,null,!0),u=!0,l=1500):8==c&&(n="fullReset",ja(f[h].s_id,n),u=!0,l=1500);3==c&&(F.wait(),Ra(k,{storage:ba.script_storage,externals:ba.include_externals}).then(w=>{F.wait();return X.RUNTIME.CAN_SAVEAS_ZIP?va.zip.create(w.scripts).progress(F.wait):va.json.create(w.scripts).then(q=>new Blob([q],{type:"text/plain"}))}).then(w=>La().done(()=>{saveAs(w,"tampermonkey_scripts"+(X.RUNTIME.CAN_SAVEAS_ZIP?".zip":".txt"));ka()})).fail(()=>xa(d.getMessage("Action_failed"))).always(()=>
{F.hide()}));u&&(F.wait(d.getMessage("Please_wait___")),window.setTimeout(()=>{sb()},l))}}});m.setAttribute("class","action_button");m.setAttribute("disabled","true");g.elem.appendChild(m);a=p("div","actions",a.name,a.id,"actions");a.appendChild(g.elem);g=z.createButton("MultiSelectButton","close_button",d.getMessage("Close"),()=>{R.multiselect.toggleRow(!1)});$(g).addClass("close_button");return{selAllm:b,selAll:e,actionBox:a,close:g}};(()=>{let a=0;R.multiselect={};let b=!1;R.multiselect.toggleRow=
(e,c)=>{const g=$(".multiselect");void 0===e&&(e=!b);e?(b=!0,g.addClass("multiselectvisible"),R.filter.onShow(c)):(b=!1,g.removeClass("multiselectvisible"),R.filter.onHide(),R.multiselect.un_selectAll(!1))};R.multiselect.single_click=()=>{let e=0;const c=document.getElementsByName("scriptselectors");let g=!0,m=!1,h=0;for(let k=0;k<c.length;k++){m=!0;g=g&&c[k].checked;const f=$(c[k]).closest("tr");c[k].checked?(h++,f.addClass("selected")):f.removeClass("selected")}m&&g&&(e+=2);e!=a&&(a=e,$(".multiselectcb").prop("checked",
0!=e?"checked":""));h&&R.multiselect.toggleRow(!0);R.multiselect.checkScroll&&R.multiselect.checkScroll()};R.multiselect.un_selectAll=e=>{3<++a&&(a=0);1==a&&a++;let c=!1,g=0;const m=document.getElementsByName("scriptselectors");pa=[];!0===e&&(a=2);for(let h=0;h<m.length;h++){const k=$(m[h]).closest("tr");!1===e?(m[h].checked=!1,k.removeClass("selected")):(0==h&&3==a&&(a=0),c=!0,m[h].checked=3==a||2==a,m[h].checked?(g++,k.addClass("selected"),pa.push(m[h])):k.removeClass("selected"));g&&R.multiselect.toggleRow(!0)}void 0===
e?1<a&&!c&&(a=0):e||(a=0);$(".multiselectcb").prop("checked",0!=a?"checked":"")}})();const pb={};rea.extension.onMessage.addListener((a,b,e)=>{if("updateOptions"==a.method)L=a.options||L,oa(a.items,!1),e({});else if("confirm"==a.method)G.confirm(a.msg,c=>{e({confirm:c})});else if("showMsg"==a.method)G.alert(a.msg),e({});else if("status"==a.method)Ya(a.options),e({});else return!1;return!0});Ia.addStyle(()=>{Ub(!0);Fa({referrer:"options"},a=>{if(a.options&&a.options.layout_user_css&&"reset"!==ua.layout){const b=
document.createElement("style");b.innerHTML=a.options.layout_user_css;(document.head||document.body||document.documentElement||document).appendChild(b)}L=a.options||L;a.version&&(ib=a.version,p("div","version","version","version").textContent="v"+ib);!Va&&a.xhr&&(Va=Registry.get("xmlhttprequest"),Va.setConfig(a.xhr));a.items?(oa(a.items,!1),a.begging&&fa.push(()=>{window.setTimeout(()=>{lb(a.begging)},100)})):F.hide()})})})});
