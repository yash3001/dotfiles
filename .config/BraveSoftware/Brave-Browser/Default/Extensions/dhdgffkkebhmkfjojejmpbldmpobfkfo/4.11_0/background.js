'use strict';var trup,init,sycl,cfgo,uris,dast,perm,blak,scbr,scma,exts,down;
Registry.require("promise statistics convert xmlhttprequest downloads tools storage uri compat parser layout helper syncinfo notify asker i18n".split(" "),()=>{const B=Registry.log,C=rea.FEATURES,Ga=(()=>{const m=[];let y=!0;const p=(n,x,c)=>{const a={title:n.join("\n\n")};x.path=rea.extension.getURL("images/icon"+(x.frag?"_"+x.frag:"")+".png");B.warn(n.join("\n"));rea.browserAction.setIcon({path:x.path});rea.browserAction.setTitle(a);x=(b,d,f)=>{b={name:"1",sub_menu_item:!0,pos:"left",items:[]};
b.items.push({name:n[0],image:"info"});1<n.length&&b.items.push({name:n[1]});f({items:[b],options:{enabled:!1}})};c||rea.extension.onMessage.addListener(x)};return{run:()=>{try{Registry.verify("e1582c36").length&&(y=!1,p(["Tampermonkey detected that browser is caching some outdated code parts.","In order to avoid unexpected behavior TM will be kept paused until your browser was restarted."],{frag:"paused"}))}catch(n){y=!1,B.error(n.message)}if("chromeStorage"==C.DB.USE&&!C.DB.NO_WARNING){const n=
()=>{if(!I)return window.setTimeout(n,2E3);I.isWorking().fail(()=>{confirm("Tampermonkey detected that the extension storage is unreliable!\n\nUnfortunately this means that all your settings and userscripts are inaccessible at the moment.\n\nDo you want to visit the FAQ entry that explains how to recover from that?")&&rea.tabs.create({url:"https://www.tampermonkey.net/faq#Q206"},()=>{});p(["Tampermonkey detected that the extension storage is unreliable!"],{frag:"paused"},!0)})};window.setTimeout(n,
1E3)}return y},pause:p,setWarning:function(n,x,c){m.push({text:n,description:x,url:c})},getWarnings:function(){return m}}})();if(Ga.run()){var A=Registry.get("promise"),M=Registry.get("helper"),Pa=Registry.get("tools"),ea=Registry.get("statistics"),I=Registry.get("storage"),oa=Registry.get("notify"),ta=Registry.get("asker"),Aa=Registry.get("permission"),ia=Registry.get("layout"),O=Registry.get("uri"),l=Registry.get("i18n"),aa=Registry.get("downloads"),ba=Pa.cache,Y=Registry.get("convert");uris=O;
down=aa;perm=Aa;dast=I;var Qa=M.createUUID(),Ba={};B.debug("Starting background fred @"+Qa);ba.create("rundata").setOptions({timeout:5,check_interval:10,retimeout_on_get:!0}).init();ba.create("regexp").setOptions({timeout:300,check_interval:120,retimeout_on_get:!0}).init();var Xa=()=>{const m=A();let y,p;const n=rea.extension.manifest.version,x=I.getSchemaVersion();let c=x;I.getVersion("0.0.0.0").then(a=>{p=a;y=U.versionCmp(n,p)==U.versionCmp.eNEWER;return I.isWiped()}).then(function(a){!y&&a&&(a=
["Tampermonkey detected inconsistencies that indicate that your browser wiped the extension database!","You can continue to use Tampermonkey normally, but your settings and scripts might be lost. Click here to get more information.","https://www.tampermonkey.net/faq.php#Q207"],B.warn(a.join("\n")),Ga.setWarning.apply(this,a))}).always(()=>{let a=[],b=0;const d=()=>{if(b<a.length){const k=a[b].schema;a[b].cond(k)?a[b].fn().done(()=>{k&&(B.info("Converted database from",c,"to",k),c=k);b++;d()}).fail(()=>
{m.reject()}):(b++,d())}},f=()=>{B.warn("Incognito mode detected. Database conversion can only be done in non-incognito mode! Stopping now...");Ga.pause(["Tampermonkey needs to convert its database but this can't be done in incogonito mode!","Please open a non-incognito mode window and/or restart your browser."],{frag:"paused"})};a=[{cond:function(){return y&&!C.RUNTIME.FIREFOX&&!C.RUNTIME.EDGE&&"chromeStorage"==C.DB.USE&&!I.getValue(C.CONSTANTS.STORAGE.LEGACY_VERSION)&&U.versionCmp("3.5.3603",p)==
U.versionCmp.eNEWER},fn:function(){const k=A();rea.extension.inIncognitoContext?(f(),k.reject()):(B.info("Update database..."),c="3.5.3603",I.migrate("sql","chromeStorage").done(()=>{B.info("Copied config for default usage of chrome storage");k.resolve()}).fail(()=>{k.resolve()}));return k.promise()}},{cond:function(){return y&&U.versionCmp("3.6.3650",c)==U.versionCmp.eNEWER&&U.versionCmp("3.5.3650",p)==U.versionCmp.eNEWER},fn:function(){const k=A();if(rea.extension.inIncognitoContext)f(),k.reject();
else{c="3.6.3650";const g=[];[{o:"TM_config",n:C.CONSTANTS.STORAGE.CONFIG},{o:"TM_update_check",n:C.CONSTANTS.STORAGE.UPDATE},{o:"TM_version"},{o:"TM_unload_ts"}].forEach(q=>{if(q.n){const u=I.getValue(q.o);void 0!==u&&g.push(I.setValue(q.n,u))}g.push(I.deleteValue(q.o))});let h=/@re$/;const v=[];I.listValues().forEach(q=>{-1!=q.search(h)&&(q=q.replace(h,""),v.push(q))});v.forEach(q=>{const u=I.getValue(q+"@st"),e=I.getValue(q),r=I.getValue(q+"@re"),t=I.getValue(q+"@source"),z=Q.getUidByName(q)||
M.createUUID();g.push(I.deleteValue(q+"@st"));g.push(I.deleteValue(q));g.push(I.deleteValue(q+"@re"));g.push(I.deleteValue(q+"@source"));e&&r&&t?(g.push(I.setValue(C.CONSTANTS.PREFIX.SCRIPT_UID+z,q)),g.push(I.setValue(C.CONSTANTS.PREFIX.COND+z,r)),g.push(I.setValue(C.CONSTANTS.PREFIX.STORE+z,u)),g.push(I.setValue(C.CONSTANTS.PREFIX.SCRIPT+z,t)),g.push(I.setValue(C.CONSTANTS.PREFIX.META+z,e))):B.warn("invalid script entry",{source:t,meta:e,cond:r})});h=/@st$/;I.listValues().forEach(q=>{-1!=q.search(h)&&
g.push(I.deleteValue(q))});A.when(g).done(()=>{B.info("Converted database from",p,"to",c);k.resolve()})}return k.promise()}},{schema:"3.7.0",cond:function(k){return U.versionCmp(k,c)==U.versionCmp.eNEWER},fn:function(){const k=A();if(rea.extension.inIncognitoContext)f(),k.reject();else{const g=[],h=new RegExp("^"+C.CONSTANTS.PREFIX.META);I.listValues().forEach(v=>{if(-1!=v.search(h)){var q=I.getValue(v);q.options&&q.options.override&&!q.options.override.orig_run_at&&(q.options.override.orig_run_at=
q.options.run_at||"document-idle",q.options.run_at=null,g.push(I.setValue(v,q)))}});A.when(g).done(()=>{k.resolve()})}return k.promise()}},{schema:"4526",cond:function(k){return y&&C.RUNTIME.SAFARI&&"chromeStorage"==C.DB.USE&&U.versionCmp(k,c)==U.versionCmp.eNEWER},fn:function(){const k=A();if(rea.extension.inIncognitoContext)f(),k.reject();else{B.info("Update database...");const g=I.migrate("localStorage","chromeStorage").done(()=>{B.info("Copied config for default usage of setting storage")}).fail(()=>
{k.resolve()});k.consume(g)}return k.promise()}},{schema:"4871",cond:function(k){return y&&U.versionCmp(k,c)==U.versionCmp.eNEWER},fn:function(){const k=A();let g,h;const v=I.getValue(C.CONSTANTS.STORAGE.CONFIG);v&&v.scriptTemplate&&(h=w.getDefaults())&&(g=h.script_templates)&&g[0]&&g[0].value&&(g[0].value=v.scriptTemplate,delete v.scriptTemplate,I.setValue(C.CONSTANTS.STORAGE.CONFIG,v));k.resolve();return k.promise()}},{schema:"5465",cond:function(k){return U.versionCmp(k,c)==U.versionCmp.eNEWER},
fn:function(){const k=A();if(rea.extension.inIncognitoContext)f(),k.reject();else{const g=I.getValue(C.CONSTANTS.STORAGE.CONFIG);g&&1==g.sync_version&&(g.sync_enabled=!1,I.setValue(C.CONSTANTS.STORAGE.CONFIG,g));k.resolve()}return k.promise()}},{cond:function(){return y||U.versionCmp(c,x)==U.versionCmp.eNEWER},fn:function(){const k=A();I.setVersion(n,c).done(()=>{k.resolve()});return k.promise()}},{cond:function(){return y},fn:function(){B.info("First run of version "+n+"!");Ca.scheduleNotification(p,
"0.0.0.0"==p);return A.Pledge()}},{cond:function(){return!0},fn:function(){const k=A();m.resolve();window.setTimeout(k.resolve,C.MISC.TIMEOUT);return k.promise()}}];d()});return m.promise()},qa=(()=>({get:function(m,y){const p=(0==m)+"#"+y;var n=ba.items.rundata.getj(p);if(n)n=n.oldret;else{n=[];const x=[],c=[],a={};if(y){const b=L.determineScriptsToRun(y,!0);for(let d=0;d<b.length;d++){const f=b[d];L.isContexter(f)||0!=m&&(!0===f.options.noframes||null===f.options.noframes&&!0===f.options.override.orig_noframes)||
(f.evilness&&f.evilness>=Math.min(Z.SEVERITY_MAX,w.values.script_blacklist_severity)?c.push(f):f.enabled?(a[f.uuid]=y,n.push(f)):x.push(f))}}n={runners:n,disabled:x,evilness:c,script_map:a};y&&ba.items.rundata.setj(p,{frameId:m,oldret:n})}return n},answer:function(m,y){m=M.select(m,n=>n);const p=[{m:"native",t:[aa.staticVars.DEFAULT,aa.staticVars.NATIVE]},{m:"disabled",t:[aa.staticVars.OFF]},{m:"browser",t:[aa.staticVars.CHROME]}].filter(n=>{if(n.t.includes(w.values.downloads_mode))return!0}).map(n=>
n.m)[0]||"disabled";y=!rea.extension.inIncognitoContext&&"off"!=w.values.external_connect&&L.validUrl(y,Ra.externally_connectable_reg);return{scripts:m,contexters:Da.getContexterCount(),raw:{},external_connect:y,isFirstPartyIsolation:la.fpi,downloadMode:p,enforce_strict_mode:"on"==w.values.runtime_strict_mode,statistics:ea.isActive("api"),measure_scripts:w.values.debug,logLevel:w.values.logLevel,version:rea.extension.manifest.version}},getContexters:function(m,y){const p=[];y=L.determineScriptsToRun(y);
for(let n=0;n<y.length;n++){const x=y[n];x.enabled&&(0==m||!0!==x.options.noframes&&(null!==x.options.noframes||!0!==x.options.override.orig_noframes))&&L.isContexter(x)&&p.push(x)}return p}}))(),T=(()=>{const m={};let y=1;const p=y++,n=y++,x=y++,c=y++,a=y++,b=y++,d=y++,f=()=>{const e={frames:{0:{state:p}},tabs:{reset_ts:Date.now()},scripts:{},urls:{},maps:{},contexts:{onUnload:{}},stats:{running:0,disabled:0},extra:{}};Object.defineProperties(e.urls,{length:{value:0,enumerable:!1,writable:!0,configurable:!0}});
return e},k={updateStats:function(e,r,t,z){m[e].stats.running+=t;m[e].stats.disabled+=z;m[e].contexts.onUnload[r]=m[e].contexts.onUnload[r]||[];m[e].contexts.onUnload[r].push(()=>{m[e].stats.running-=t;m[e].stats.disabled-=z});m[e].tabs.ts=Date.now()},updateMaps:function(e,r,t){let z=1;const D=(E,F)=>{const N=1===z;void 0===m[e].maps[F]&&N&&(m[e].maps[F]={count:0,all_time:0,urls:[]});N&&(m[e].maps[F].urls.push(E),m[e].maps[F].all_time++);m[e].maps[F].count+=z};M.each(t,D);m[e].contexts.onUnload[r]=
m[e].contexts.onUnload[r]||[];m[e].contexts.onUnload[r].push(()=>{m[e]&&(z=-1,M.each(t,D))})},updateUrls:function(e,r,t){const z=D=>{1===D&&(void 0===m[e].urls[t]?m[e].urls[t]={frameId:r,count:0}:0===r&&(m[e].urls[t].frameId=r));m[e].urls[t].count+=D;m[e].urls.length=-1};z(1);m[e].contexts.onUnload[r]=m[e].contexts.onUnload[r]||[];m[e].contexts.onUnload[r].push(()=>{m[e]&&z(-1)})},determine:function(e,r,t){let z;pa.isAllowed(t)?z=qa.get(r,t):(B.log("This URL is filtered by the security settings:",
t,"-> Do nothing!"),T.set.forbidden(e,r),z={runners:[],disabled:[],evilness:[],script_map:{}});m[e].scripts[t]=z;z.runners.forEach(D=>{D.webRequest&&ua.scripts.set(e,r,D.uuid,D.webRequest)});return z.runners.length},run:function(e,r,t,z,D){e=[];for(r=0;r<z.length;r++)e.push(Sa.bundle({url:t},z[r]));let E;A.when(e).always(F=>{D?D(F):E=F});return E}},g={},h={},v={},q={},u={listeners:{once:{whenReady:function(e,r){if(!m[e]||m[e].frames[0].state<x)u.listeners.once.onReady(e,r);else r()},onReady:function(e,
r){var t=u.listeners.add.onCommited(D=>{D===e&&(u.listeners.remove.onCommited(t),u.listeners.remove.onCompleted(z),r())}),z=u.listeners.add.onCompleted(D=>{D===e&&(u.listeners.remove.onCommited(t),u.listeners.remove.onCompleted(z),r())})}},add:{onReset:function(e){const r=M.createUUID();g[r]=e;return r},onCommited:function(e){const r=M.createUUID();h[r]=e;return r},onCompleted:function(e){const r=M.createUUID();v[r]=e;return r},onRemoved:function(e){const r=M.createUUID();q[r]=e;return r}},remove:(()=>
({onReset:function(e){delete g[e]},onCommited:function(e){delete h[e]},onCompleted:function(e){delete v[e]},onRemoved:function(e){delete q[e]}}))()},events:{reset:function(e,r){let t;C.RUNTIME.FAST_EXEC_SUPPORT&&(t=m[e])&&Object.keys(t.frames).forEach(z=>{u.events.clean(e,z)});t=m[e]=f();t.frames[0].state=p;M.each(g,z=>{z&&z(e,r)})},response:function(e,r,t){if(w.values.enabled){var z=m[e]=m[e]||f(),D=z.frames[r]=z.frames[r]||{},E=D.state||p;0===r&&(z.tabs.response_ts=Date.now());t=O.woHash(t);E<n&&
(k.determine(e,r,t),D.state=n);return(e=z.scripts[t])?e.runners.length:0}},commited:function(e,r,t){if(w.values.enabled){var z=O.parse(t);if("http:"===z.protocol||"https:"===z.protocol||"file:"===z.protocol){z=m[e]=m[e]||f();z=z.frames[r]=z.frames[r]||{};var D=z.state||p;D>=x||(z.state=x,D<n&&(t=O.woHash(t),k.determine(e,r,t)),M.each(h,E=>{E&&E(e)}))}}},loading:function(e,r,t){if(w.values.enabled){var z=O.parse(t);if(("http:"===z.protocol||"https:"===z.protocol||"file:"===z.protocol)&&0===r&&"file:"===
z.protocol){z=m[e]=m[e]||f();z.frames[r]=z.frames[r]||{};const D=z.frames[r].state||p;D>=c||(z.frames[r].state=c,D<n&&(t=O.woHash(t),k.determine(e,r,t)))}}},run:function(e,r,t,z,D){if(w.values.enabled){var E=0===r||C.RUNTIME.FAST_EXEC_SUPPORT?r:t,F=m[e]=m[e]||f();F.frames[E]=F.frames[E]||{};var N=O.woHash(z),G=F.scripts[N];if(!G&&(B.log("tv: lazy init @ events.run("+e+", "+r+", "+t+", "+z+")"),k.determine(e,r,N),G=F.scripts[N],!G)){B.warn("tv: no script run info for tab "+e+" @ "+N,B.D?F.scripts:
"");return}t=F.frames[E].state;F.frames[E].state=a;t!=a&&(k.updateMaps(e,E,G.script_map),k.updateUrls(e,E,N),k.updateStats(e,E,G.runners.length,G.disabled.length));return k.run(e,r,N,G.runners,D?H=>{u.events.clean(e,E,z);D(H)}:null)}},clean:function(e,r,t){if(w.values.enabled){var z,D;if(z=m[e])t&&(t=O.woHash(t),delete z.scripts[t]),(D=T.get.objurl(e,r))&&URL.revokeObjectURL(D)}},complete:function(e,r,t){t=O.parse(t);if(w.values.enabled&&("http:"===t.protocol||"https:"===t.protocol||"file:"===t.protocol)){if(0===
r){const z=m[e]=m[e]||f();z.frames[r]=z.frames[r]||{};const D=z.frames[r].state||p;z.frames[r].state=b;if(!T.get.empty(e)&&T.get.stats(e).running){if(D<a){B.warn("tv: no script run info!");return}"file:"===t.protocol?window.setTimeout(()=>{rea.tabs.sendMessage(e,{method:"onLoad"},{frameId:r})},500):rea.tabs.sendMessage(e,{method:"onLoad"},{frameId:r})}}M.each(v,z=>{z&&z(e)})}},unload:function(e,r,t){t=0===r||C.RUNTIME.FAST_EXEC_SUPPORT?r:t;C.RUNTIME.FAST_EXEC_SUPPORT&&u.events.clean(e,r);e=m[e]=m[e]||
f();e.frames[t]=e.frames[t]||{};e.frames[t].state=d;if(e.contexts.onUnload[t]){for(r=0;r<e.contexts.onUnload[t].length;r++)e.contexts.onUnload[t][r]();e.contexts.onUnload[t]=[]}delete e.frames[t]},remove:function(e){let r;C.RUNTIME.FAST_EXEC_SUPPORT&&(r=m[e])&&Object.keys(r.frames).forEach(t=>{u.events.clean(e,t)});delete m[e];M.each(q,t=>{t&&t(e)})}},set:{extra:function(e,r,t,z){e=m[e]=m[e]||f();null===r?e.extra[t]=z:(e.extra[t]=e.extra[t]||{},e.extra[t][r]=z)},objurl:function(e,r,t){u.set.extra(e,
r,"objurl",t)},blocker:function(e){u.set.extra(e,null,"blocker",!0)},forbidden:function(e,r){0===r&&u.set.extra(e,null,"forbidden",!0)},requests:function(e,r,t,z){e=m[e]=m[e]||f();r=e.frames[r]=e.frames[r]||{};(r.requests=r.requests||{})[t]=z}},get:{extra:function(e,r,t,z,D){void 0===z&&(z=null);e=(m[e]?m[e].extra:{})[t];null!==r&&e&&D&&delete e[r];return e||z},empty:function(e){let r=!0;if(m[e]&&0!=m[e].urls.length){if(-1==m[e].urls.length)return m[e].urls.length=0,M.each(m[e].urls,(t,z)=>{"length"!==
z&&0<t.count&&m[e].urls.length++}),u.get.empty(e);r=!1}return r},urls:function(e,r){let t;return r?(t=m[e].maps[r])?t.urls:[]:(t=m[e])?t.urls:{}},history:function(e){return m[e].maps},stats:function(e,r){const t={};m[e]&&(t.running=m[e].stats.running,t.disabled=m[e].stats.disabled,r&&(t.unique=0,Object.keys(m[e].maps).forEach(z=>{0<m[e].maps[z].count&&t.unique++})));return t},tabs:function(){const e={};M.each(m,(r,t)=>{e[t]={ts:r.response_ts}});return e},objurl:function(e,r){return u.get.extra(e,
r,"objurl",null,!0)},blocker:function(e){return u.get.extra(e,null,"blocker")},forbidden:function(e){return u.get.extra(e,null,"forbidden")},requests:function(e,r){return m[e]&&m[e].frames[r]?m[e].frames[r].requests:null}}};return u})(),Ha=(()=>{const m={};return{get:function(y,p){m[y]||(m[y]={});m[y][p]||(m[y][p]={});return m[y][p]},getAll:function(y){const p={};Object.keys(m).forEach(n=>{p[n]={};p[n]=m[n][y]});return p},set:function(y,p,n){m[y]||(m[y]={});const x={};n&&Object.keys(n).forEach(c=>
{x[c]=n[c]});m[y][p]=x},cleanTab:function(y){delete m[y]}}})(),Ia=(()=>({isScriptUrl:function(m,y){if(!m||-1!=m.search(/#bypass=true/)||-1!=m.search(C.REQUESTS.GET_INTERNAL_PAGE_REGEXP())||!["https:","http:","file:","ftp:"].some(n=>m.startsWith(n)))return!1;y=y?m:m.split(/[\?#$]/)[0];const p=-1!=y.search(/[^/]{1}\.user\.(js#|js\?|js$)/)||-1!=y.search(/[^/]{1}\.tamper\.(js#|js\?|js$)/);return p?!(-1!=y.search(/^htt[ps]{1,2}:\/\/code\.google\.com/)||-1!=y.search(/^htt[ps]{1,2}:\/\/(github|gitlab)\.com/)&&
!L.determineOriginOfUrl(y)||-1!=y.search(/^htt[ps]{1,2}:\/\/bitbucket\.org/)&&!L.determineOriginOfUrl(y)):p}}))(),pa=(()=>({init:function(){const m=()=>{ba.items.regexp.remove("PageFilter")};w.addChangeListener("forbiddenPages",m);w.addChangeListener("page_whitelist",m);w.addChangeListener("page_filter_mode",m)},isAllowed:function(m){let y=!1,p=!1;var n=ca.getSyncRemoteDomains().map(a=>"*://"+a+"/*");n=w.values.forbiddenPages.concat(n);var x=0<n.length;const c=0<w.values.page_whitelist.length;switch(w.values.page_filter_mode){case "black":p=
x;break;case "off":break;case "white":y=c;break;default:y=c,p=x}(x=ba.items.regexp.get("PageFilter"))||(x=L.regexify({inc:y?w.values.page_whitelist:void 0,exc:p?n:void 0}),ba.items.regexp.set("PageFilter",x));return!p&&!y||L.validUrl(m,x)}}))(),Z=(()=>{const m=(p,n)=>{if(n.length)return(p="/"==n.substr(0,1)?L.matchUrl(p,L.convertToRegExp(n)):-1!=p.indexOf(n))&&B.log('black: entry "'+n+'" matched'),p},y={SEVERITY_MAX:10,SEVERITY_MANUALLY_DEFINED:11,SEVERITY_FOISTED_SCRIPT:12,init:function(){const p=
A(),n=()=>{"server"===w.values.script_blacklist_type&&window.setTimeout(y.checkUpdate,2E4)};n();w.addChangeListener("script_blacklist_type",n);p.resolve();return p.promise()},getWarningsFor:function(p){const n=[];p&&M.each(w.values.script_blacklist_server,x=>{if(x){var c;M.each(x.rules,a=>{c|=m(p,a);return 1!=c});if(c)if(x.reasons){const a=Object.keys(x.reasons);let b,d;void 0!==(b=l.getBestLocale(a))&&(d=a[b]);n.push(x.reasons[d||"en"])}else x.reason&&n.push(x.reason)}});return n},getEvilnessOf:function(p){if("off"===
w.values.script_blacklist_type)return!1;if(!p)return 0;let n=!1,x=0;M.each(w.values.require_blacklist,c=>{n|=m(p,c);return 1!=n});n?x=y.SEVERITY_MANUALLY_DEFINED:"server"===w.values.script_blacklist_type&&M.each(w.values.script_blacklist_server,c=>{if(c&&(M.each(c.rules,a=>{n|=m(p,a);return 1!=n}),n))return x=c.severity,!1});return Number(x)},checkUpdate:function(p){const n=A();let x=va.getConfig(),c;if(p||6048E5<Date.now()-x.black.last){const a=(b,d)=>{const f=A();wa.internal({method:"GET",url:b,
nocache:d,retries:C.XMLHTTPREQUEST.RETRIES,overrideMimeType:"text/plain; charset=x-user-defined"},{ondone:function(k){f.resolve(k)}});return f.promise()};a("https://blacklist.tampermonkey.net/get.php?version=get").then(b=>{if(4==b.readyState&&200==b.status){try{c=JSON.parse(b.responseText).version}catch(d){B.warn("black: unable to parse version response! "+b.responseText)}B.info("black: local version: "+x.black.version+" remote: "+c);if(c>x.black.version||p)return a("https://blacklist.tampermonkey.net/get.php",
!0)}}).then(b=>{if(b&&4==b.readyState&&200==b.status)try{const d=JSON.parse(b.responseText);d&&d.blacklist&&1==d.version&&(w.values.script_blacklist_server=d.blacklist);B.info("black: updated blacklist to ",d)}catch(d){B.warn("black: blacklist update failed! ",b.responseText)}}).always(()=>{x=va.getConfig();x.black.last=Date.now();x.black.version=c||x.black.version;va.setConfig(x);n.resolve()})}else n.resolve();return n.promise()}};return y})();blak=Z;var ca=(()=>{let m=0;const y=[],p={to:null,force:null,
t:0},n={},x=Pa.createQueue(1),c={},a=q=>x.add(()=>{B.log("sync: import",q.uuid,q.name,q.url);const u={imported:w.values.sync_type},e={};for(const z in v.SYNCED)!0===v.SYNCED[z]&&(e[z]=q.options[z]);const r={uuid:q.uuid,ask:!1,internal:!0,sync:u,force_meta:{lastModified:q.lastModified,fileURL:q.url},force_options:e},t={silent_fail:!0};return(()=>V.caps.syncsSource?V.getSource(q.uuid).then(z=>L.installFromSource(z,r,t)):L.installFromUrl(q.url,r,t))().then(()=>{ba.items.rundata.removeAll()})}),b=(q,
u)=>x.add(()=>{if(!V.caps.syncsSource){let e;if(!q.url||!(e=O.parse(q.url))||!e.protocol.match(/https?:/))return B.log("sync: skip export due to missing URL",q.name,q.url),A.Pledge(!1)}B.log("sync: export",q.name,q.url);return V.setMeta(q,{lastModified:q.lastModified}).then(()=>{if(V.setSource&&u)return V.setSource(q.uuid,u)}).then(()=>!0)}),d=q=>{var u=q.downloadURL?q.downloadURL.split("#")[0]:null;const e=q.fileURL?q.fileURL.split("#")[0]:null,r=M.select([e,u],t=>{if(!t||"file:"!==O.parse(t).protocol)return t})[0];
u={uuid:q.uuid,name:q.name,options:{},durl:u,furl:e,url:r,lastModified:q.lastModified||q.lastUpdated};for(const t in v.SYNCED)!0===v.SYNCED[t]&&null!==q.options[t]&&(u.options[t]=q.options[t]);return u},f=()=>{const q=[];Q.getUidList().forEach(u=>{u=Q.getByUid(u);if(u.script&&u.cond){const e=d(u.script);e.lastModified||Registry.isDevVersion("test")?u.script.evilness&&u.script.evilness>=Math.min(Z.SEVERITY_MAX,w.values.script_blacklist_severity)?B.warn("sync: ignore evil script",u.script):q.push(e):
B.warn("sync: script without updated/modified timestamps found",u.script)}});return q},k=q=>{if(v.enabled)if(0<m)q&&v.addSyncDoneCallback(H=>{H&&v.sync(50,q)});else{m++;var u=null,e=null,r=0,t=0,z=!0,D=H=>{if(H)for(let J=0;J<e.length;J++)if(e[J].uuid==H)return e[J];return null},E=H=>{if(!H)return null;for(let J=0;J<u.length;J++)if(u[J].uuid==H)return u[J]},F=(H,J,K)=>K?Math.floor(H/K)*K>Math.floor(J/K)*K:H>J,N=(H,J,K)=>K?Math.floor(H/K)*K<Math.floor(J/K)*K:H<J,G=(H,J,K)=>K?Math.floor(H/K)*K!=Math.floor(J/
K)*K:H!=J;fa.all("status",{key:"sync_status",class:"information",title:l.getMessage("Script_Sync"),text:l.getMessage("Sync_is_running"),timeout:9E5});return A.Pledge().then(()=>{u=f();return V.list().done(H=>{e=H}).fail(()=>{B.warn("sync: unable to get remotelist!")})}).then(()=>{const H=e.map(J=>{let K;const X=E(J.uuid);let R,S;if(X){if(!J.lastModified&&w.values.sync_type==V.types.eCHROMESYNC)for(const P in v.SYNCED)if(!0===v.SYNCED[P]&&X.options[P]!=J.options[P]){B.log("sync: importable change detected!",
J.name,"key:",P,J);R=!0;break}J.lastModified&&N(X.lastModified,J.lastModified,J.precision)&&(S=J.lastModified,R=!0,B.log("sync: importable change detected!",J.name,"local ts:",new Date(X.lastModified),"remote ts:",new Date(J.lastModified),J))}else(K=c[J.uuid])&&J.lastModified&&N(K.lastModified,J.lastModified,J.precision)&&(S=J.lastModified,R=!0,B.log("sync: changed cache entry detected!",J.name,"local ts:",new Date(K.lastModified),"remote ts:",new Date(J.lastModified),J));if(!X&&!K||R)return()=>A.Pledge().then(()=>
V.caps.specialMeta?V.getMeta(J.uuid):A.Pledge(J)).then(P=>{if(P){var da;if(X)if(P.options.removed)r++,B.log("sync: remove local script",P.uuid,P.name,P.url),L.doRemove(X.uuid,!1);else{if(R)return G(S,P.lastModified,P.precision)&&(P.lastModified&&B.warn("sync: list and meta data lastModified differ, this will cause extra traffic!","file ts:",new Date(S),"meta ts:",new Date(P.lastModified),P),P.lastModified=S),r++,B.log("sync: update local script",P.uuid,P.name,P.url),A.Pledge().then(()=>{if(V.caps.syncsSource){const ja=
A();V.getSource(P.uuid,null).then(ra=>ra?L.doSave({uuid:P.uuid,src:ra,ask:!1,internal:!0,save:!0}):A.Breach()).fail(()=>{B.warn("sync: getting source of",P.uuid,"failed",P)}).always(ja.resolve);return ja.promise()}}).then(()=>{const ja=Q.getByUid(X.uuid);for(da in v.SYNCED)!0===v.SYNCED[da]&&(ja.script.options[da]=P.options[da]);ja.script.lastModified=P.lastModified;return L.doModify(ja.script.uuid,ja.script,!1)})}else if(X||P.options.removed)!K&&P.options.removed&&(c[P.uuid]=P);else{const ja=A();
if(P.url&&n[P.url]||P.uuid&&n[P.uuid])B.warn("sync: skip previously failed import",P);else return a(P).done(ra=>{ra?r++:(B.warn("sync: unable to import",P),n[P.url]=!0,n[P.uuid]=!0)}).fail(()=>{B.warn("sync: unable to load",P);n[P.url]=!0;n[P.uuid]=!0}).always(ja.resolve),ja.promise()}}})}).filter(J=>J);return A.onebyone(H)}).then(()=>{r&&(L.reorderScripts(),fa.all("status",{key:"sync",class:"information",title:l.getMessage("Script_Sync"),text:l.getMessage("0count0_changes_imported",r),timeout:1E4}));
u=f();return A.Pledge()}).then(()=>{const H=[];for(let J=0;J<u.length;J++)H.push((()=>{const K=u[J];let X;if(!V.caps.syncsSource&&!K.url)return A.Pledge();const R=D(K.uuid);if(R){if(!R.lastModified||F(K.lastModified,R.lastModified,R.precision)){var S=!0;B.log("sync: exportable change detected!",K.name,"remote ts:",new Date(R.lastModified),"local ts:",new Date(K.lastModified),K)}}else B.log("sync: export because remotely missing!",K.name,"local ts:",new Date(K.lastModified),K);return!R||S||V.caps.syncsSource&&
!R.source?(V.caps.syncsSource&&(S=Q.getByUid(K.uuid),S.script&&S.cond&&(X=S.script.textContent)),b(K,X).then(P=>{P&&t++})):A.Pledge()})());return A.when(H)}).fail(()=>{z=!1}).done(()=>{z=!0}).always(()=>{B.log("sync: finished");if(0==--m){fa.all("status",{key:"sync_status",class:"information",title:l.getMessage("Script_Sync"),text:l.getMessage("Sync_finished"),timeout:15E3});t&&fa.all("status",{key:"sync",class:"information",title:l.getMessage("Script_Sync"),text:l.getMessage("0count0_changes_exported",
t),timeout:5E3});for(var H=z;y.length;)y.shift()(H)}})}},g=()=>{v.enabled&&v.sync(500,!0)};let h=null;var v={enabled:!1,SYNCED:{comment:!0},configChangeListener:function(){h||(h=window.setTimeout(()=>{h=null;v.init().done(()=>{v.enabled&&v.sync(3E3)})},3E3))},init:function(){const q=A();v.enabled=!1;(()=>{if(w.values.sync_enabled&&w.values.sync_type){let u;w.values.sync_type==V.types.eWEBDAV&&(u={url:w.values.cloud_url,basic_auth:Y.Base64.encode(w.values.cloud_user+":"+w.values.cloud_pass)});return V.init(w.values.sync_type,
u).done(e=>{v.enabled=e;v.enabled?V.addChangeListener(g):B.warn("sync: init failed!")}).fail(()=>{B.warn("sync: init failed!")})}return A.Pledge()})().always(()=>{q.resolve(v.enabled)});return q.promise()},finalize:function(){},reset:function(){return v.enabled?V.reset():A.Breach()},addSyncDoneCallback:function(q){y.push(q)},sync:function(q,u){const e=Date.now();q=q||500;u=p.force||u;p.to?(window.clearTimeout(p.to),p.ts<e+q&&(q=p.ts-e,1>q&&(q=1))):B.log("sync: schedule sync for run in "+q+" ms");
p.force=u;p.ts=e+q;p.to=window.setTimeout(()=>{k(p.force);p.to=null;p.force=null},q)},scriptAddedCb:function(q,u){v.enabled&&(q=d(u),b(q,u.textContent))},scriptChangedCb:function(){v.enabled&&v.sync(6E4)},scriptRemovedCb:function(q,u){v.enabled&&(q=d(u),B.log("sync: remove",q.name,q.url),V.remove(q))},getSyncRemoteUrl:function(q){if(v.enabled)return V.getRemoteUrl(q)},getSyncRemoteDomains:function(){return V.getRemoteDomains()||[]}};return v})();sycl=ca;var Ya=()=>{w.addChangeListener(["sync_enabled",
"sync_type","cloud_url","cloud_user","cloud_pass"],ca.configChangeListener);w.addChangeListener("logLevel",()=>{B.set(w.values.logLevel)});w.addChangeListener("i18n",()=>{l.setLocale(w.values.i18n)});w.addChangeListener("incognito_mode",()=>{Ta()});w.addChangeListener("statistics_enabled",()=>{ea.setEnabled(w.values.statistics_enabled,!0)});w.addChangeListener(["require_blacklist","script_blacklist_server","script_blacklist_type"],L.blackCheckAll);w.addChangeListener(["downloads_extension_whitelist",
"downloads_mode"],aa.config_changed_listener);w.addChangeListener("webrequest_modHeaders",(m,y,p,n)=>{n.done(window.setTimeout(sa.reset,1))});w.addChangeListener(["appearance_badge_color","appearance_badge_text_color"],ka.init)},w=(()=>{const m={},y={enabled:!0,configMode:0,debug:!1,logLevel:0,showFixedSrc:!1,webrequest_modHeaders:"yes",webrequest_fixCSP:"yes",webrequest_fixContentCSP:"no",notification_showUpdate:"changelog",notification_silentScriptUpdate:!0,script_templates:[{name:"ECMAScript 5",
value:"// ==UserScript==\n// @name         New Userscript\n// @namespace    http://tampermonkey.net/\n// @version      0.1\n// @description  try to take over the world!\n// @author       You\n// @match        <$URL$>\n// @grant        none\n// ==/UserScript==\n\n(function() {\n    'use strict';\n\n    // Your code here...\n})();"},{name:"ECMAScript 6",value:'// ==UserScript==\n// @name         New ES6-Userscript\n// @namespace    http://tampermonkey.net/\n// @version      0.1\n// @description  shows how to use babel compiler\n// @author       You\n// @require      https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.18.2/babel.js\n// @require      https://cdnjs.cloudflare.com/ajax/libs/babel-polyfill/6.16.0/polyfill.js\n// @match        <$URL$>\n// ==/UserScript==\n\nvar inline_src = (<><![CDATA[\n\n    // Your code here...\n\n]]\x3e</>).toString();\nvar c = Babel.transform(inline_src, { presets: [ "es2015", "es2016" ] });\neval(c.code);'},
{name:"CoffeeScript",value:"// ==UserScript==\n// @name         New Coffee-Userscript\n// @namespace    http://tampermonkey.net/\n// @version      0.1\n// @description  shows how to use coffeescript compiler\n// @author       You\n// @require      http://coffeescript.org/browser-compiler/coffeescript.js\n// @match        <$URL$>\n// ==/UserScript==\n\nvar inline_src = (<><![CDATA[\n\n    // Your code here\n\n]]\x3e</>).toString();\nvar compiled = this.CoffeeScript.compile(inline_src);\neval(compiled);"}],
scriptUpdateCheckPeriod:864E5,scriptUpdateHideNotificationAfter:15E3,scriptUpdateCheckDisabled:!1,scriptUrlDetection:"auto",script_file_access:C.RUNTIME.FIREFOX?"off":"externals",runtime_strict_mode:"byscript",runtime_inject_mode:"default",autoReload:!1,appearance_badges:"running",appearance_badge_color:"gcal"===rea.runtime.short_id?"#444":"#ee3131",appearance_badge_text_color:"#ffffff",editor_enabled:!0,editor_fontSize:100,editor_theme:"default",editor_keyMap:"windows",editor_indentUnit:4,editor_tabSize:4,
editor_indentWithTabs:"spaces",editor_tabMode:"indent",editor_electricChars:!0,editor_autoSave:!1,editor_easySave:!0,editor_autoLint:!0,editor_autoLintMaxLen:3E5,editor_lineWrapping:!1,editor_highlightTrailingWhitespace:!0,editor_trimTrailingSpacesFromModifiedLines:!0,editor_linter_config:null,favicon_service:"google",i18n:null,action_menu_columns:1,action_menu_scripts_hide_disabled:!1,action_menu_scripts_sort:"auto",incognito_mode:"temporary",layout:"default",layout_user_css:"",sync_enabled:!1,sync_type:2,
statistics_enabled:!C.RUNTIME.FIREFOX&&!C.RUNTIME.SAFARI||"firb"==rea.runtime.short_id?!0:null,downloads_mode:"default",downloads_extension_whitelist:"/^[^\\.]*$/ /\\.mp[34]$/ .wav /\\.(avi|mkv|flv|divx|mpe?g|webm)$/ /\\.(ico|gif|png|jpe?g)/ /\\.(srt|sub|idx)$/ .txt .iso .zip /\\.r(ar|[0-9]{2,2})$/".split(" "),external_update_interval:6048E5,external_connect:"all",require_timeout:2E4,require_blacklist:["/^https?:\\/\\/example.com(:[0-9]{1,5})?\\/.*/"],require_sri_mode:"supported",script_blacklist_server:[],
script_blacklist_type:"server",script_blacklist_severity:4,connect_mode:"ask",page_filter_mode:"black",page_whitelist:["/https?:\\/\\/greasyfork\\.org\\/.*/","http://xkcd.com/970/"],forbiddenPages:"*example.org/* *paypal.tld/* *stripe.com/* https://*deutsche-bank-24.tld/* https://*bankofamerica.tld/* /^.*:\\/\\/apis\\.google\\.com\\/((?!render)([^\\/]+)\\/)+([^\\/]+)?$/ *://www.facebook.com/plugins/* *://platform.twitter.com/widgets/*".split(" ")},p={cloud_url:null,cloud_user:null,cloud_pass:null},
n=k=>{let g;return void 0!==(g=I.getValue(C.CONSTANTS.STORAGE.CONFIG,{})[k])?g:"function"==typeof(g=y[k])?g():g},x=(k,g)=>{const h=I.getValue(C.CONSTANTS.STORAGE.CONFIG,{}),v=n(k);h[k]=g;const q=I.setValue(C.CONSTANTS.STORAGE.CONFIG,h);m[k]&&JSON.stringify(v)!=JSON.stringify(g)&&m[k].forEach(u=>{try{u(k,v,g,q)}catch(e){B.warn("config: changeListener error",e)}});return q};let c,a;if(C.HTML5.LOCALSTORAGE&&(a=C.HTML5.LOCALSTORAGE.getItem(C.CONSTANTS.STORAGE.SESSION)))try{c=JSON.parse(Y.Base64.decode(a))}catch(k){}c=
c||{};const b=k=>{let g;return void 0!==(g=c[k])?g:p[k]},d=(k,g)=>{const h=b(k);void 0===g?delete c[k]:c[k]=g;C.HTML5.LOCALSTORAGE&&C.HTML5.LOCALSTORAGE.setItem(C.CONSTANTS.STORAGE.SESSION,Y.Base64.encode(JSON.stringify(c)));m[k]&&JSON.stringify(h)!=JSON.stringify(g)&&m[k].forEach(v=>{try{v(k,h,g)}catch(q){B.warn("config: changeListener error",q)}});return A.Pledge()},f={init:function(){const k=A();f.values={};Object.defineProperty(f,"snapshot",{get:function(){return M.assign({},f.values)},enumerable:!0});
Object.keys(y).forEach(g=>{Object.defineProperty(f.values,g,{get:function(){return n(g)},set:function(h){x(g,h)},enumerable:!0})});Object.keys(p).forEach(g=>{Object.defineProperty(f.values,g,{get:function(){return b(g)},set:function(h){d(g,h)},enumerable:!0})});f.initialized=!0;(g=>{Object.keys(g).forEach(h=>{const v=g[h];window.setTimeout(()=>{L.doSave({url:null,src:v,ask:!1,replace:!0,internal:!0})},1)});k.resolve()})([]);return k.promise()},getValue:function(k){return p.hasOwnProperty(k)?b(k):
n(k)},setValue:function(k,g){return p.hasOwnProperty(k)?d(k,g):x(k,g)},getDefaults:function(){return y},addChangeListener:function(k,g){Array.isArray(k)||(k=[k]);k.forEach(h=>{m[h]||(m[h]=[]);m[h].push(g)})}};return f})(),wa=(()=>{let m,y,p={},n,x,c;const a=()=>A.sleep(1).then(()=>rea.permissions.supported?Aa.has(C.PERMISSIONS.ALL_URLS).then(h=>h,()=>!0):!0).always(h=>{(y=h)?fa.removeAll("runtime_host_permissions"):(fa.all("status",{key:"runtime_host_permissions",class:"warning",text:l.getMessage("Limited_runtime_host_permissions_might_break_some_Tampermonkey_features_"),
timeout:31536E6}),b&&(ua.addRedirectListener(b),b=null));n=null});let b=h=>{k(h.url,1E3)};const d=()=>{A.Pledge().then(()=>{if(void 0===y)return c||(Aa.addListener(h=>{B.info("pcx: detected permission change",h);y=void 0;n=a()}),c=!0),n=n||a()}).then(()=>x).then(()=>{const h=M.values(p);p={};if(y)return h;{const v={},q=h.map(u=>{const e=O.woPath(u.url)+"/*";return Aa.hasOrigin(e).then(r=>{r||(v[e]=!0)})});return x=A.sidebyside(q).then(()=>{const u=Object.keys(v);return u.length?(B.info("pcx: need to ask for some permissions",
u),Aa.askOrigin(u,l.getMessage("Cross_Origin_Request_Permission"),l.getMessage("Click_here_to_allow_TM_to_access_the_following_hosts_0host_list0",u.join("\n"))).then(()=>{x=null;return h})):h}).always(()=>{x=null})}}).always(h=>{h.forEach(v=>v.deferred.resolve());Object.keys(p).length&&k()})};let f;const k=(h,v)=>{f||(f=window.setTimeout(()=>{f=null;d()},v||100));if(!h)return A.Pledge();if(p[h])return p[h].deferred.promise();v=A();p[h]={url:h,deferred:v};return v.promise()},g=(h,v,q)=>{let u,e;k(h.url).then(()=>
{if(e){if(v.onabort)v.onabort();if(v.ondone)v.ondone({})}else u=m(h,v,q?{internal:!0}:void 0)});return{abort:function(){if(u)return u.abort();e=!0}}};return{init:function(){m=ma.run},internal:(h,v)=>g(h,v,!0),external:(h,v)=>g(h,v,!1)}})(),Ja=()=>{const m=A();rea.tabs.getSelected(null,y=>{m.resolve(y)});return m.promise()},Ea=(()=>{const m={},y=g=>{if(O.isIpOrHostname(g))return null;const h=g.split(".");if(3>h.length)return g;g=O.isSecondLevelDomain(h.slice(-2).join("."))?-3:-2;return h.slice(g).join(".")},
p=g=>g&&g.includes("*"),n=g=>{const h=A();pa.isAllowed(g)?h.resolve({allowed:!0}):h.resolve({allowed:!1});return h.promise()},x=(g,h)=>{const v=q=>q?q.map(u=>{if(u.match(/^'?self'?$/))u=O.parse(h.url).hostname||null;else if("'none'"==u)u="none";else if(!["none","localhost","*"].includes(u)&&!O.isIpOrHostname(u)&&(0===u.indexOf(".")||1===(u.match(/\./g)||[]).length&&O.isSecondLevelDomain(u)))return null;return u}):[];return{connects:g.options.override.merge_connects&&"paranoid"!=w.values.connect_mode?
v(g.connects):[],userconnects:v(g.options.override.use_connects),blockers:v(g.options.override.use_blockers)}},c=(g,h,v)=>{const q=A(),u=()=>{q.resolve({permitted:!0})},e=D=>{q.resolve({permitted:!1,reason:D})},r=()=>{q.resolve({unknown:!0})};let t;const z=(D,E)=>{let F=null;const N=O.isIpOrHostname(D);E.every(G=>{if(G.a)for(let H=0;H<G.a.length;H++)if(G.a[H]&&(N||O.isIpOrHostname(G.a[H])?G.a[H]===D:-1!=D.search(new RegExp("(^|.+\\.)"+M.escapeForRegExp(G.a[H])+"$"))))return F=G.blocker?e:u,!1;return!0});
return F};if("off"==w.values.connect_mode)u();else if((t=O.parse(v))&&t.hostname)if((v=z(t.hostname,[{a:m[g.uuid]}]))||(v=p(m[g.uuid])?u:null))v();else if(0===h.connects.length&&0===h.userconnects.length&&0===h.blockers.length)"casual"==w.values.connect_mode?u():"strict"==w.values.connect_mode?e("No @connects given, but strict mode enabled"):r();else if(h.connects.includes("none"))e("None value found");else{if("casual"!=w.values.connect_mode||p(h.blockers)||!(v=p(h.connects)?u:null))(v=p(h.userconnects)?
u:null)||(v=z(t.hostname,[{a:h.blockers,blocker:!0},{a:h.connects},{a:h.userconnects}])||r);v()}else e("URL can not be parsed");return q.promise()},a=()=>{const g=v=>{for(let q=0;q<d.length;q++)if(d[q].tabId===v)return d.splice(q,1)[0];return d.pop()};let h;Ja().then(v=>{for(;!b&&(h=g(v.id));)h.fn()})};var b,d=[];const f=(g,h,v,q,u)=>{let e;const r=A(),t=()=>{r.resolve({approved:!0})},z=()=>{r.resolve({forbidden:!0})};B.log('cor: "'+g.name+'" is asking for permission to access',q,h);if((e=O.parse(q))&&
e.hostname){const D=y(e.hostname),E=h.tab?h.tab.id:null;b=!0;Ja().then(F=>ta.askForConnect({src_url:h.url,hostname:e.hostname,domain:D,all_domains:p(v.connects),tabid:E,active:E===F.id,timeout:u,url:q,settings_url:rea.extension.getURL("options.html")+"#nav="+g.uuid+"+settings",connect_url:"https://www.tampermonkey.net/documentation.php#_connect",script:{name:g.name,uuid:g.uuid,icon:g.icon64||g.icon||ia.images.origin("unknown")}})).done(F=>{let N;const G=F.whole_domain?D:e.hostname;F.allow?F.once?
(B.log('cor: allowing "'+g.name+'" to access',G,"once"),t()):F.temporary?(B.log('cor: allowing "'+g.name+'" to access',G,"temporarily"),void 0===m[g.uuid]&&(m[g.uuid]=[]),m[g.uuid].includes(G)||m[g.uuid].push(G),t()):(N=t,F.all_domains?(B.log('cor: allowing "'+g.name+'" to access all domains always'),g.options.override.use_connects.push("*")):(B.log('cor: allowing "'+g.name+'" to access',G,"always"),g.options.override.use_connects.push(G),N=t)):F.once||F.aborted?(B.log('cor: denying "'+g.name+'" to access',
G,"once"),z()):(g.options.override.use_blockers||(g.options.override.use_blockers=[]),N=z,F.all_domains?(B.log('cor: denying "'+g.name+'" to access any domains (additional) domain'),g.options.override.use_blockers.push("*")):(B.log('cor: denying "'+g.name+'" to access',G,"always"),g.options.override.use_blockers.push(G)));N&&L.doModify(g.uuid,g,!1).always(N)}).fail(z).always(()=>{b=!1;d.length&&window.setTimeout(a,1)})}else z();return r.promise()},k=(g,h,v,q)=>{const u=x(g,h);return n(v).then(e=>
{if(!0!==e.allowed)return A.Breach("URL is blacklisted");let r,t;return(r=O.parse(v))&&r.origin&&(t=O.parse(h.url))&&t.origin&&r.origin===t.origin?A.Pledge({permitted:!0}):c(g,u,v)}).then(e=>{if(!1===e.permitted)return A.Breach("URL is not permitted"+(e.reason?": "+e.reason:""));if(!0===e.permitted)return A.Pledge();if(0===u.connects.length||p(u.connects)){if(["ask","paranoid"].includes(w.values.connect_mode)){if(p(u.blockers))return A.Breach("URL was permanently blocked by the user");if(b){B.log('cor: queuing access permission check from "'+
g.name+'" to',v,h);const r=A();d.push({tabId:h.tab?h.tab.id:null,fn:function(){r.consume(k.apply(this,[g,h,v,q]))}});return r.promise()}return f(g,h,u,v,q).then(r=>!0===r.approved?A.Pledge():A.Breach("Request was blocked by the user"))}return A.Breach()}return A.Breach("URL is not a part of the @connect list")})};return{getSessionConnects:function(g){return m[g]||[]},setSessionConnects:function(g,h){m[g]=h||[]},purgeAppeals:function(g){d=d.filter(h=>h.tabId!==g)},exec:function(g,h,v,q){let u,e,r,
t,z,D=g.url;const E=[],F=Math.max(Math.min(g.timeout||0,6E4),2E4),N=()=>{let H;for(;!z&&(H=E.shift());)H()},G=(H,J)=>{const K='Refused to connect to "'+(J||g.url)+'": '+(H||"Blocked by @connect CORS check"),X=ma.makeErrorResponse(K);["onerror","ondone"].forEach(R=>{if(q[R])q[R]({response:X,exception:K})})};if(!(v&&v.url&&v.tab&&g.url&&h&&(e=Q.getByUid(h))&&e.script&&e.cond))return G();k(e.script,v,g.url,F).done(()=>{if(!t){var H={};Object.keys(q).forEach(J=>{H[J]=(K,...X)=>{r||(z?E.push(function(){H[J].apply(this,
[K,...X])}):(()=>K&&K.finalUrl&&D!==K.finalUrl?(z=!0,k(e.script,v,K.finalUrl,F).fail(()=>{t||r||(u&&u.abort(),r=!0,G("Request was redirected to a not whitelisted URL",K.finalUrl),B.warn("cor: request to",D,"was redirect to a not whitelisted URL",K.finalUrl))}).always(()=>{D=K.finalUrl;z=!1;E.length&&window.setTimeout(N,1)})):{always:function(R){R()}})().always(()=>{if(!r)q[J]({response:K})}))}});u=wa.external(g,H)}}).fail(H=>{t||(G(H),B.warn("cor: access to",D,"was denied"))}).always(()=>{if(t){if(q.onabort)q.onabort();
if(q.ondone)q.ondone({})}});return{abort:()=>{u?u.abort():t=!0}}}}})(),La=(()=>{const m=a=>{const b=[];a=new DataView(a);for(let d=0;d<a.byteLength;d+=4){const f=("00000000"+a.getUint32(d).toString(16)).slice(-8);b.push(f)}return b.join("")},y={md5:function(a,b){return A.Pledge(Y.MD5(a,b))},sha256:function(a){return A.Pledge(forge_sha256(a))}},p={};["SHA-1","SHA-384","SHA-512"].forEach(a=>{const b=a.toLowerCase().replace("-","");p[b]=()=>{const d=(f,k)=>{const g=A();window.crypto.subtle.digest(a,
Y.str2arrbuf(f,k)).then(h=>{g.resolve(m(h))},()=>{g.reject()});return g.promise()};try{return d("").then(f=>{if(f&&f.substr(0,4).toLowerCase().match(/[0-9a-f]{4,4}/))return d})}catch(f){return A.Breach()}}});const n=a=>Object.keys(y).includes(a),x=a=>function(...b){if(!1!==c){const d=A();c.push(function(){d.consume(a.apply(this,b))});return d.promise()}return a.apply(this,b)};var c=[];return{init:function(){B.D&&Object.keys(y).forEach(a=>{B.log("sri:",a,"is supported")});return A.sidebyside(Object.keys(p).map(a=>
p[a]().done(b=>{B.log("sri:",a,"is supported");y[a]=b}).fail(()=>{B.log("sri:",a,"is unsupported")}))).always(()=>{c.forEach(a=>{a()});c=!1})},isSupported:x(a=>A.Pledge(n(a))),getHash:x((a,b)=>{const d=A();"string"===typeof a&&(a=O.parse(a));if(a&&a.hash){let g;a=a.hash.replace(/^#/,"").split(/,|;/g);for(let h=0;h<a.length;h++){if(!(g=a[h].match(/([^=|:|-]+)[=|:|-](.+)/))||3!=g.length||!n(g[1]))continue;let v=g[2];if(!/^[0-9a-fA-F]+$/.exec(v)){var f=decodeURIComponent(v);try{var k=m(Y.str2arrbuf(Y.Base64.decode(f)))}catch(q){k=
null}v=k||v}f={type:g[1],value:v}}d.resolve(f||(b?f:{type:"unsupported",value:""}))}else d.resolve();return d.promise()}),check:x((a,b,d)=>b&&a&&n(a.type)?y[a.type](b,d).then((f,k)=>((k=f===a.value)?A.Pledge:A.Breach)(k||{type:a.type,value:f})):A.Breach())}})(),ha=(()=>{const m={key:function(a,b){return C.CONSTANTS.PREFIX.EXTERNAL+M.select([a,b?Y.MD5(b):null],d=>d).join(":")},list:function(a){const b=new RegExp("^"+a);return M.select(I.listValues(),d=>-1!=d.search(b))},set:function(a,b,d,f){a=m.key(a,
b);const k={};M.each(d,(g,h)=>{"content"==h&&(h="base",g=Y.encodeS(g));k[h]=g});I.setValue(a,{ts:Date.now(),url:b,resource:k,modified:f})},get:function(a,b){a=m.key(a,b);a=I.getValue(a);let d;if(a&&a.resource){const f={};M.each(a.resource,(k,g)=>{"base"==g&&(g="content",k=Y.decodeS(k));f[g]=k});d={ts:a.ts,url:a.url,data:f,modified:a.modified}}return d},clean:function(a,b){a=m.key(a,b);I.deleteValue(a)},cleanAll:function(a,b){let d;const f=m.list(m.key(a));if(b){const k={};M.each(b,g=>{g=m.key(a,g);
k[g]=!0});d=[];M.each(f,g=>{k[g]||d.push(g)})}else d=f;d.forEach(k=>{I.deleteValue(k)})}},y=(a,b)=>{const d=A(),f=h=>{const v={content:""};if(4!=h.readyState||200!=h.status&&0!=h.status||h.error)d.reject(v);else{let q,u;const e=ma.parseHeaders(h.responseHeaders)["content-type"];e&&e.match("(image/|text/)([.-a-zA-Z0-9]+)")&&(q=e);q||(a.match(".*.(ico|jpg|jpeg)+($|\\?|#).*")?q="image/x-icon":(u=a.match(".*.(gif|png)+($|\\?|#).*"))?q="image/"+u[1]:-1!=a.search(".*.(js)+($|\\?|#).*")?q="text/javascript":
(u=a.match(".*.(css|html|xml)+($|\\?|#).*"))?q="text/"+u[1]:M.isLocalImage(a)&&(q="image/x-icon"));v.meta=q;v.content=Y.arrbuf2str(h.response,b.encoding)||"";d.resolve(v)}},k=()=>{d.reject({})};var g=O.parse(a);["file:"].concat(C.REQUESTS.INTERNAL_PAGE_PROTOCOLS).includes(g.protocol)?"file:"!=g.protocol||C.RUNTIME.ALLOWS_FILE_SCHEME_ACCESS&&["externals","all"].includes(w.values.script_file_access)?rea.file.get(a,h=>{f({readyState:4,status:0,response:h})},h=>{d.reject({})}):(B.warn("externals:","Access to this local file is forbidden!",
"Loading the following @resource failed:",a,"-> more info:","https://www.tampermonkey.net/faq.php#Q204"),d.reject({})):(g={method:"GET",url:a,retries:C.XMLHTTPREQUEST.RETRIES,nocache:!1,responseType:"arraybuffer"},g.timeout=w.values.require_timeout,wa.internal(g,{onload:f,onerror:k,ontimeout:k}));return d.promise()},p=M.getDebouncer(9E3),n=(a,b,d,f)=>{const k=A(),g={sync:!1};y(b,{encoding:f.encoding}).done(h=>{d&&(h.sri=d);const v=q=>{const u=O.parse(b);u.protocol&&!["file:"].concat(C.REQUESTS.INTERNAL_PAGE_PROTOCOLS).includes(u.protocol)&&
m.set(a,b,q)};d&&["supported","given"].includes(w.values.require_sri_mode)?La.check(d,h.content,f.encoding).done(()=>{g.resource=h;v(g.resource);k.resolve(g)}).fail(q=>{g.resource={forbidden:!0,sri:{mode:w.values.require_sri_mode,type:d.type,value:"invalid"},determined:q,content:""};v(g.resource);k.reject(g)}):(g.resource=h,v(g.resource),k.resolve(g))}).fail(h=>{B.log("externals: get.failed",a,b,h);g.resource={failed:!0,content:""};k.reject(g)});return k.promise()},x=(a,b,d)=>{const f=A(),k=O.parse(b),
g={sync:d.sync};let h;b?Z.getEvilnessOf(b)>=w.values.script_blacklist_severity?(g.resource={blacklisted:!0,content:""},f.reject(g)):La.getHash(k,"supported"==w.values.require_sri_mode).done(v=>{if("enforce"!=w.values.require_sri_mode||v)if("file:"!==k.protocol&&(h=m.get(a,b))){const q=m.key(a,b),u=Date.now();0<w.values.external_update_interval&&u-h.ts>w.values.external_update_interval&&!p.is(q)&&(1<w.values.external_update_interval&&p.add(q),h.modified?B.log("externals: resource is not updated due to user modifications",
b,(new Date(h.ts)).toISOString(),(new Date(u)).toISOString()):(B.log("externals: resource needs update",b,(new Date(h.ts)).toISOString(),(new Date(u)).toISOString()),window.setTimeout(()=>{n(a,b,v,d)},3E3)));g.resource=h.data;g.resource.forbidden||g.resource.blacklisted?f.reject(g):f.resolve(g)}else f.consume(n(a,b,v,d));else g.resource={forbidden:!0,sri:{mode:w.values.require_sri_mode},content:""},f.reject(g)}):(g.resource={forbidden:!0,content:""},f.reject(g));return f.promise()},c={setElement:function(a,
b,d,f){return m.set(a,b,d,f)},getElement:function(a,b){return m.get(a,b)},cleanElement:function(a,b){return m.clean(a,b)},dropAll:function(a){m.cleanAll(a);return A.Pledge()},dropAllBut:function(a,b){m.cleanAll(a,b);return A.Pledge()},loadResources:function(a,b){const d=A();c.getResources(a,b).always(()=>{d.resolve()});return d.promise()},loadRequires:function(a,b){const d=A();c.getRequires(a,b).always(()=>{d.resolve()});return d.promise()},getResources:function(a,b){const d={elements:[]},f=A(),k=
[],g={sync:!0};b.forEach(h=>{var v=h.url||O.sanitize(h.unsafe_url,h.abs_url);const q={name:h.name,url:v};v=x(a,v,g);const u=A();v.done(e=>{e=e.resource;q.content=e.content;q.meta=e.meta||"application"}).fail(e=>{e.resource&&e.resource.forbidden?e.resource.sri?B.warn("externals: can't load @resource",h.name,"from URL",h.unsafe_url,"due to a SRI error"):B.warn("externals: can't load @resource",h.name,"from forbidden URL",h.unsafe_url):e.resource&&e.resource.blacklisted?B.warn("externals: can't load @resource",
h.name,"from blacklisted URL",h.unsafe_url):(B.warn("externals: can't load @resource",h.name,"from URL",h.unsafe_url),q.failed=!0);q.content=null}).always(e=>{g.sync&=e.sync;d.elements.push(q);u.resolve()});k.push(u)});A.when(k).always(()=>{d.sync=g.sync;f.resolve(d)});return f.promise()},getRequires:function(a,b){const d={elements:[]},f=A(),k=[],g={encoding:"UTF-8",sync:!0};M.each(b,(h,v)=>{var q=h.url||O.sanitize(h.unsafe_url,h.abs_url);const u={};q=x(a,q,g);const e=A();q.done(r=>{u.textContent=
r.resource.content||""}).fail(r=>{r=r.resource&&r.resource.forbidden?r.resource.sri?"couldn't load @require from URL "+h.unsafe_url+" due to a SRI error":"couldn't load @require from forbidden URL "+h.unsafe_url:r.resource&&r.resource.blacklisted?"couldn't load @require from blacklisted URL "+h.unsafe_url:"couldn't load @require from URL "+h.unsafe_url;u.textContent='console.warn("Tampermonkey: " + decodeURIComponent("'+encodeURIComponent(r)+'"));\n';B.warn("externals: "+r)}).always(r=>{g.sync&=r.sync;
d.elements[v]=u;e.resolve()});k.push(e)});A.when(k).always(()=>{d.sync=g.sync;d.elements=d.elements.filter(h=>h);f.resolve(d)});return f.promise()}};return c})();exts=ha;var Sa=(()=>{const m=(p,n,x)=>{const c=A(),a=[];x.forEach(k=>{k=k.textContent||"";k=Fa.mkCompat(k,p.options.compatopts_for_requires?p:null,"off"!=w.values.runtime_strict_mode);a.push(k)});x="\n"+a.join("\n")+"\n";const b=Q.getStorageByUid(p.uuid);n=Fa.mkCompat(n,p,"off"!=w.values.runtime_strict_mode);if(w.values.debug){n=n.split("\n");
var d=!1;for(let k=0;k<n.length;k++){var f=n[k];if(!f.match(/^\s*$|^\s*\/\/\s*|^\s*\/\*.*\*\/\s*$|^\s*["']+use strict["']+;*\s*$/))if(f.match(/^\s*\/\*/)&&(d=!0),d)if(f.match(/\*\/\s*$/))d=!1;else{if(-1!=(f=f.search(/\*\//))){n[k]=M.insert(n[k],f+2,0,"debugger;");break}}else{n[k]="debugger;"+n[k];break}}n=n.join("\n")}d=encodeURIComponent(p.name)+".user.js";d=C.RUNTIME.FIREFOX?rea.extension.getURL("userscripts/")+d+"?"+O.hash2params({id:p.uuid}):rea.extension.getURL("userscript.html")+"?"+O.hash2params({name:d,
id:p.uuid});c.resolve({header:p.header,code:n,requires:x,storage:b,script:p,source_url:d});return c.promise()},y={};return{bundle:function(p,n){let x,c,a=!0;if(x=y[n.uuid])return x;const b={},d="includes matches requires resources excludes connects textContent".split(" ");Object.keys(n).forEach(f=>{d.includes(f)||("options"==f?(b[f]=JSON.parse(JSON.stringify(n[f])),b[f].run_at=b[f].run_at||n.options.override.orig_run_at||"document-idle"):b[f]=n[f])});x=ha.getResources(b.uuid,n.resources).then(f=>
{a&&!f.sync&&(B.log("ri: uncached @external detected -> fast script start disabled"),a=f.sync);b.resources=f.elements;return ha.getRequires(b.uuid,n.requires)}).then(f=>{a&&!f.sync&&(B.log("ri: uncached @external detected -> fast script start disabled"),a=f.sync);f=f.elements;B.log("run script "+b.name+" @ "+p.url);return m(b,n.textContent,f)}).always(()=>{c=!0;delete y[b.uuid]});c||(y[b.uuid]=x);return x}}})(),fa=(()=>{const m={},y={},p=(c,a)=>{let b;const d=a.key||"general",f=a.timeout||3E5,k=window.setTimeout(()=>
{delete c[d]},f);(b=c[d])&&window.clearTimeout(b.to);c[d]={ts:Date.now()+f,options:a,to:k}},n=c=>{const a=Date.now();return Object.keys(c).map(b=>{var d=c[b];b=M.copy(d.options,{});if(d=Math.max(0,d.ts-a))return b.timeout=d,b}).filter(b=>b)},x={all:function(c,a){x.actionPage(c,a);x.optionsPage(c,a)},removeAll:function(c){delete m[c];delete y[c]},actionPage:function(c,a){const b=rea.extension.getViews({type:"popup"});b&&b.length&&rea.extension.sendMessage({method:c,options:a},()=>{});a&&p(m,a)},optionsPage:function(c,
a){const b=rea.extension.getViews({type:"tab"});b&&b.length&&rea.extension.sendMessage({method:c,options:a},()=>{});a&&p(y,a)},actionStatus:function(){return n(y)},optionsStatus:function(){return n(m)}};return x})(),va=(()=>({getConfig:function(){const m={version:0,last:0},y={scripts:0};let p=I.getValue(C.CONSTANTS.STORAGE.UPDATE,y);"object"!==typeof p&&(p=y);p||(p=y);void 0==p.black&&(p.black=m);void 0==p.scripts&&(p.scripts=0);return p},setConfig:function(m){m&&I.setValue(C.CONSTANTS.STORAGE.UPDATE,
m)}}))(),xa=(()=>{const m=(n,x)=>{let c=0,a=0,b=0;const d=l.getMessage("Script_Update"),f=l.getMessage("Check_for_userscripts_updates")+"...";n&&oa.show(d,f,ia.images.brand("tampermonkey"),{timeout:1E4});const k=Q.getUidList().map(g=>{var h,v,q;let u,e,r;return(()=>{u=Q.getByUid(g);if(!u.script||!u.cond)return B.warn("update: inconsistent script entry",g,u),A.Breach();const t=!w.values.scriptUpdateCheckDisabled&&!u.script.enabled&&!x||!u.script.options.check_for_updates;if(x&&u.script.uuid!==x||t||
!(r=L.determineSourceURL(u.script))||u.script.evilness&&u.script.evilness>=Math.min(Z.SEVERITY_MAX,w.values.script_blacklist_severity))return A.Breach();let z;if((z=L.determineOrigin(u.script))&&z.updates_allowed&&!z.updates_allowed(r))return A.Breach();c++;B.info("update: check for script updates @",g);return A.Pledge()})().then(()=>{const t=L.determineMetaURL(u.script);if(!t)return A.Pledge();if("none"==t)return B.debug("update: ignore non-updatable script",u.script.name),A.Breach();const z=A();
wa.internal({method:"GET",retries:C.XMLHTTPREQUEST.RETRIES,timeout:1E3*C.SCRIPT_DOWNLOAD.TIMEOUT,revalidate:!0,headers:{Accept:"text/x-userscript-meta, */*"},url:t},{ondone:function(D){4==D.readyState&&200==D.status?e=U.processMetaHeader(D.responseText):B.warn("update: unable to find meta data @ "+t+" req.status = "+D.status);z.resolve()}});return z.promise()}).then(()=>{const t=!!e,z=t&&!!e.version,D=z&&(!u.script.version||U.versionCmp(e.version,u.script.version)==U.versionCmp.eNEWER);return t&&
z&&!D?A.Breach():A.Pledge()}).then(()=>{let t;if(t=O.parse(r)){if(t.protocol.match(/(https?|file):/))return p.getScriptFromURL(r).fail(()=>{B.warn("update: failed",u.script.name,r)});B.warn("update: can't download URL",u.script.name,r)}else B.warn("update: can't parse URL",u.script.name,r)}).then(t=>{{var z=u.script.uuid;const E=U.createScriptFromSrc(t);if(!E.name||""==E.name||void 0===E.version||E.options.compat_uW_gmonkey)z=U.versionCmp.eERROR;else{var D;z=(D=Q.getMetaByUid(z))?D.system?null:E.version==
D.version?U.versionCmp.eEQUAL:U.versionCmp(E.version,D.version):U.versionCmp.eNEWER}}return z==U.versionCmp.eNEWER?(a++,h=u.script.name,v=r,q=t,A.Pledge()):A.Breach()}).then(()=>{if(w.values.notification_silentScriptUpdate)return A.Pledge();{const t=l.getMessage("There_is_an_update_for_0name0_avaiable_",h)+"\n"+l.getMessage("Click_here_to_install_it_"),z=l.getMessage("Just_another_service_provided_by_your_friendly_script_updater_")+":",D=A();oa.show(z,t,ia.images.brand("tampermonkey"),{timeout:w.values.scriptUpdateHideNotificationAfter},
D.resolve);return D.promise()}}).then(t=>{const z=g||u.script.uuid;return void 0===t||t.clicked?L.doSave({url:v,uuid:z,replace:!z,src:q,ask:!w.values.notification_silentScriptUpdate}).done(D=>{D&&D.installed&&b++}):A.Breach()})});c&&fa.all("status",{key:"script_update",class:"information",title:d,text:f,timeout:1E4});return A.sidebyside(k).then(()=>{k.length&&0==a&&(B.debug("No update found"),n&&oa.show("Narf!",l.getMessage("No_update_found__sry_"),ia.images.brand("tampermonkey"),{timeout:1E4}),fa.all("status",
{key:"script_update",class:"information",text:l.getMessage("No_update_found__sry_"),timeout:1E4}));return{found:a,installed:b}})};let y=null;var p={check:function(n,x,c){if(!n&&0>=w.values.scriptUpdateCheckPeriod)return A.Breach();let a=va.getConfig();if(!n&&Date.now()-a.scripts<Math.max(w.values.scriptUpdateCheckPeriod,36E5))return A.Breach();let b,d;return A.Pledge().then(()=>{const f=()=>{d=null;const k=l.getMessage("Script_Update"),g=l.getMessage("Waiting_for_sync_to_finish")+"...";d=oa.show(k,
g,ia.images.brand("tampermonkey"),{timeout:6E4})};if(ca.enabled){const k=A();ca.addSyncDoneCallback(k.resolve);ca.sync(50,!1);x&&(b=window.setTimeout(f,500));return k.promise()}}).then(()=>{if(!n){var f=A(),k=()=>{rea.idle.queryState(C.MISC.IDLE_TIMEOUT,h=>{"active"==h?window.setTimeout(k,1E3*Math.round(C.MISC.IDLE_TIMEOUT/2)):g()})},g=()=>{let h;rea.windows.getAll({},v=>{v.forEach(q=>{"fullscreen"===q.state&&(h=!0)});h?window.setTimeout(k,1E3*C.MISC.IDLE_TIMEOUT):f.resolve()})};k();return f.promise()}}).then(()=>
{const f=A();b&&(window.clearTimeout(b),b=null);d&&d.cancel();m(x,c).done(k=>{f.resolve(k.installed)}).fail(()=>{f.resolve(null)});a=va.getConfig();a.scripts=Date.now();va.setConfig(a);return f.promise()})},getScriptFromURL:function(n){const x=A();["file:"].concat(C.REQUESTS.INTERNAL_PAGE_PROTOCOLS).includes(O.parse(n).protocol)?rea.file.get(n,c=>{x.resolve(Y.arrbuf2str(c,"UTF-8"))},c=>{x.reject({error:!0,responseText:c})}):wa.internal({method:"GET",retries:C.XMLHTTPREQUEST.RETRIES,timeout:1E3*C.SCRIPT_DOWNLOAD.TIMEOUT,
revalidate:!0,headers:{Accept:"text/x-userscript, */*"},url:n},{onload:function(c){4!=c.readyState||200!=c.status&&0!=c.status||c.error?x.reject({error:!0,responseText:c.responseText}):x.resolve(c.responseText)},onerror:function(c){x.reject({error:!0,responseText:c.responseText})},ontimeout:function(){x.reject({timeout:!0,responseText:""})}});return x.promise()},init:function(){const n=()=>{y&&(window.clearTimeout(y),y=null);0<w.values.scriptUpdateCheckPeriod&&(y=window.setTimeout(()=>{y=null;p.check();
n()},36E5))};n();w.addChangeListener("scriptUpdateCheckPeriod",n)}};return p})();trup=xa;var L=(()=>{const m=c=>{c.sort((a,b)=>a.position-b.position);return c},y=c=>{void 0===c.ask&&(c.ask=!0);if(void 0===c.url||null==c.url)c.url="";""===c.force_url&&(c.force_url=null);let a=U.createScriptFromSrc(c.src),b=null;const d={heading:null,errors:[],info:[],warnings:[],flags:{}},f=A(),k=Date.now(),g=c.save&&!c.ask&&w.values.editor_easySave;let h=c.uuid,v;if(a.name&&void 0!=a.version)var q=A.Pledge();else d.errors.push(l.getMessage("Invalid_UserScript__Sry_")+
"\n\n"),c.name&&d.errors.push(l.getMessage("Script_name_0name0",c.name)+"\n\n"),c.url&&d.errors.push(l.getMessage("Downloaded_from_0url0",c.url)),B.warn("scriptman: invalid userscript",d,a),q=A.Breach();q.then(()=>{c.replace&&!h&&(h=Q.getUidsByName(a.name,a.namespace)[0]);if(h)b=Q.getMetaByUid(h);else if(a.uuid)h=a.uuid;else if(c.replace)h=M.createUUID();else return B.warn("scriptman: neither UUID, @uuid nor replace option set"),A.Breach();if(""!==h.replace(/[a-f0-9]{8}-[a-f0-9]{4}-4[a-f0-9]{3}-[89aAbB][a-f0-9]{3}-[a-f0-9]{12}/,
""))return B.warn("scriptman: invalid UUID",h),A.Breach();if(!c.clean&&!c.defaultscript&&b&&b.system)return A.Breach()}).then(()=>{if(c.clean&&c.name&&c.name!=a.name||-1!=a.name.indexOf("\n"))return d.errors.push(l.getMessage("Invalid_UserScript_name__Sry_")),A.Breach()}).then(()=>{if(a.options.compat_uW_gmonkey)return d.errors.push(l.getMessage("This_script_uses_uW_gm_api_")),A.Breach()}).then(()=>{if(b){b.name!=a.name&&(d.flags.renamed=!0);c.internal||b.evilness!=Z.SEVERITY_FOISTED_SCRIPT||(d.warnings.push(l.getMessage("This_is_a_possibly_foisted_script_and_a_modification_will_enable_it_")),
d.flags.forceAsk=!0);if(b.lastModified&&void 0!==c.lastModTime&&b.lastModified!==c.lastModTime){let u=l.getMessage("some_secs");try{const e=Math.max(1,Math.floor((k-b.lastModified)/1E3));isNaN(e)||(u=e)}catch(e){}d.warnings.push(l.getMessage("CONFLICT__This_script_was_modified_0t0_seconds_ago_",u));d.flags.forceAsk=!0}a.version==b.version&&(c.save?d.flags.modification=!0:d.flags.reset=!0);c.clean&&(d.flags.factory=!0);v=!c.internal}else d.flags.first_install=!0,v=!c.internal||c.save;a.includes.length||
a.matches.length||g||c.internal||d.warnings.push(l.getMessage("This_script_does_not_provide_any__include_information_"));d.flags.sync=!!c.sync;d.flags.internal=c.internal;d.flags.ask=c.ask;d.flags.save=c.save;d.flags.whitewash=c.whitewash}).then(()=>{a.uuid=h;a.system=c.defaultscript;a.evilness=L.getEvilness(a);a.position=L.determineLastPosition()+1;a.lastModified=k;if(c.force_meta){let u;if(u=c.force_meta.fileURL)a.fileURL=u;if(u=c.force_meta.lastModified)a.lastModified=u}d.flags.factory||d.flags.reset?
b&&(a.lastModified=b.lastModified):(c.force_url&&(a.updateURL=null,a.downloadURL=c.force_url),b&&(a.options.override=M.copy(b.options.override,{}),a.options.comment=b.options.comment,a.options.check_for_updates=c.save&&a.textContent!=b.textContent?!1:b.options.check_for_updates));["includes","excludes","matches","connects"].forEach(u=>{a.options.override["orig_"+u]=a[u]});a.options.override.orig_noframes=a.options.noframes;a.options.override.orig_run_at=a.options.run_at||"document-idle";a.options.noframes=
null;a.options.run_at=null}).then(()=>{if(b&&(a.fileURL=b.fileURL,a.position=b.position,b.sync&&(a.sync=b.sync),!d.flags.factory&&!d.flags.reset)){a.enabled=b.enabled;a.options.noframes=b.options.noframes;a.options.run_at=b.options.run_at;a.options.awareOfChrome||(a.options.compat_forvarin=b.options.compat_forvarin);c.save&&!c.force_url&&(a.downloadURL=b.downloadURL||a.downloadURL);var u=x.determineMetaURL(b),e=x.determineMetaURL(a);u=u?O.woHash(u):u;e=e?O.woHash(e):e;u==e||g||c.internal||d.warnings.push(l.getMessage("The_update_url_has_changed_from_0oldurl0_to__0newurl0",
[u,e]));c.save||(e=b.options.override.orig_matches||b.matches,u=b.options.override.orig_excludes||b.excludes,M.adiff(b.options.override.orig_includes||b.includes,a.includes,"notinfirst").length+M.adiff(e,a.matches,"notinfirst").length+M.adiff(a.excludes,u,"notinfirst").length&&d.warnings.push(l.getMessage("At_least_one_of_the_include_match_or_exclude_statements_was_changed_")),M.adiff(b.connects||[],a.connects||[],"notinfirst").length&&d.warnings.push(l.getMessage("At_least_one_new_connect_statement_was_added_")))}}).then(()=>
{if(b&&!d.flags.factory&&a.version==b.version&&(c.defaultscript||c.noreinstall))return A.Breach()}).then(()=>{b?(d.flags.factory||d.flags.reset?(d.flags.reset?(d.heading=l.getMessage("You_are_about_to_reinstall_a_UserScript_"),d.flags.reinstall=!0):(d.heading=l.getMessage("You_are_about_to_install_a_UserScript_"),d.flags.install=!0),c.internal||d.warnings.splice(0,0,l.getMessage("All_script_settings_will_be_reset_"))):d.flags.modification?d.heading=l.getMessage("You_are_about_to_modify_a_UserScript_"):
U.versionCmp(a.version,b.version)==U.versionCmp.eOLDER?(d.heading=l.getMessage("You_are_about_to_downgrade_a_UserScript"),d.flags.downgrade=!0,g||c.internal||d.warnings.splice(0,0,l.getMessage("The_downgraded_script_might_have_problems_to_read_its_stored_data_"))):(d.heading=l.getMessage("You_are_about_to_update_a_UserScript_"),d.flags.update=!0),d.info.push({label:l.getMessage("Installed_Version_"),value:"v"+b.version})):(d.heading=l.getMessage("You_are_about_to_install_a_UserScript_"),g||c.internal||
(d.info.splice(0,0,l.getMessage("Malicious_scripts_can_violate_your_privacy_")),Z.getWarningsFor(x.determineSourceURL(a)).forEach(u=>{d.warnings.splice(0,0,u)})),d.flags.install=!0);d.flags.whitewash?d.action=l.getMessage("Enable"):d.flags.install?d.action=l.getMessage("Install"):d.flags.reinstall?d.action=l.getMessage("Reinstall"):d.flags.modification?d.action=l.getMessage("Modify"):d.flags.downgrade?d.action=l.getMessage("Downgrade"):d.flags.update&&(d.action=l.getMessage("Update"))}).then(()=>
{c.url&&(a.fileURL=c.url);c.sync&&(a.sync=c.sync);c.force_options&&M.copy(c.force_options,a.options,(new U.Script).options,!0);c.force_settings&&M.copy(c.force_settings,a,["enabled","position"]);a=L.mergeCludes(a)}).then(()=>{var u=!1;for(const t in a.options)if(-1!=t.indexOf("compat_")&&!0===a.options[t]){u=!0;break}u&&d.info.push({label:l.getMessage("Note"),value:l.getMessage("A_recheck_of_the_GreaseMonkey_FF_compatibility_options_may_be_required_in_order_to_run_this_script_")});let e,r;(e=x.determineOrigin(a))&&
(r=e.convert)&&(u=r(a),u.warning&&(c.internal?d.info.push(u.warning):d.warnings.push(u.warning)),a=u.script)}).then(()=>{["requires","resources"].forEach(u=>{a[u]=M.map(a[u],e=>{e.unsafe_url=e.url;e.abs_url=a.fileURL?a.fileURL.split("/").slice(0,-1).join("/"):null;e.url=null;return e})})}).done(()=>{f.resolve({script:a,oldscript:b,messages:d,trigger_sync:!!v,short_info:[{label:l.getMessage("Author"),prop:"author"},{label:l.getMessage("Description"),prop:"description"},{label:l.getMessage("Source"),
prop:"fileURL"}]})}).fail(()=>{f.reject({messages:d})});return f.promise()},p=c=>{const a=A(),b=c.messages,d=c.script,f=c.trigger_sync,k=()=>{b.flags.modification||ha.dropAll(d.uuid);a.notify();const h=x.doModify(d.uuid,d,f)||{};!b.flags.install&&!b.flags.update||b.flags.factory||b.flags.reset||ea.tS(d.name,d.fileURL,b.flags.install?"i":"u");(b.flags.first_install||b.flags.factory)&&Q.setStorageByUid(d.uuid,{ts:Date.now()});return h},g={uuid:d.uuid,lastModified:void 0,installed:!0,renamed:b.flags.renamed};
b.warnings.length||b.flags.ask?(rea.extension.inIncognitoContext&&"temporary"==w.values.incognito_mode&&(c.hints=c.hints||[],c.hints.push({globalhint:!0,options:{image:"critical",text:l.getMessage("All_modifications_are_only_kept_until_this_incognito_session_is_closed_")}})),ta.install(c).done(h=>{h.ok&&k();g.installed=h.ok;g.aborted=h.aborted;a.resolve(g)}).fail(h=>{a.reject(h)})):window.setTimeout(()=>{k();a.resolve(g)},1);return a.promise()},n=M.getDebouncer(1E3);var x={determineSourceURL:function(c){return c?
M.select([c.downloadURL,c.fileURL],a=>{if(!a||"file:"!==O.parse(a).protocol)return a})[0]:null},determineMetaURL:function(c){if(!c)return null;let a;const b=L.determineOrigin(c);b&&b.meta_header?a=c.fileURL:!c.fileURL||b&&!b.meta_url||(a=c.fileURL.replace(".user.js",".meta.js"),c.fileURL==a&&(a=c.fileURL.replace(".tamper.js",".meta.js")),c.fileURL==a&&(a=null));return M.select([c.updateURL,c.downloadURL,a],d=>{if(!d||"file:"!==O.parse(d).protocol)return d})[0]},mergeCludes:function(c){let a,b;const d=
c.options.override;["includes","excludes","matches"].forEach(f=>{c[f]=d["merge_"+f]&&d["orig_"+f]?d["orig_"+f].slice():[]});if(d.use_includes)for(a=0;a<d.use_includes.length;a++)b=c.excludes.indexOf(d.use_includes[a]),0<=b&&c.excludes.splice(b,1),c.includes.push(d.use_includes[a]);if(d.use_matches)for(a=0;a<d.use_matches.length;a++)b=c.excludes.indexOf(d.use_matches[a]),0<=b&&c.excludes.splice(b,1),c.matches.push(d.use_matches[a]);if(d.use_excludes)for(a=0;a<d.use_excludes.length;a++)c.excludes.push(d.use_excludes[a]);
return c},doSave:function(c){return y(c).then(p)},doRemove:function(c,a){Q.removeByUid(c,a);Q.setStorageByUid(c,null);ha.dropAll(c);return A.Pledge()},doModify:function(c,a,b){void 0===b&&(b=!0);Q.setByUid(c,a,b);return b?ha.loadResources(c,a.resources).then(()=>ha.loadRequires(c,a.requires)).then(()=>{const d=[].concat(a.resources).concat(a.requires).map(f=>O.sanitize(f.unsafe_url,f.abs_url));return ha.dropAllBut(c,d)}):A.Pledge()},exportToJson:function(c,a){const b=A();var d=L.determineScriptsToRun(null);
c&&(d=M.select(d,f=>c[f.uuid]));d=Ma(d,{options_page:!0,externals:a.externals});a&&!a.storage||d.forEach(f=>{f.storage=Q.getStorageByUid(f.uuid)});d={scripts:d};if(!a||a.global_settings)d.global_settings=I.getValue(C.CONSTANTS.STORAGE.CONFIG,{});b.resolve(d);return b.promise()},importFromJson:function(c){if(!c||!c.scripts||!c.scripts.length)return A.Breach();const a={},b=[],d={},f={requires:{},resources:{}};for(let g=0,h;h=c.scripts[g];g++)try{const v=A();"new-user-script"!=h.uuid&&(h.storage&&(d[h.uuid]=
h.storage),["resources","requires"].forEach(q=>{let u;if(u=h[q])f[q][h.uuid]=u}),y({uuid:h.uuid,name:h.name,src:h.source,force_settings:{enabled:h.enabled,position:h.position},force_options:h.options,force_meta:{lastModified:h.lastModified},replace:!0,url:h.file_url||h.update_url,ask:!1}).done(q=>{a[M.createUUID()]=q;v.resolve()}).fail(q=>{B.warn("import: Error @ script",h.name,q);v.resolve()}),b.push(v.promise()))}catch(v){B.warn("import: Error while importing script",h.name,v)}const k=(()=>{const g=
A();A.when(b).always(()=>{g.resolve()});return g.promise()})().then(()=>ta.import({scripts:a,global_settings:c.global_settings,hints:rea.extension.inIncognitoContext&&"temporary"==w.values.incognito_mode?[{globalhint:!0,options:{image:"critical",text:l.getMessage("All_modifications_are_only_kept_until_this_incognito_session_is_closed_")}}]:[]})).then(g=>{const h=A(),v=[],q=[];if(g.ok)for(let u=0,e;e=g.import_ids[u];u++)(()=>{var r=e;if(a[r]){a[r].messages.warnings=[];const t=a[r].script.uuid;r=p(a[r]).progress(()=>
{["resources","requires"].forEach(z=>{let D;(D=f[z][t])&&D.length&&D.forEach(E=>{ha.setElement(t,E.url,{content:E.content||"",meta:E.mimetype||"text/javascript"},E.modified)})})}).done(()=>{let z;d[t]&&(z=Q.setStorageByUid(t,{data:d[t].data||{},ts:Date.now()}),q.push(z))});v.push(r)}})();A.when(v).always(()=>{L.reorderScripts();A.when(q).always(()=>{h.resolve(g)})});return h.promise()}).then(g=>c.global_settings&&g.global_settings?(g=I.setValue(C.CONSTANTS.STORAGE.CONFIG,c.global_settings).then(()=>
{k.done(()=>{window.setTimeout(sa.reset,1)});return A.Pledge({global_settings:!0})}),I.setTemporary(!0),g):A.Pledge({}));return k},installFromUrl:function(c,a,b){const d=A();let f;const k={messages:{errors:[l.getMessage("Unable_to_load_script_from_url_0url0",c)],warnings:[]}};a=a||{};b=b||{};const g=["url",c,JSON.stringify(a)].join("_");if(n.is(g))return B.debug("scriptman: de-bounced installFromUrl",c),A.Breach();n.add(g);if((f=O.parse(c))&&f.protocol.match(/(https?|file):/))"file:"!=f.protocol||
C.RUNTIME.ALLOWS_FILE_SCHEME_ACCESS||B.warn("scriptman: Access to local files is forbidden! Loading the following script for installation may fail:",c,"-> more info:","https://www.tampermonkey.net/faq.php#Q204");else return B.warn("scriptman: can't install from ",c),A.Breach(k);xa.getScriptFromURL(c).then(h=>{const v={url:c,src:h,ask:!0,replace:!0};a&&M.each(a,(q,u)=>{v[u]=a[u]});d.consume(x.installFromSource(h,v,b))}).fail(h=>{h?("file:"!=f.protocol||C.RUNTIME.ALLOWS_FILE_SCHEME_ACCESS||k.messages.warnings.unshift(l.getMessage("Tampermonkey_has_no_file_access_permission_")),
k.heading=l.getMessage("You_are_about_to_install_a_UserScript_"),b.silent_fail?d.reject(k):ta.installError(k).always(v=>{d.reject(v)})):d.reject()});return d.promise()},installFromSource:function(c,a,b){const d=A(),f={src:c,ask:!0,replace:!0};a&&M.each(a,(k,g)=>{f[g]=a[g]});x.doSave(f).done(k=>{d.resolve(k.installed)}).fail(k=>{k?(k.heading=l.getMessage("You_are_about_to_install_a_UserScript_"),b.silent_fail?d.reject(k):ta.installError(k).always(g=>{d.reject(g)})):d.reject()});return d.promise()},
determineLastPosition:function(){let c=0;Q.getUidList().forEach(b=>{const d=Q.getByUid(b);d.script&&d.cond?d.script.position&&d.script.position>c&&(c=d.script.position):B.warn("scriptman: inconsistent script entry",b)});const a=new U.Script;a.position>c&&(c=a.position);return c},convertToRegExp:function(c,a){let b,d;try{a||"/"!=c.substr(0,1)?a?(d=O.getRegExpFromMatch(c),b=new RegExp(d)):(d=O.getRegExpFromInclude(c),b=new RegExp(d,"i")):(d=("^"==c.substr(1,1)?"":".*")+c.replace(/^\//g,"").replace(/\/$/g,
"")+("$"==c.substr(-2,1)?"":".*"),d=d.replace(/(\.\*){1,}/g,".*"),b=new RegExp(d,"i"))}catch(f){return B.warn("scriptman: invalid regexp ",c),!1}return b},matchUrl:function(c,a){return""===c.replace(a,"")},regexify:function(c,a){const b={},d={inc:"rinc",match:"rinc",exc:"rexc"};Object.keys(d).forEach(f=>{const k=c[f]&&c[f].length?c[f].map(g=>x.convertToRegExp(g,"match"===f)).filter(g=>!1!==g):null;if(k||a)b[d[f]]=(b[d[f]]||[]).concat(k||[])});return b},validUrl:function(c,a,b){let d=!1;if(a.rinc){if(a.rinc.every(f=>
x.matchUrl(c,f)?(B.debug('scriptman: @include "'+f+'" matched'+(b?" ("+b+")":'"')),d=!0,!1):!0),!d)return d}else d=!0;a.rexc&&a.rexc.every(f=>x.matchUrl(c,f)?(B.debug('scriptman: @exclude "'+f+'" matched'+(b?" ("+b+")":'"')),d=!1):!0);return d},getEvilness:function(c){let a=0;return c.fileURL&&(a=Z.getEvilnessOf(c.fileURL))||c.downloadURL&&(a=Z.getEvilnessOf(c.downloadURL))||c.updateURL&&(a=Z.getEvilnessOf(c.updateURL))?(B.debug("scriptman: found blacklisted script",c),a):0},blackCheckAll:function(){Q.getUidList().forEach(c=>
{const a=Q.getByUid(c);if(a.script&&a.cond){var b=L.getEvilness(a.script);if(b!==a.script.evilness){if(b||void 0!==a.script.evilness)B.debug("scriptman: write blacklist state of ",a.script.name,b),b&&ea.tS(a.script.name,b,"b");a.script.evilness=b;x.doModify(c,a.script,!1)}}})},reorderScripts:function(c,a){let b=x.determineScriptsToRun();if(c)for(var d=0;d<b.length;d++){const f=b[d];f.uuid==c&&(f.position=Number(a)+(f.position<a?.5:-.5))}b=m(b);c=1;for(a=0;a<b.length;a++)d=b[a],d.position=c++,x.doModify(d.uuid,
d,!1)},getScriptHistoryForTab:function(c){if(T.get.empty(c.id))B.debug("bg: WARN: Tabs.get.urls["+c.id+"] is empty!");else return T.get.history(c.id);return{}},getUniqueScriptsForTab:function(c){const a={};T.get.empty(c.id)?B.debug("bg: WARN: Tabs.get.urls["+c.id+"] is empty!"):M.each(T.get.urls(c.id),(b,d)=>{pa.isAllowed(d)&&(b=qa.get(b.frameId,d),[b.runners,b.disabled,b.evilness].forEach(f=>{f.forEach(k=>{a[k.uuid]={script:k}})}))});return a},scriptWillRun:function(c,a){if(a&&c){var b=ba.items.regexp.get(c);
if(!b){if(!(b=I.getValue(C.CONSTANTS.PREFIX.COND+c,null)))return;b=x.regexify(b,!0);ba.items.regexp.set(c,b)}return!!x.validUrl(a,b,c)}},determineScriptsToRun:function(c,a){const b=[];B.log("scriptman: determineScriptsToRun @"+c);Q.getUidList().forEach(d=>{let f=!0;var k=0;c&&(k=Date.now(),f=x.scriptWillRun(d,c),k=Date.now()-k);const g=Q.getByUid(d);g.script&&g.cond?(a&&1E3<k&&(B.warn("scriptman: checking "+g.script.name+"'s ("+d+") includes and excludes took "+k+"ms!"),fa.all("status",{key:"slowdown",
class:"warning",text:l.getMessage("Script_0name0_is_slowing_down_some_page_loads_",g.script.name),timeout:3E5})),f&&b.push(g.script)):B.warn("scriptman: inconsistent script entry",d,g)});return m(b)},isContexter:function(c){return c.options&&("context-menu"===c.options.run_at||null===c.options.run_at&&"context-menu"===c.options.override.orig_run_at)},determineOrigin:function(c){return x.determineOriginOfUrl(c.fileURL||c.downloadURL||c.updateURL)},determineOriginOfUrl:function(c){if(c){var a=c.match(/https?:\/\/userscripts\.org\/scripts\/(source|version)\/([0-9]{1,9})\.user\.js/)||
c.match(/https?:\/\/userscripts-mirror\.org\/scripts\/(source|version)\/([0-9]{1,9})\.user\.js/);if(a&&3==a.length)return{id:a[2],token:"uso",meta_url:!0,url:"http://userscripts-mirror.org/scripts/show/"+a[2],issue_url:"http://contactbyweb.com/userscripts-mirror"};if((a=c.match(/https?:\/\/greasyfork\.org\/scripts\/([^/]+)\/code\/.*\.user\.js/))&&2==a.length)return c=a[1],{id:c,token:"gf",meta_url:!0,url:"https://greasyfork.org/scripts/"+c,issue_url:"https://greasyfork.org/scripts/"+c+"/feedback",
updates_allowed:function(b){return!b.match(/https?:\/\/greasyfork\.org\/scripts\/([^/]+)\/code\/.*\.user\.js.*version=[0-9]+.*/)}};if((a=c.match(/https?:\/\/openuserjs\.org\/install\/([^/]+)+\/(.*)\.user\.js/))&&3==a.length)return a.shift(),{id:a.join("/"),token:"ouj",meta_header:!0,url:"https://openuserjs.org/scripts/"+a[0]+"/"+a[1],issue_url:"https://openuserjs.org/scripts/"+a[0]+"/"+a[1]+"/issues"};if((a=c.match(/https?:\/\/monkeyguts\.com\/(codepages\/)?([0-9]{1,9})\.user\.js/))&&3==a.length)return c=
a[2],{id:c,token:"mog",meta_url:!0,url:"https://monkeyguts.com/code.php?id="+c,issue_url:"https://monkeyguts.com/code.php?nav=rev&id="+c};if((a=c.match(/https?:\/\/raw\.githubusercontent\.com\/([^/]+)\/([^/]+)\/.*\.user\.js/)||c.match(/https?:\/\/github\.com\/([^/]+)\/([^/]+)\/raw\/.*\.user\.js/)||c.match(/https?:\/\/github\.com\/([^/]+)\/([^/]+)\/releases\/download\/.*\.user\.js/))&&3==a.length)return a.shift(),c=a.join("/"),{id:c,token:"gh",url:"https://github.com/"+c,issue_url:"https://github.com/"+
c+"/issues"};if((a=c.match(/https?:\/\/gitlab\.com\/([^/]+\/?[^/]*)\/([^/]+)\/raw\/.*\.user\.js/))&&3==a.length)return a.shift(),c=a.join("/"),{id:c,token:"gl",url:"https://gitlab.com/"+c,issue_url:"https://gitlab.com/"+c+"/issues"};if((a=c.match(/https?:\/\/bitbucket\.org\/([^/]+)\/([^/]+)\/(?:raw|downloads)\/.*\.user\.js/))&&3==a.length)return a.shift(),c=a.join("/"),{id:c,token:"bb",url:"https://bitbucket.org/"+c,issue_url:"https://bitbucket.org/"+c+"/issues"};if((c=c.match(/https?:\/\/userstyles\.org\/styles\/userjs\/([^/]+)\/.*\.user\.js/))&&
2==c.length)return c.shift(),{id:c[0],token:"usty",url:"https://userstyles.org/styles/"+c[0],issue_url:"https://forum.userstyles.org/post/discussion?Discussion/StyleID="+c[0],convert:function(b){let d,f,k,g;const h=[{tag:"includes",re:/(?: \|\| \(new RegExp\("\^)([^$]+)(?:\$"\)\)\.test\(document\.location\.href\))/g,idx:1,value:function(q){return"/^"+q.replace(/\\\\(.)/g,"\\$1")+"$/"}},{tag:"includes",re:/(?: \|\| \(document\.location\.href\.indexOf\(")([^"]+)"(?:\) == 0\))/g,idx:1,value:function(q){return q+
"*"}},{tag:"matches",re:/(?: \|\| \(document\.domain == ")([^"]+)"(?: \|\| document\.domain\.substring\(document\.domain\.indexOf\("[^"]+"\) \+ 1\) == "[^"]+"\))/g,idx:1,value:function(q){return"*."+q}}],v=new RegExp("(?:if \\(false)("+h.map(q=>"(?:"+q.re.source+")").join("|")+")+","g");0===b.includes.length&&0===b.matches.length&&0===b.excludes.length&&b.options&&b.options.override&&b.options.override.orig_includes&&0===b.options.override.orig_includes.length&&b.options.override.orig_matches&&0===
b.options.override.orig_matches.length&&(f=b.textContent.match(v))&&(f.forEach(q=>{h.forEach(u=>{for(;k=u.re.exec(q);)if(k.length>u.idx){const e=u.value(k[u.idx]);b.options.override["orig_"+u.tag].push(e);b[u.tag].push(e);g=!0}})}),g&&(d=l.getMessage("Automatically_added_user_includes_for_compatibility_reasons_")));return{script:b,warning:d}}}}},clean:function(c){Q.getUidList().forEach(a=>{const b=Q.getByUid(a);if(!b.script||!b.cond){if(c)return B.warn("scriptman: inconsistent script entry",a,b);
x.doRemove(a,!0)}})}};return x})();scma=L;var Q=(()=>{let m=[];const y={init:function(){I.addDifferentOriginChangeListener(C.CONSTANTS.PREFIX.STORE,(p,n)=>{if(n&&n.hasOwnProperty("value")&&n.origin){var x=p.replace(C.CONSTANTS.PREFIX.STORE,"");for(const c in n.value.data)n.value.data.hasOwnProperty(c)&&(()=>{const a=c,b=n.value.data[c];y.notifyStorageListeners({uuid:x},null,d=>{const f={data:{},ts:0};f.data[a]=b;f.ts=n.value.data.ts;const k={storage:f};void 0===f.data[a]&&(k.removed=a);d(k)})})()}})},
getUidList:function(){const p=new RegExp("^"+C.CONSTANTS.PREFIX.SCRIPT_UID),n=[];I.listValues().forEach(x=>{-1!=x.search(p)&&n.push(x.replace(p,""))});return n},getUidsByName:function(p,n){const x=[];y.getUidList().forEach(c=>{const a=y.getMetaByUid(c);!a||a.name!=p||n&&n!=a.namespace||x.push(c)});return x},getUidByName:function(p){return y.getUidsByName(p)[0]},getStorageByUid:function(p){p=I.getValue(C.CONSTANTS.PREFIX.STORE+p,{ts:0,data:{}});"undefined"===typeof p.ts&&(p.ts=0);"undefined"===typeof p.data&&
(p.data={});return p},setStorageByUid:function(p,n){return n?I.setValue(C.CONSTANTS.PREFIX.STORE+p,n):I.deleteValue(C.CONSTANTS.PREFIX.STORE+p)},getMetaByUid:function(p){return I.getValue(C.CONSTANTS.PREFIX.META+p,null)},getByUid:function(p,n){if(!p)return B.error("sb: no UUID set"),{};let x,c=I.getValue(C.CONSTANTS.PREFIX.META+p,null);if(c){const a=b=>{if(b)for(let d=0,f=null;f=b[d];d++)delete f.loaded,delete f.textContent,delete f.resURL,delete f.resText};a(c.requires);a(c.resources);c.uuid=p;c.grant=
c.grant||[];c.options.override.use_connects||(c.connects=c.connects||[],c.options.override.merge_connects=!0,c.options.override.use_connects=[]);void 0===c.options.check_for_updates&&(c.options.check_for_updates=!0);n&&(c=M.copy(c,{}));c.textContent=I.getValue(C.CONSTANTS.PREFIX.SCRIPT+p,c.textContent);c.textContent&&(x=c)}return{script:x,cond:I.getValue(C.CONSTANTS.PREFIX.COND+p,null)}},setByUid:function(p,n,x){const c={};if(!p)return B.error("sb: no UUID set",n),c;if(null===n.textContent||void 0===
n.textContent)throw Error("No script code set!");const a=I.getValue(C.CONSTANTS.PREFIX.META+p),b=!a,d={},f=M.copy(n,{});f.textContent=null;d[C.CONSTANTS.PREFIX.META+p]=f;d[C.CONSTANTS.PREFIX.SCRIPT_UID+p]=n.name;d[C.CONSTANTS.PREFIX.COND+p]={inc:n.includes,match:n.matches,exc:n.excludes};d[C.CONSTANTS.PREFIX.SCRIPT+p]=n.textContent;I.setValues(d);x&&(Da.onScriptsChanged(),b?ca.scriptAddedCb(n.name,n):ca.scriptChangedCb(n.name,n,a));ba.items.rundata.removeAll();ba.items.regexp.remove(p);return c},
removeByUid:function(p,n){void 0===n&&(n=!0);const x=y.getByUid(p);I.deleteValue(C.CONSTANTS.PREFIX.SCRIPT_UID+p);I.deleteValue(C.CONSTANTS.PREFIX.COND+p);I.deleteValue(C.CONSTANTS.PREFIX.SCRIPT+p);I.deleteValue(C.CONSTANTS.PREFIX.META+p);I.deleteValue(C.CONSTANTS.PREFIX.STORE+p);n&&(Da.onScriptsChanged(),x.script&&x.cond&&(ca.scriptRemovedCb(x.script.name,x.script),w.values&&ea.tS(x.script.name,null,"r")));ba.items.rundata.removeAll();ba.items.regexp.remove(p);return{}},addStorageListener:function(p,
n,x,c,a){m.push({tabid:p,id:n,uuid:x,time:c,response:a})},removeStorageListeners:function(p,n){void 0===n&&(n=!0);const x=m;m=[];x.forEach(c=>{try{void 0!==p.tabid&&p.tabid!==c.tabid||void 0!==p.uuid&&p.uuid!==c.uuid||void 0!==p.id&&p.id!==c.id?m.push(c):n&&c.response({})}catch(a){B.debug("sb: listener clear for script",p,"failed! Page reload?!")}})},notifyStorageListeners:function(p,n,x){p=p||{};n=n||{};m.forEach(c=>{try{void 0!==n.uuid&&c.uuid===n.uuid||void 0!==n.tabid&&c.tabid===n.tabid||void 0!==
n.id&&c.id===n.id||void 0!==p.tabid&&p.tabid!==c.tabid||void 0!==p.uuid&&p.uuid!==c.uuid||void 0!==p.id&&p.id!==c.id||x&&x(c.response)}catch(a){B.warn("sb: listener notification for script",p,"failed! Page reload?!")}})}};return y})();scbr=Q;var Ka=(()=>{const m=()=>{Q.getUidList().forEach(y=>{const p=Q.getByUid(y);p.script&&p.cond&&p.script.evilness!=Z.SEVERITY_FOISTED_SCRIPT&&(B.warn("content security: found unfamiliar script",p.script.name),p.script.evilness=Z.SEVERITY_FOISTED_SCRIPT,L.doModify(y,
p.script,!1),ea.tS(p.script.name,p.script.fileURL||p.script.downloadURL||p.script.updateURL,"f"))})};return{init:function(){return A.Pledge()},check:function(){return A.Pledge()},onInstalled:function(){C.DB.SECURE||m()},onUpdated:function(){}}})(),Ra=(()=>{const m={ping:{allow:{insecure:!0},exec:function(a,b,d){d({pong:!0,instanceID:Qa,config:{layout:w.values.layout,dark:rea.runtime.isDarkMode()}})}},newTab:{allow:{extpage:!0},exec:function(a,b,d){("options"==b.extpage||"options"==a.origin?A.Pledge(b.tab):
Ja()).then(f=>{rea.tabs.create({url:a.url,parent:f},k=>{d({tabId:k.id})})})}},tabs:{allow:{script:!0},exec:function(a,b,d){"get"==a.action?b.tab&&a.uuid?d({data:Ha.get(b.tab.id,a.uuid)}):(B.warn("bg: unable to process request",b,a),d({data:null})):"list"==a.action?a.uuid?d({data:Ha.getAll(a.uuid)}):(B.warn("bg: unable to process request",b,a),d({data:null})):"set"==a.action?(b.tab&&a.uuid?Ha.set(b.tab.id,a.uuid,a.tab):B.warn("bg: unable to process request",b,a),d({})):d({error:"unknown action"})}},
focusTab:{allow:{script:!0},exec:function(a,b,d){(a=b&&b.tab?b.tab.id:null)?rea.tabs.update(a,{active:!0},()=>{const f=rea.runtime.lastError;d({error:f?f.message:void 0})}):d({error:"internal error"})}},closeTab:{allow:{script:!0},exec:function(a,b,d){const f=b&&b.tab?b.tab.id:null;f?rea.tabs.query({windowType:"normal"},k=>{1>=k.length?(B.warn("bg:","refused to close last tab!"),d({error:"refused to close last tab!"})):rea.tabs.remove(f,()=>{const g=rea.runtime.lastError;d({error:g?g.message:void 0})})}):
d({error:"internal error"})}},setOption:{allow:{extpage:!0},exec:function(a,b,d){const f="options"==b.extpage||"options"==a.origin;w.setValue(a.name,a.value).always(()=>{f?na.create("options.settings").done(k=>{d({items:k,options:w.snapshot})}).fail(k=>{d({error:k,options:w.snapshot})}):d({})})}},reportAnIssue:{allow:{extpage:!0},exec:function(a,b,d){("options"==b.extpage||"options"==a.origin?A.Pledge(b.tab):Ja()).then(f=>{let k,g,h,v;if(a.uuid&&(k=Q.getByUid(a.uuid))&&k.script&&k.cond){g=L.determineOrigin(k.script);
let q;if("hoster"==a.to&&g)h=g,v=[h.token,h.id].join(":");else if(q=k.script.supportURL||g.issue_url||g.url)h={issue_url:q},v=g?[a.to,g.token,g.id].join(":"):[a.to,h.url].join(":");h&&(ea.tS(k.script.name,v,"m"),rea.tabs.create({url:h.abuse_url||h.issue_url,active:!0,parent:f},()=>{}))}d({})})}},begEvent:{allow:{extpage:!0},exec:function(a,b,d){if("dialog"==a.action)ya.dialog.shown(a.extra);else if("clicked"==a.action){let f,k;a.extra&&(f=a.extra.amount,k=a.extra.currency);ya.clicked(a.type,f,k)}else if(ya.button[a.action])ya.button[a.action](a.type,
a.extra);else B.warn("bg: Warning: unknown request ",a);d({})}},buttonPress:{allow:{extpage:!0},exec:function(a,b,d){b=()=>{d({})};if("reset_simple"==a.name)sa.reset(b);else if("reset_factory"==a.name)sa.factoryReset(b);else if("reset_sync"==a.name)ca.reset().always(b);else if("install_tests"==a.name)(b=Na.framework.prepare(L,Q,C.RUNTIME.BROWSER,C.RUNTIME.BROWSER_VERSION,b))&&B.error(b);else if("enabled"==a.name)w.setValue(a.name,!w.values[a.name]).always(()=>{d({})});else if("installFromUrl"==a.name)L.installFromUrl(a.data).always(()=>
{d({})});else if("externals_delete"==a.name)ha.cleanElement(a.scriptuid,a.safe_url),na.create("options.scripts").done(f=>{d({items:f,options:w.snapshot})}).fail(f=>{d({error:f,options:w.snapshot})});else if("focus_tab"==a.name)m.focusTab.exec({},{tab:{id:a.tabid}},d);else if("run_script_updates"==a.name)if(a.scriptuid){let f;xa.check(!0,!1,a.scriptuid).done(k=>{f=k}).always(()=>{d({scriptuid:a.scriptuid,updatable:f})})}else xa.check(!0,!0),d({});else B.warn("bg: Warning: unknown button "+a.name),
d({})}},loadTree:{allow:{extpage:!0},exec:function(a,b,d){na.create(a.referrer,{complete:a.complete,url:a.url,uuid:a.uuid,filter:a.filter,tabId:a.tabId}).done(f=>{f={items:f};const k=1==na.level(a.referrer)?{i18n:w.values.i18n,options:w.snapshot,xhr:ma.getConfig(),version:rea.extension.manifest.version,begging:ya.needed()}:{};d(Object.assign(f,k))}).fail(f=>{d({error:f,options:w.snapshot})})}},modifyScriptOptions:{allow:{extpage:!0},exec:function(a,b,d){if(a.uuid){var f="options"==b.extpage||"options"==
a.origin,k=void 0==a.reload||1==a.reload,g=!1,h=Q.getByUid(a.uuid,!0),v=()=>{k?(void 0!==a.position&&L.reorderScripts(a.uuid,a.position),f?m.loadTree.exec({referrer:"options.scripts"},b,d):rea.tabs.getSelected(null,q=>{na.create("actions").done(u=>{d({items:u,i18n:w.values.i18n,options:{enabled:w.values.enabled}})}).fail(()=>{d({i18n:w.values.i18n,options:{enabled:w.values.enabled}})});!q||0>q.id||a.uuid&&w.values.autoReload&&rea.tabs.sendMessage(q.id,{method:"reload"},{frameId:0})})):d({})};if(h.script&&
h.cond)if(a.whitewash&&h.script.evilness==Z.SEVERITY_FOISTED_SCRIPT)k=!0,h.script&&h.cond?L.doSave({uuid:a.uuid,src:h.script.textContent,force_settings:{enabled:!0},whitewash:!0,save:!0}).always(v):(B.error(l.getMessage("fatal_error")+" ("+a.uuid+")!!!"),v());else{let q=!1;const u=new U.Script;Object.keys(u.options).forEach(r=>{void 0!==a[r]&&(h.script.options[r]=a[r],g|=!0===ca.SYNCED[r])});Object.keys(u.options.override).forEach(r=>{-1!=r.indexOf("merge_")&&void 0!==a[r]&&(h.script.options.override[r]=
a[r],q=!0)});["includes","excludes","matches"].forEach(r=>{void 0!==a[r]&&(q=!0,h.script.options.override["use_"+r]=a[r])});["connects","blockers"].forEach(r=>{void 0!==a[r]&&(h.script.options.override["use_"+r]=a[r])});a.add_excludes&&(h.script.options.override.use_excludes=h.script.options.override.use_excludes.concat(a.add_excludes),q=!0);q&&(h.script=L.mergeCludes(h.script));a.temp_connects&&Ea.setSessionConnects(h.script.uuid,a.temp_connects);let e;void 0!==a.enabled&&(e=h.script.enabled!=a.enabled,
h.script.enabled=a.enabled);g&&(h.script.lastModified=Date.now());void 0!==a.file_url&&(h.script.downloadURL=a.file_url);L.doModify(h.script.uuid,h.script,g).done(v).fail(()=>{d({})}).always(()=>{if(e)Da.onScriptsChanged()})}else d({})}else d({})}},saveScript:{allow:{extpage:!0},exec:function(a,b,d){const f=void 0===a.reload||!!a.reload,k=g=>{f?na.create("options.scripts").done(h=>{g.items=h;g.options=w.snapshot;d(g)}).fail(h=>{d({error:h,options:w.snapshot})}):d({})};if(a.clean){B.debug("bg: clean userscript "+
a.uuid);b=Q.getByUid(a.uuid);const g=h=>{na.create("options.scripts").done(v=>{d({cleaned:h.installed,items:v,options:w.snapshot});h.installed&&Q.notifyStorageListeners({uuid:a.uuid},null,q=>{q({storage:Q.getStorageByUid(a.uuid)})})}).fail(v=>{d({error:v,options:w.snapshot})})};b.script&&b.cond?L.doSave({name:a.name,uuid:a.uuid,src:b.script.textContent,clean:!0,ask:!1,internal:!0,save:!0}).always(h=>{g(h||{installed:!1})}):(B.error(l.getMessage("fatal_error")+" ("+a.uuid+")!!!"),g({installed:!1}))}else if(a.code){let g=
d;f&&(g=h=>{L.reorderScripts();k(h)});a.new_script&&(a.uuid=M.createUUID());L.doSave({name:a.name,uuid:a.uuid,force_url:a.force_url,src:a.code,ask:!w.values.editor_easySave,lastModTime:a.lastModTime,save:!0}).always(h=>{g(h||{installed:!1})})}else a.auto_save||(L.doRemove(a.uuid),L.reorderScripts()),k({})}},saveExternal:{allow:{extpage:!0},exec:function(a,b,d){ha.setElement(a.uuid,a.url,{content:a.code||"",meta:a.mimetype||"text/javascript"},!0);na.create("options.scripts").done(f=>{d({success:!0,
items:f,options:w.snapshot})}).fail(f=>{d({error:f,options:w.snapshot})})}},saveStorageKey:{allow:{extpage:!0},exec:function(a,b,d){n.saveStorageKey.exec(null,a,b,d)}},importFromJson:{allow:{extpage:!0},exec:function(a,b,d){const f=void 0===a.reload||!!a.reload;L.importFromJson(a.json).fail(k=>{d({error:k||l.getMessage("An_error_occured_during_import_")})}).done(k=>{const g={reload:k.global_settings};f&&!g.reload?na.create("options.scripts").done(h=>{g.items=h;g.options=w.snapshot;d(g)}).fail(h=>
{d({error:h,options:w.snapshot})}):d(g)})}},download:{allow:{extpage:!0},exec:function(a,b,d){n.download.exec(null,a,b,f=>{(f.error||f.load)&&d(f)})}},askCom:{allow:{extpage:!0},exec:function(a,b,d){ta.onMessage(a.data).always(f=>{f.i18n=w.values.i18n;f.options=w.snapshot;f.ext={version:rea.extension.manifest.version};d(f)})}},installScript:{allow:{extpage:!0},exec:function(a,b,d){if(b.tab){let f={};a=a.code?L.installFromSource(a.code,{},{silent_fail:!0}):L.installFromUrl(a.url,{},{silent_fail:!0});
a.done(k=>{f={data:null,found:!0,installed:k}}).fail(k=>{f.err=k&&k.messages&&k.messages.errors?k.messages.errors[0]:l.getMessage("Unable_to_parse_this_")}).always(()=>{d(f)})}else B.warn("bg: Error: unable to install script due to empty tabID!")}},execMenuCmd:{allow:{extpage:!0},exec:function(a,b,d){(a=za.getById(a.id))?a.response({run:!0,menuId:a.id}):B.warn("bg: Error: unable to find MC id "+a.id);d({})}},unLoad:{allow:{script:!0},exec:function(a,b){a.topframe||a.id&&b.tab&&b.frameId&&T.events.unload(b.tab.id,
b.frameId,a.id);return!1}},prepare:{allow:{script:!0},exec:function(a,b,d){if(b.tab){const f=void 0!==b.frameId?b.frameId:a.topframe?0:null,k=O.woHash(a.url);a.cleanup?(T.events.clean(b.tab.id,f,k),ka.setIcon(b.tab.id),ka.setBadge(b.tab.id),d({})):T.events.run(b.tab.id,f,a.id,k,g=>{g=g?qa.answer(g,a.url):{fast:!0};d(g);ka.setIcon(b.tab.id);ka.setBadge(b.tab.id)})}else d({})}},notification:{allow:{script:!0,extpage:!0},exec:function(a,b,d){const f=a.image?a.image:ia.images.brand("tampermonkey");(()=>
{const k=A();a.highlight&&b.tab?oa.highlight(b.tab.id,k.resolve):k.resolve();return k.promise()})().then(()=>{const k=A();a.text?oa.show(a.title,a.text,f,{timeout:a.timeout,silent:a.silent},k.resolve):k.resolve();return k.promise()}).always(k=>{d({clicked:k&&k.clicked})})}},clipboard:{allow:{script:!0,extpage:!0},exec:function(a,b,d){rea.clipboard?rea.clipboard.set({mimetype:a.mimetype,content:a.content},()=>{d({success:!0})}):d({error:"unsupported"})}},determineScriptsToRun:{allow:{extpage:!0},exec:function(a,
b,d){d({scripts:L.determineScriptsToRun(a.url).map(f=>f.uuid)})}},syntaxCheck:{allow:{script:!0,extpage:!0},exec:function(a,b,d){(()=>{const f=A();Registry.require("hinter",()=>{f.resolve(Registry.get("hinter"))});return f.promise()})().then(f=>f.hint(a.code,w.values.editor_linter_config||void 0)).always(f=>{d({errors:f})})}},externalMessage:{allow:{insecure:!0},exec:function(a,b,d){{a=a.request;let v;if("off"!=w.values.external_connect&&(v=b.url)&&pa.isAllowed(v)){var f,k=Object.keys(c.externally_connectable);
for(let q=0;q<k.length;q++){var g=k[q];b=c.externally_connectable[g];if((f=L.regexify({match:[g]}))&&L.validUrl(v,f)&&(b.includes("*")||b.includes(a.method))){var h=!0;break}}if(h)if("getVersion"==a.method)d({version:rea.extension.manifest.version,id:rea.runtime.short_id});else if("all"!=w.values.external_connect)B.warn("mh: calling external method "+a.method+" is not permitted to "+v+" by the user");else if("isInstalled"==a.method){let q,u,e,r;f=!1;h=a.script.name;(u=Q.getUidsByName(h,a.script.namespace)[0])&&
(q=Q.getByUid(u))&&q.script&&(f=!0,r=q.script.enabled,e=q.script.version);d({name:h,installed:f,enabled:r,version:e})}else B.warn("mh: unknown external method "+a.method);else B.warn("mh: calling external method "+a.method+" is not permitted to "+v)}}}},cookie:{allow:{script:!0},exec:function(a,b,d){const f="expirationDate domain httpOnly secure session name path sameSite value".split(" ").concat(["url"]),k=f.concat(["hostOnly"]),g=a.url||b.url||null,h=a.details.url?O.sanitize(a.details.url,g)||a.details.url:
g;b=b.tab?b.tab.cookieStoreId:void 0;let v;la.fpi&&(v=O.parse(g).domain);if(C.DB.SECURE||"dhdg"!=rea.runtime.short_id)if(h)if(pa.isAllowed(O.woHash(h)))if(L.scriptWillRun(a.uuid,h))if("list"==a.action)la.getAll({url:h,domain:a.details.domain,name:a.details.name,path:a.details.path,firstPartyDomain:v?null:void 0,storeId:b}).done(q=>{q=q.map(u=>{const e={};k.forEach(r=>{e[r]=u[r]});return e});d({data:{cookies:q}})});else if("delete"==a.action)la.remove({url:h,name:a.details.name,firstPartyDomain:v,
storeId:b}).done(()=>{d({data:{success:!0}})}).fail(q=>{d({data:{error:q}})});else if("set"==a.action){const q={firstPartyDomain:v,storeId:b},u=a.details;f.forEach(e=>{void 0!==u[e]&&(["value","name"].includes(e)?q[e]=String(u[e]):q[e]=u[e])});q.url=q.url||h;la.set(q).done(()=>d({data:{success:!0}})).fail(e=>d({data:{error:e}}))}else d({data:{error:"unknown action"}});else d({data:{error:"the URL needs to be included by the scripts @include or @match tag"}});else d({data:{error:"the URL is filtered by the security settings"}});
else d({data:{error:"invalid URL"}});else d({data:{error:"not supported"}})}},api:{allow:{script:!0},exec:function(a,b,d){ea.tA(a.name,a.type);d()}}},y=a=>{var b=rea.runtime.id;b=!C.REQUESTS.HAS_SENDER_ID&&a.tab||a.id===b;let d=null;var f=C.REQUESTS.INTERNAL_PAGE_PROTOCOLS[0];f=f?f+"//":null;var k=C.REQUESTS.GET_INTERNAL_PAGE_REGEXP();a=a.url?a.url:a.tab?a.tab.url:null;let g=b&&(!a||(f?0==a.indexOf(f):!1));if(g||!f)a?(k=a.match(k))&&2==k.length&&(d=k[1]):d="*",!f&&d&&(g=!0);return{id_valid:b,url:a,
page:d,extpage:g}},p=(a,b,d)=>{if(!W.late)return W.registerLateCallback(()=>{p(a,b,d)}),!0;var f=m[a.method];if(!f)return B.warn("mh: unknown method "+a.method),!1;if(!f.allow||!f.exec)return B.warn("mh: invalid implementation of "+a.method),!1;var k=y(b);const g=k.extpage,h=k.page;k=k.id_valid;g?b.extpage=h:delete a.origin;const v="options"==h;let q=!0;if("background"==h||f.allow.insecure||f.allow.extpage&&g||f.allow.options&&v||f.allow.script&&k&&!g)return f=f.exec(a,b,u=>{q=!1;d(u)}),!1===q||!1===
f?void 0:!0;!1===a.topframe&&(g||v)||B.warn("mh: this context doesn't have the permission to call \""+a.method+'"');return!1};var n={xhr:{allow:{script:!0},exec:function(a,b,d,f){let k=!1;const g=C.RUNTIME.FIREFOX&&!b.details.anonymous&&(d.tab&&d.tab.incognito||la.fpi);let h;const v=d.tab?d.tab.cookieStoreId:void 0;g&&(b.details.anonymous=!0,la.fpi&&d.url&&(h=O.parse(d.url).domain||""));const q=t=>{a.disconnect();const z=t.response;t=z?z.responseHeaders:null;g&&t&&(t=ma.parseHeaders(t)["set-cookie"])&&
t.split(",").forEach(D=>{if(D=ma.parseCookie(D)){var {expires:E,httpOnly:F,name:N,path:G,sameSite:H,secure:J,value:K}=D;la.set({expirationDate:E?E.getTime():void 0,httpOnly:F,name:N,path:G,sameSite:H,secure:J,storeId:v,url:z.finalUrl||b.details.url,value:K,firstPartyDomain:h})}})};b.details.convertBinary=!0;b.details.partialSize=b.details.partialSize||C.XMLHTTPREQUEST.PARTIAL_SIZE;const u={};Object.keys(b.callbacks).forEach(t=>{const z="ondone"===t;if(b.callbacks[t]||z||"onload"===t)u[t]=D=>{D=D||
{};z&&D.response&&delete D.response.response_data;const E={data:D.response,exception:D.exception};E[t]=!0;f(E);z&&q(D)}});u.ondone||(u.ondone=q);let e;b.details.url=O.sanitize(b.details.url,b.url||d.url||null)||b.details.url;C.RUNTIME.WEBREQUEST_XHR_SUPPORT&&"no"!=w.values.webrequest_modHeaders&&(b.details.headers=b.details.headers||{},b.details.headers.internal=b.uuid,C.REQUESTS.SENDS_ORIGIN&&!Object.keys(b.details.headers).map(t=>t.toLowerCase()).includes("origin")&&(b.details.headers.origin=null));
(()=>(b.details.cookie||g)&&b.details.url?la.getAll({url:b.details.url,storeId:v,firstPartyDomain:h?null:void 0}).then(t=>{t=t.map(z=>z.name+"="+encodeURIComponent(z.value)).concat([b.details.cookie]).join(";");delete b.details.cookie;b.details.headers=b.details.headers||{};b.details.headers.cookie=t}):A.Pledge())().then(()=>{if(k){if(u.onabort)u.onabort();u.ondone({})}else{var t;if(b.details.url&&(t=O.parse(b.details.url).protocol)&&["file:"].concat(C.REQUESTS.INTERNAL_PAGE_PROTOCOLS).includes(t)){const z=
D=>{const E='Refused to connect to "'+b.details.url+'": '+D,F=ma.makeErrorResponse(E);["onerror","ondone"].forEach(N=>{if(u[N])u[N]({response:F,exception:E})})};if("file:"==t){let D,E;C.RUNTIME.ALLOWS_FILE_SCHEME_ACCESS&&("all"==w.values.script_file_access?D=!0:"externals"==w.values.script_file_access&&(E=Q.getByUid(b.uuid))&&E.script&&E.cond&&[].concat(E.script.resources).concat(E.script.requires).map(F=>O.sanitize(F.unsafe_url,F.abs_url)).includes(b.details.url)&&(D=!0));if(!D)return z("Access to this local file is forbidden!")}rea.file.get(b.details.url,
D=>{const E={response_data:Y.arrbuf2str(D),readyState:4,responseHeaders:"",status:0,statusText:""};["onload","ondone"].forEach(F=>{if(u[F])u[F]({response:E})})},z)}else e=Ea.exec(b.details,b.uuid,d||{},u)}});const r=()=>{k||(e?e.abort():k=!0)};a&&a.onMessage.addListener(t=>{t.cancel&&r()});return r}},download:{allow:{script:!0},exec:function(a,b,d,f){let k=aa.start(b.details,{onload:g=>{f&&f({load:!0,data:g})},onprogress:g=>{f&&f({progress:!0,data:g})},onerror:g=>{f&&f({error:!0,data:g})},ontimeout:g=>
{f&&f({timeout:!0,data:g})},ondone:()=>{a&&a.disconnect();a=null}},{internal:null===a});a&&void 0!==k&&a.onMessage.addListener(g=>{g.cancel&&null!==k&&(aa.cancel(k),k=null)});return()=>{f=a=null}}},webRequest:{allow:{script:!0},exec:function(a,b,d,f){a=d.tab.id;d=d.frameId;(void 0!==a&&void 0!==d||!b.uuid)&&ua.scripts.set(a,d,b.uuid,b.rules,k=>{f(k)})}},addStorageListener:{allow:{script:!0},exec:function(a,b,d,f){if(d.tab)return Q.addStorageListener(d.tab.id,b.id,b.uuid,Date.now(),f),()=>{Q.removeStorageListeners({uuid:b.uuid,
id:b.id},!1)};f({error:!0})}},saveStorageKey:{allow:{script:!0},exec:function(a,b,d,f){if(d.tab){if(b.uuid){a=Q.getStorageByUid(b.uuid);const k=b.value,g=b.key;a.data[g]=k;a.ts=b.ts;Q.setStorageByUid(b.uuid,a);Q.notifyStorageListeners({uuid:b.uuid},{id:b.id},h=>{const v={data:{},ts:b.ts},q={storage:v};void 0===k?q.removed=g:v.data[g]=k;h(q)})}}else B.warn("storage: unable to save storage due to empty tabID!");f({})}},exportToJson:{allow:{extpage:!0},exec:function(a,b,d,f){L.exportToJson(b.ids,b.options).done(k=>
{k=JSON.stringify(k);M.splitSlice(k,parseInt(C.XMLHTTPREQUEST.PARTIAL_SIZE)).forEach(g=>f({partial:g}));f({done:!0})}).fail(()=>{f({error:!0})})}},openInTab:{allow:{script:!0},exec:function(a,b,d,f){const k=["active"],g={url:b.details.url};let h=null;if(b=b.details.options){for(let v=0;v<k.length;v++)void 0!==b[k[v]]&&(g[k[v]]=b[k[v]]);b.incognito?g.incognito=!0:(b.insert&&(g.index=d.tab.index+1),g.parent=b.setParent?d.tab:{windowId:d.tab.windowId})}rea.tabs.create(g,v=>{v&&(h=v.id,a&&(Ba[h]={onClose:function(){a&&
f({closed:!0})}},f({success:!0,tabId:h})))});a.onMessage.addListener(v=>{if(null!==h)if(v.close)rea.tabs.remove(h,()=>{const q=rea.runtime.lastError;q?B.warn("tab.close",q.message):h=null});else if(void 0!==v.name){let q=0;const u=()=>{T.listeners.once.whenReady(h,()=>{rea.tabs.sendMessage(h,{method:"setForeignAttr",attr:"name",value:v.name},{frameId:0},e=>{e?f({name:v.name}):5>q++?window.setTimeout(u,100*q):B.warn("foreignAttr: error setting attr")})})};u()}});return()=>{null!==h&&delete Ba[h];a=
null}}},registerMenuCommand:{allow:{script:!0},exec:function(a,b,d,f){if(d.tab)return za.add(d.tab.id,b.name,b.uuid,b.accessKey,b.menuId,f),fa.actionPage("update"),()=>{za.clearById(b.menuId);fa.actionPage("update")};B.warn("Unable to register menu cmd due to empty tabID!");a.disconnect()}},observeUrlChanges:{allow:{script:!0},exec:function(a,b,d,f){const k=d.frameId,g=d.tab.id,h=v=>{v.tabId==g&&v.frameId==k&&f({url:v.url})};Ua.addListener(g,h);return()=>{Ua.removeListener(g,h)}}},tabWatch:{allow:{extpage:!0},
exec:function(a,b,d,f){const k=Oa.openAndWatch({url:b.url,index:(d.tab.index||0)+1,parent:d.tab},g=>{g?f({tab:g}):(k.cancel(),a.disconnect())});return()=>{k.cancel()}}}};const x=(()=>{const a=(b,d)=>{const f=b.sender,k=n[d.method];if(!k)return B.warn("mh: unknown method "+d.method),!1;if(!k.allow||!k.exec)return B.warn("mh: invalid implementation of "+d.method),!1;var g=y(f);const h=g.extpage,v=g.page;g=g.id_valid;const q="options"==v;if("background"==v||k.allow.insecure||k.allow.extpage&&h||k.allow.options&&
q||k.allow.script&&g&&!h)(d=k.exec(b,d,f,u=>{try{b.postMessage(u)}catch(e){B.debug("bg: Error sending port ("+b.name+") message",u)}}))&&b.onDisconnect.addListener(d);else return!1===d.topframe&&(h||q)||B.warn("mh: this context doesn't have the permission to call \""+d.method+'"'),!1};return b=>{W.late?b.onMessage.addListener(d=>{void 0!==d.method&&a(b,d)}):W.registerLateCallback(()=>{x(b)})}})();var c={init:function(){c.externally_connectable_reg=L.regexify({match:Object.keys(c.externally_connectable)});
rea.extension.onMessage.addListener(p);rea.extension.onConnect.addListener(x);rea.extension.onConnectExternal.addListener(a=>{a.disconnect()})},externally_connectable:{"*://www.tampermonkey.net/*":["getVersion"],"https://greasyfork.org/*":["*"],"https://userstyles.org/*":["*"]}};return c})(),la=(()=>{const m=(n,x)=>{C.RUNTIME.FPI?void 0!==x&&(n.firstPartyDomain=n.firstPartyDomain||x):delete n.firstPartyDomain;return n};let y;const p={getAll:function(n){const x=A();rea.cookies.getAll(m(n,null),x.resolve);
return x.promise()},remove:function(n){const x=A();rea.cookies.remove(m(n),c=>{c?x.resolve():(c=rea.runtime.lastError,x.reject(c?c.message:"unknown error"))});return x.promise()},set:function(n){const x=A();rea.cookies.set(m(n),c=>{c?x.resolve():(c=rea.runtime.lastError,x.reject(c?c.message:"unknown error"))});return x.promise()}};Object.defineProperties(p,{fpi:{get:()=>y}});C.RUNTIME.FPI&&rea.cookies.remove({url:"https://www.tampermonkey.net",name:"doesnotexist"},()=>{rea.runtime.lastError&&(y=!0)});
return p})(),za=(()=>{let m=[];return{add:function(y,p,n,x,c,a){m.push({tabId:y,name:p,uuid:n,accessKey:x,id:c,response:a})},list:function(){return m},listByTabId:function(y){const p={};return m.filter(n=>{const x=n.uuid+n.name;return n.tabId==y&&!p[x]&&(p[x]=!0)})},clearByTabId:function(y){m=m.filter(p=>p.tabId!=y)},getByTabId:function(y){return m.filter(p=>p.tabId==y)[0]},clearById:function(y){m=m.filter(p=>p.id!=y)},getById:function(y){return m.filter(p=>p.id==y)[0]}}})(),Za=(()=>({create:function(){let m;
let y,p,n,x,c,a;let b,d,f,k;var g=null;m={id:"general",name:l.getMessage("General"),sub_menu_item:!0,items:[]};m.items.push({name:l.getMessage("Config_Mode"),id:"configMode",level:0,option:!0,select:[{name:l.getMessage("Novice"),value:0},{name:l.getMessage("Beginner"),value:50},{name:l.getMessage("Advanced"),value:100}],value:w.values.configMode,desc:l.getMessage("Changes_the_number_of_visible_config_options")});m.items.push({name:l.getMessage("Language"),id:"i18n",level:0,option:!0,reload:!0,warning:l.getMessage("A_reload_is_required"),
select:[{name:"Browser Default",value:null}].concat(l.supported),value:w.values.i18n,validation:{image:"info",opacity:.9,msg:l.getMessage("Your_language_is_not_supported__Click_here_to_get_intructions_how_to_translate_TM_"),url:"https://www.tampermonkey.net/faq.php#Q500"}});m.items.push({name:l.getMessage("Auto_reload_on_script_enabled"),level:20,id:"autoReload",option:!0,checkbox:!0,enabled:w.values.autoReload,desc:l.getMessage("Auto_reload_on_script_enabled_desc")});m.items.push({name:l.getMessage("Anonymous_statistics"),
level:0,id:"statistics_enabled",option:!0,checkbox:!0,enabled:!!w.values.statistics_enabled,validation:{image:"info",opacity:.9,msg:l.getMessage("Allow_Tampermonkey_to_collect_anonymous_statistics_via_Google_Analytics"),url:"https://www.tampermonkey.net/privacy.php#extension"}});m.items.push({name:l.getMessage("Debug_scripts"),level:100,id:"debug",option:!0,checkbox:!0,enabled:w.values.debug,desc:""});m.items.push({name:l.getMessage("Show_fixed_source"),level:100,id:"showFixedSrc",option:!0,checkbox:!0,
enabled:w.values.showFixedSrc,desc:""});m.items.push({name:l.getMessage("LogLevel"),id:"logLevel",level:0,option:!0,select:[].concat(C.RUNTIME.SAFARI?[{name:l.getMessage("Verbose"),value:90}]:[]).concat([{name:l.getMessage("Debug"),value:80},{name:l.getMessage("Info"),value:60},{name:l.getMessage("Warning"),value:30},{name:l.getMessage("Error"),value:0}]),value:w.values.logLevel,desc:""});d={id:"script_sync",name:l.getMessage("Script_Sync"),sub_menu_item:!0,level:50,need_save:!0,items:[]};d.items.push({name:l.getMessage("Enable_Script_Sync"),
id:"sync_enabled",level:50,option:!0,checkbox:!0,enabled:w.values.sync_enabled,desc:l.getMessage("Synchronize_your_scripts_across_browsers_and_operation_systems")});var h=(()=>{const v=[],q={reset_sync:!0,cloud_url:!1,cloud_user:!1,cloud_pass:!1};rea.storage.sync.supported&&v.push({name:l.getMessage("Browser_Sync"),value:V.types.eCHROMESYNC,enable:q});v.push({name:l.getMessage("Google_Drive"),value:V.types.eGDRIVE,enable:q});C.RUNTIME.CHROME&&37>C.RUNTIME.BROWSER_VERSION||C.RUNTIME.SAFARI&&8>C.RUNTIME.BROWSER_VERSION||
C.RUNTIME.DOLPHIN?B.info("Script Sync: no Dropbox support due to missing SHA-256 capabilities"):v.push({name:l.getMessage("Dropbox"),value:V.types.eDROPBOX,enable:q});v.push({name:l.getMessage("OneDrive"),value:V.types.eONEDRIVE,enable:q});C.RUNTIME.SAFARI||(v.push({name:l.getMessage("Yandex_Disk"),value:V.types.eYANDEX,enable:q}),v.push({name:l.getMessage("WebDAV"),value:V.types.eWEBDAV,enable:{reset_sync:!0,cloud_url:!0,cloud_user:!0,cloud_pass:!0}}));return v})();d.items.push({name:l.getMessage("Sync_Type"),
id:"sync_type",enabler:!0,level:50,option:!0,select:h,value:w.values.sync_type});d.items.push({name:l.getMessage("URL"),id:"cloud_url",enabledBy:"sync_type",level:50,option:!0,text:!0,width:2,value:w.values.cloud_url});d.items.push({name:l.getMessage("Login"),id:"cloud_user",enabledBy:"sync_type",level:50,option:!0,text:!0,width:2,value:w.values.cloud_user});d.items.push({name:l.getMessage("Password"),id:"cloud_pass",enabledBy:"sync_type",level:50,option:!0,text:!0,password:!0,width:2,value:w.values.cloud_pass});
d.items.push({name:l.getMessage("Sync_Reset"),id:"reset_sync",enabledBy:"sync_type",level:80,button:!0,reload:!0,value:0,warning:l.getMessage("This_will_remove_all_remote_data_from_sync_Ok_")});n={id:"ppearance",name:l.getMessage("Appearance"),sub_menu_item:!0,need_save:!0,items:[],warning:l.getMessage("A_reload_is_required"),reload:!0};n.items.push({name:l.getMessage("Layout"),id:"layout",level:0,option:!0,select:ia.getLayouts(),value:w.values.layout,desc:""});n.items.push({name:l.getMessage("Custom_CSS"),
id:"layout_user_css",level:100,option:!0,input:!0,value:w.values.layout_user_css,desc:l.getMessage("You_can_add_your_custom_CSS_rules_here_")});g={};"off"==w.values.notification_showUpdate&&(g={image:"critical",msg:l.getMessage("Are_you_sure_that_you_don_t_want_to_be_notified_of_updates_")});n.items.push({name:l.getMessage("Update_Notification"),id:"notification_showUpdate",level:50,option:!0,select:[{name:l.getMessage("Disabled"),value:"off"},{name:l.getMessage("Show_notification"),value:"notification"},
{name:l.getMessage("Open_changelog"),value:"changelog"}],value:w.values.notification_showUpdate,validation:g});n.items.push({name:l.getMessage("Favicon_Service"),id:"favicon_service",level:50,option:!0,select:[{name:l.getMessage("Google"),value:"google"},{name:l.getMessage("DuckDuckGo"),value:"duckduckgo"},{name:l.getMessage("Native"),value:"native",warning:l.getMessage("Warning_unsafe_site_warnings_might_appear_")}],value:w.values.favicon_service});x={id:"action_menu",name:l.getMessage("Action_Menu"),
sub_menu_item:!0,need_save:!0,items:[],level:50};x.items.push({name:l.getMessage("Hide_disabled_scripts"),id:"action_menu_scripts_hide_disabled",level:100,option:!0,checkbox:!0,enabled:w.values.action_menu_scripts_hide_disabled,desc:""});x.items.push({name:l.getMessage("Columns"),id:"action_menu_columns",level:50,option:!0,select:[{name:l.getMessage("1"),value:"1"},{name:l.getMessage("2"),value:"2"},{name:l.getMessage("3"),value:"3"}],value:w.values.action_menu_columns});x.items.push({name:l.getMessage("Script_order"),
id:"action_menu_scripts_sort",level:50,option:!0,select:[{name:l.getMessage("Auto"),value:"auto"},{name:l.getMessage("Position_"),value:"position"},{name:l.getMessage("Name"),value:"name"},{name:l.getMessage("Enabled"),value:"enabled"}],value:w.values.action_menu_scripts_sort});x.items.push({name:l.getMessage("Icon_badge_info"),id:"appearance_badges",level:50,option:!0,select:[{name:l.getMessage("Disabled"),value:"off"},{name:l.getMessage("Running_scripts"),value:"running"},{name:l.getMessage("Unique_running_scripts"),
value:"running_unique"},{name:l.getMessage("Disabled_scripts"),value:"disabled"}],value:w.values.appearance_badges});(C.RUNTIME.CHROME||C.RUNTIME.FIREFOX)&&x.items.push({name:l.getMessage("Icon_badge_color"),id:"appearance_badge_color",level:100,color:!0,value:w.values.appearance_badge_color});C.RUNTIME.FIREFOX&&x.items.push({name:l.getMessage("Icon_badge_text_color"),id:"appearance_badge_text_color",level:100,color:!0,value:w.values.appearance_badge_text_color});h={id:"editor",name:l.getMessage("Editor"),
sub_menu_item:!0,level:20,need_save:!0,items:[],warning:l.getMessage("A_reload_is_required"),reload:!0};h.items.push({name:l.getMessage("Enable_Editor"),id:"editor_enabled",level:100,option:!0,checkbox:!0,enabled:w.values.editor_enabled,desc:""});h.items.push({name:l.getMessage("Theme"),id:"editor_theme",level:50,option:!0,select:ia.getEditorThemes(),value:w.values.editor_theme});h.items.push({name:l.getMessage("Font_Size"),id:"editor_fontSize",level:50,option:!0,select:[{name:"50%",value:50},{name:"70%",
value:70},{name:"80%",value:80},{name:"90%",value:90},{name:"100%",value:100},{name:"110%",value:110},{name:"120%",value:120},{name:"150%",value:150}],value:w.values.editor_fontSize});h.items.push({name:l.getMessage("Key_Mapping"),id:"editor_keyMap",level:50,option:!0,select:[{name:l.getMessage("Windows"),value:"windows"},{name:l.getMessage("Sublime"),value:"sublime"},{name:l.getMessage("Emacs"),value:"emacs"},{name:l.getMessage("Vim"),value:"vim"}],value:w.values.editor_keyMap});h.items.push({name:l.getMessage("Indentation_Width"),
id:"editor_indentUnit",level:50,option:!0,select:[{name:l.getMessage("1"),value:1},{name:l.getMessage("2"),value:2},{name:l.getMessage("3"),value:3},{name:l.getMessage("4"),value:4},{name:l.getMessage("5"),value:5},{name:l.getMessage("6"),value:6},{name:l.getMessage("7"),value:7},{name:l.getMessage("8"),value:8},{name:l.getMessage("9"),value:9},{name:l.getMessage("10"),value:10},{name:l.getMessage("11"),value:11}],value:w.values.editor_indentUnit,desc:""});h.items.push({name:l.getMessage("Tab_Size"),
id:"editor_tabSize",level:50,option:!0,select:[{name:l.getMessage("1"),value:1},{name:l.getMessage("2"),value:2},{name:l.getMessage("3"),value:3},{name:l.getMessage("4"),value:4},{name:l.getMessage("5"),value:5},{name:l.getMessage("6"),value:6},{name:l.getMessage("7"),value:7},{name:l.getMessage("8"),value:8},{name:l.getMessage("9"),value:9},{name:l.getMessage("10"),value:10},{name:l.getMessage("11"),value:11}],value:w.values.editor_tabSize,desc:""});h.items.push({name:l.getMessage("Indent_with"),
id:"editor_indentWithTabs",level:50,option:!0,select:[{name:l.getMessage("Tabs"),value:"tabs"},{name:l.getMessage("Spaces"),value:"spaces"}],value:w.values.editor_indentWithTabs,desc:""});h.items.push({name:l.getMessage("TabMode"),id:"editor_tabMode",level:50,option:!0,select:[{name:l.getMessage("Classic"),value:"classic"},{name:l.getMessage("Smart"),value:"smart"},{name:l.getMessage("Indent"),value:"indent"}],value:w.values.editor_tabMode,desc:""});h.items.push({name:l.getMessage("Line_break"),id:"editor_lineWrapping",
level:50,option:!0,checkbox:!0,enabled:w.values.editor_lineWrapping,desc:""});h.items.push({name:l.getMessage("Reindent_on_typing"),id:"editor_electricChars",level:50,option:!0,checkbox:!0,enabled:w.values.editor_electricChars,desc:""});h.items.push({name:l.getMessage("Enable_autoSave"),id:"editor_autoSave",level:20,option:!0,checkbox:!0,enabled:w.values.editor_autoSave,desc:""});h.items.push({name:l.getMessage("Enable_easySave"),id:"editor_easySave",level:20,option:!0,checkbox:!0,enabled:w.values.editor_easySave,
desc:""});h.items.push({name:l.getMessage("Highlight_trailing_whitespace"),id:"editor_highlightTrailingWhitespace",level:50,option:!0,checkbox:!0,enabled:w.values.editor_highlightTrailingWhitespace,desc:""});h.items.push({name:l.getMessage("Trim_trailing_whitespace_from_modified_lines"),id:"editor_trimTrailingSpacesFromModifiedLines",level:50,option:!0,checkbox:!0,enabled:w.values.editor_trimTrailingSpacesFromModifiedLines,desc:""});h.items.push({name:l.getMessage("Auto_syntax_check_on_typing"),id:"editor_autoLint",
level:50,option:!0,checkbox:!0,enabled:w.values.editor_autoLint,desc:l.getMessage("Enable_this_option_to_automatically_check_the_code_on_typing_")});h.items.push({name:l.getMessage("Auto_syntax_check_max_length"),id:"editor_autoLintMaxLen",level:50,option:!0,text:!0,value:w.values.editor_autoLintMaxLen,desc:l.getMessage("Check_only_scripts_up_to_this_size_automatically_")});h.items.push({name:l.getMessage("Custom_Linter_Config"),id:"editor_linter_config",level:100,option:!0,input:!0,json:!0,value:w.values.editor_linter_config,
validation:{image:"info",opacity:.9,msg:l.getMessage("You_can_add_your_custom_linter_config_here_"),url:"https://eslint.org/docs/user-guide/configuring"}});p={id:"script_update",name:l.getMessage("Script_Update"),sub_menu_item:!0,level:0,items:[]};p.items.push({name:l.getMessage("Check_disabled_scripts"),id:"scriptUpdateCheckDisabled",level:0,option:!0,checkbox:!0,enabled:w.values.scriptUpdateCheckDisabled,desc:""});p.items.push({name:l.getMessage("Dont_ask_me_for_simple_script_updates"),id:"notification_silentScriptUpdate",
level:80,option:!0,checkbox:!0,enabled:w.values.notification_silentScriptUpdate,desc:""});p.items.push({name:l.getMessage("Check_interval"),id:"scriptUpdateCheckPeriod",level:0,option:!0,select:[{name:l.getMessage("Never"),value:0},{name:l.getMessage("Every_6_Hours"),value:216E5},{name:l.getMessage("Every_12_Hour"),value:432E5},{name:l.getMessage("Every_Day"),value:864E5},{name:l.getMessage("Every_Week"),value:6048E5}],value:w.values.scriptUpdateCheckPeriod,desc:""});p.items.push({name:l.getMessage("Hide_notification_after"),
id:"scriptUpdateHideNotificationAfter",level:50,option:!0,select:[{name:l.getMessage("Never"),value:0},{name:l.getMessage("15_Seconds"),value:15E3},{name:l.getMessage("30_Seconds"),value:3E4},{name:l.getMessage("1_Minute"),value:6E4},{name:l.getMessage("5_Minutes"),value:3E5},{name:l.getMessage("1_Hour"),value:36E5}],value:w.values.scriptUpdateHideNotificationAfter,desc:""});y={id:"externals",name:l.getMessage("Externals"),sub_menu_item:!0,level:0,items:[]};y.items.push({name:l.getMessage("Update_interval"),
id:"external_update_interval",level:0,option:!0,select:[{name:l.getMessage("Always"),value:1},{name:l.getMessage("Every_Day"),value:864E5},{name:l.getMessage("Every_Week"),value:6048E5},{name:l.getMessage("Every_Month"),value:2592E6},{name:l.getMessage("Never"),value:0}],value:w.values.external_update_interval,desc:""});c={id:"security",name:l.getMessage("Security"),sub_menu_item:!0,need_save:!0,level:50,items:[]};C.OPTIONS.HAS_CSP&&(c.items.push({name:l.getMessage("Add_TM_to_CSP"),id:"webrequest_fixCSP",
level:80,option:!0,select:[{name:l.getMessage("Remove__possibly_unsecure_"),value:"remove"},{name:l.getMessage("Yes"),value:"yes"},{name:l.getMessage("No"),value:"no"}],value:w.values.webrequest_fixCSP,desc:l.getMessage("Tampermonkey_might_not_be_able_to_provide_access_to_the_unsafe_context_when_this_is_disabled")}),c.items.push({name:l.getMessage("Allow_headers_to_be_modified_by_scripts"),id:"webrequest_modHeaders",level:80,option:!0,reload:!0,select:[{name:l.getMessage("Yes"),value:"yes"},{name:l.getMessage("Auto"),
value:"auto"},{name:l.getMessage("No"),value:"no"}],value:w.values.webrequest_modHeaders,warning:l.getMessage("Tampermonkey_needs_to_be_restarted_to_make_this_change_apply_Do_you_want_to_continue_"),desc:""}));C.RUNTIME.ALLOWS_FILE_SCHEME_ACCESS&&c.items.push({name:l.getMessage("Script_local_files_access"),id:"script_file_access",level:80,option:!0,select:[{name:l.getMessage("All_local_files"),value:"all"},{name:l.getMessage("require_and_resource"),value:"externals"},{name:l.getMessage("Disabled"),
value:"off"}],value:w.values.script_file_access});c.items.push({name:l.getMessage("Allow_communication_with_cooperate_pages"),id:"external_connect",level:80,option:!0,reload:!0,select:[{name:l.getMessage("Tampermonkey_and_script_version"),value:"all"},{name:l.getMessage("Tampermonkey_version"),value:"version"},{name:l.getMessage("Disabled"),value:"off"}],value:w.values.external_connect,desc:l.getMessage("This_option_allows_the_Tampermonkey_homepage_and_some_script_hosting_pages_to_determine_the_Tampermonkey_version_and_whether_a_script_is_installed_")});
c.items.push({name:l.getMessage("Subresource_Integrity"),id:"require_sri_mode",level:80,option:!0,select:[{name:l.getMessage("Disabled"),value:"ignore"},{name:l.getMessage("Validate_if_supported"),value:"supported"},{name:l.getMessage("Validate_if_given"),value:"given"},{name:l.getMessage("Enforce"),value:"enforce"}],value:w.values.require_sri_mode,desc:l.getMessage("Script_authors_can_secure_external_resources_by_adding_a_SRI_hash_to_the_URL_")});c.items.push({name:l.getMessage("connect_mode"),id:"connect_mode",
level:50,option:!0,select:(80<=w.values.configMode||["off","casual"].includes(w.values.connect_mode)?[{name:l.getMessage("Disabled"),value:"off"},{name:l.getMessage("Casual"),value:"casual"}]:[]).concat([{name:l.getMessage("Ask_if_unknown"),value:"ask"},{name:l.getMessage("Strict"),value:"strict"},{name:l.getMessage("Always_ask"),value:"paranoid"}]),value:w.values.connect_mode,desc:""});C.RUNTIME.INCOGNITO_MODE&&!rea.extension.inIncognitoContext&&(g="temporary"==w.values.incognito_mode?{}:{image:"critical",
msg:"Permanent mode is still a BETA feature!"},c.items.push({name:l.getMessage("Store_data_in_incognito_mode"),id:"incognito_mode",level:50,option:!0,select:[{name:l.getMessage("Temporary"),value:"temporary"},{name:l.getMessage("Permanent"),value:"permanent"}],value:w.values.incognito_mode,validation:g}));c.items.push({name:l.getMessage("Page_Filter_Mode"),id:"page_filter_mode",level:50,option:!0,select:[{name:l.getMessage("Disabled"),value:"off"},{name:l.getMessage("Blacklist"),value:"black"},{name:l.getMessage("Whitelist"),
value:"white"},{name:l.getMessage("Both"),value:"black+white"}],value:w.values.page_filter_mode,desc:""});c.items.push({name:l.getMessage("Whitelisted_Pages"),id:"page_whitelist",level:50,option:!0,input:!0,array:!0,value:w.values.page_whitelist,desc:""});c.items.push({name:l.getMessage("Blacklisted_Pages"),id:"forbiddenPages",level:50,option:!0,input:!0,array:!0,value:w.values.forbiddenPages,desc:""});a={id:"blackcheck",name:l.getMessage("BlackCheck"),sub_menu_item:!0,need_save:!0,level:50,items:[]};
a.items.push({name:l.getMessage("Script_Blacklist_Source"),id:"script_blacklist_type",level:50,option:!0,select:[{name:l.getMessage("Disabled"),value:"off"},{name:l.getMessage("Server_And_Manual"),value:"server"},{name:l.getMessage("Only_Manual"),value:"only_manual"}],value:w.values.script_blacklist_type});a.items.push({name:l.getMessage("Blacklist_Severity"),id:"script_blacklist_severity",level:50,option:!0,select:[{name:l.getMessage("severity_1"),value:1},{name:l.getMessage("severity_2"),value:2},
{name:l.getMessage("severity_3"),value:3},{name:l.getMessage("severity_4"),value:4},{name:l.getMessage("severity_5"),value:5},{name:l.getMessage("severity_6"),value:6},{name:l.getMessage("severity_7"),value:7},{name:l.getMessage("severity_8"),value:8},{name:l.getMessage("severity_9"),value:9},{name:l.getMessage("severity_10"),value:Z.SEVERITY_MAX}],value:w.values.script_blacklist_severity});a.items.push({name:l.getMessage("Manual_Script_Blacklist"),id:"require_blacklist",level:50,option:!0,input:!0,
array:!0,value:w.values.require_blacklist,desc:""});if(C.OPTIONS.CAN_DOWNLOAD){let v=!1;g={};M.map("exe sh crx com bat scr".split(" "),q=>"name."+q).forEach(q=>{v|=aa.is_whitelisted(q)});v&&(g={image:"critical",msg:l.getMessage("Your_whitelist_seems_to_include_executable_files_This_means_your_userscripts_may_download_malware_or_spyware_to_your_harddisk_")});k={id:"downloads",name:l.getMessage("Downloads")+" BETA",sub_menu_item:!0,need_save:!0,level:50,items:[]};k.items.push({name:l.getMessage("Download_Mode"),
id:"downloads_mode",level:50,option:!0,select:M.select([{name:l.getMessage("Default"),value:aa.staticVars.DEFAULT},{name:l.getMessage("Disabled"),value:aa.staticVars.OFF},{name:l.getMessage("Native"),value:aa.staticVars.NATIVE},{name:l.getMessage("Browser_API"),value:rea.downloads.supported?aa.staticVars.CHROME:null}],q=>q.value),value:w.values.downloads_mode,desc:l.getMessage("The_Browser_API_mode_requires_a_special_permission_")});k.items.push({name:l.getMessage("Whitelisted_File_Extensions"),id:"downloads_extension_whitelist",
level:50,option:!0,input:!0,array:!0,value:w.values.downloads_extension_whitelist,desc:l.getMessage("Only_files_with_these_extensions_can_be_saved_to_the_harddisk_Be_careful_to_not_allow_file_extensions_that_represent_executables_at_your_operating_system_"),validation:g})}b={id:"experimental",name:l.getMessage("Experimental"),sub_menu_item:!0,level:80,items:[]};C.RUNTIME.FAST_EXEC_SUPPORT&&(g="fast"==w.values.runtime_inject_mode?{image:"critical",msg:"This might cause higher CPU usage!"}:{},b.items.push({name:l.getMessage("Inject_Mode"),
id:"runtime_inject_mode",level:80,option:!0,select:[{name:l.getMessage("Default"),value:"default"},{name:l.getMessage("Instant"),value:"instant"},{name:l.getMessage("Normal"),value:"normal"}],value:w.values.runtime_inject_mode,validation:g}));b.items.push({name:l.getMessage("strict_mode"),id:"runtime_strict_mode",level:80,option:!0,select:[{name:l.getMessage("Default"),value:"byscript"},{name:l.getMessage("Always"),value:"on"},{name:l.getMessage("Disabled"),value:"off"}],value:w.values.runtime_strict_mode});
rea.webRequest.filterResponseData&&C.OPTIONS.HAS_CSP&&b.items.push({name:l.getMessage("Add_Tampermonkey_to_the_site_s_content_csp"),id:"webrequest_fixContentCSP",level:80,option:!0,select:[{name:l.getMessage("Yes"),value:"yes"},{name:l.getMessage("No"),value:"no"}],value:w.values.webrequest_fixContentCSP,warning:"Warning: enabling this option is may break pages!"});g={id:"userscripts",name:l.getMessage("Userscripts"),sub_menu_item:!0,need_save:!0,level:80,items:[]};g.items.push({name:l.getMessage("Script_URL_detection"),
id:"scriptUrlDetection",level:80,option:!0,select:[{name:l.getMessage("Auto"),value:"auto"},{name:l.getMessage("Disabled"),value:"manual"}],value:w.values.scriptUrlDetection});g.items.push({name:l.getMessage("New_script_template_"),id:"script_templates",level:80,option:!0,input:!0,array:!0,named:!0,value:w.values.script_templates});f={id:"reset",name:l.getMessage("Reset_Section"),sub_menu_item:!0,level:50,items:[]};f.items.push({name:l.getMessage("Restart_Tampermonkey"),id:"reset_simple",level:50,
button:!0,reload:!0,value:0,warning:l.getMessage("This_will_restart_Tampermonkey_Ok_")});f.items.push({name:l.getMessage("Factory_Reset"),id:"reset_factory",level:80,button:!0,reload:!0,value:0,warning:l.getMessage("This_will_remove_all_scripts_and_reset_all_settings_Ok_")});Na&&f.items.push({name:"Install Tests",id:"install_tests",level:80,button:!0,reload:!1,ignore:!0,value:0,warning:"This will install a lot of test scripts!"});return[m,n,x,p,y,void 0,d,void 0,void 0,h,c,a,k,g,b,f].filter(v=>!!v)}}))(),
na=(()=>({create:(m,y)=>{m=m||"";y=y||{};const p=c=>A.onebyone(c).fail(()=>{B.warn("tree: wait failed!")}).then(a=>a.filter(b=>b)),n=(c,a)=>{const b=c.replace(/\.$/,"").split(".");let d=x;for(;b.length;){const f=b.shift();if(d[f]){if("function"===typeof d[f])return()=>d[f](y,!a);d=d[f];b.length||b.unshift("root")}else return B.warn("tree: unable to find",c,y),()=>A.Pledge([])}B.warn("tree: unable to find",c,y);return()=>A.Pledge([])};var x={actions:{root:function(c){const a=A();rea.tabs.getSelected(null,
b=>{b&&0<=b.id?y.tab=b:c.tabId&&(y.tab={id:c.tabId,url:null});b=p([n("actions.general"),n("actions.scripts"),n("actions.commands")]);a.consume(b)});return a.promise()},general:function(){var c=y.tab,a=c?c.url:null,b=a&&4<a.length&&""==a.substr(0,4).replace(/file|http/,"")?a:"";const d=[];c={name:"enabled",sub_menu_item:!0,pos:"top",items:[],tabId:c?c.id:null};c.items.push({name:l.getMessage("Enabled"),display:w.values.enabled?null:"greyed",id:"enabled",button:!0,reload:!0,enabler:!0});c.items=c.items.concat(fa.actionStatus().map(k=>
({options:k,globalhint:!0})));d.push(c);let f;!Ia.isScriptUrl(a,!0)||(f=Ia.isScriptUrl(a))&&"manual"!=w.values.scriptUrlDetection||c.items.push({name:f?l.getMessage("Install_this_script"):l.getMessage("Try_to_install_as_script"),image:"script_download",id:"installFromUrl",data:a,button:!0,reload:!0});a={name:"about",sub_menu_item:!0,pos:"bottom",items:[]};a.items.push({name:l.getMessage("Dashboard"),image:"utilities",url:rea.extension.getURL("options.html")+"#"+["url="+Y.Base64.encode(b),"nav=dashboard"].join("&"),
newtab:!0});b="version="+rea.extension.manifest.version+"&ext="+rea.runtime.short_id;a.items.push({image:"about",id:"about",urls:[{name:" "+l.getMessage("Help"),url:"https://www.tampermonkey.net/faq.php?"+b,newtab:!0},{name:" "+l.getMessage("Changelog"),url:"https://www.tampermonkey.net/changelog.php?"+b,newtab:!0},{social:!0,newtab:!0}]});d.push(a);return A.Pledge(d)},scripts:{root:function(c){var a=y.tab;const b=a?a.url:null,d=[];var f=b?O.parse(b):null;f=f&&["http:","https:","file:"].includes(f.protocol)?
O.woHash(f):"";let k;const g={name:"scripts",sub_menu_item:!0,pos:"center",items:[]};var h=qa.getContexters(!0,null);const v={},q={},u={};let e={};const r={};a&&[L.getUniqueScriptsForTab(a),L.getScriptHistoryForTab(a)].forEach((D,E)=>{let F;Object.keys(D).forEach(N=>{var G=D[N];E?(v[N]=G.urls,q[N]=G.count,u[N]=G.all_time,(F=e[N])||(G=Q.getByUid(N),e[N]=G.script&&G.cond?F=G.script:F={uuid:N,name:l.getMessage("This_script_was_deleted"),enabled:!0,deleted:!0}),r[N]="a"+F.name.toLowerCase()+F.position):
(e[N]=F=G.script,r[N]="z"+F.name.toLowerCase()+F.position)})});let t;t="position"==w.values.action_menu_scripts_sort?(D,E)=>D.position-E.position:"name"==w.values.action_menu_scripts_sort?(D,E)=>D.name.toLowerCase()<E.name.toLowerCase()?-1:D.name.toLowerCase()>E.name.toLowerCase()?1:0:"enabled"==w.values.action_menu_scripts_sort?(D,E)=>1E4*(D.enabled?0:1)+D.position-(1E4*(E.enabled?0:1)+E.position):(D,E)=>r[D.uuid].localeCompare(r[E.uuid]);e=M.values(e).sort(t);h=Ma([].concat(e).concat(h),{active_urls:v,
active_counts:q,all_time_active_counts:u});const z=a?$a(a.id):{};w.values.action_menu_scripts_hide_disabled&&(h=h.filter(D=>D.enabled||q[D.uuid]));h.forEach(D=>{let E;if(E=z[D.uuid])D.menu_cmds=E});!w.values.action_menu_scripts_hide_disabled&&2<Math.min(w.values.action_menu_columns,(c?c.available_columns:null)||99)?(k={name:"scripts_right",sub_menu_item:!0,pos:"right",items:[]},h.forEach(D=>{(D.enabled||q[D.uuid]?g:k).items.push(D)}),d.push(g),k.items.length&&d.push(k)):(k=g,g.items=g.items.concat(h),
d.push(g));w.values.enabled&&!h.length&&b&&(pa.isAllowed(b)?g.items.push({name:l.getMessage("No_script_is_running"),image:"no_script"}):g.items.push({name:l.getMessage("This_page_is_blacklisted_at_the_security_settings"),image:"critical"}));c=l.getLocale();w.values.enabled&&(h.length?(a={name:"scripts_new",sub_menu_item:!0,pos:"center",items:[]},d.push(a)):a=g,a.items.push({name:l.getMessage("Get_new_scripts___"),image:"script_search",url:"https://www.tampermonkey.net/scripts.php"+(c?"?locale="+c:
""),newtab:!0}),a.items.push({name:l.getMessage("Add_new_script___"),image:"script_add",url:rea.extension.getURL("options.html")+"#url="+Y.Base64.encode(f)+"&nav=new-user-script",newtab:!0}));return A.Pledge(d)}},commands:function(){const c=[],a=l.getLocale(),b={name:"commands",id:"commands",sub_menu_item:!0,pos:"left",items:[]};b.items.push({name:l.getMessage("Check_for_userscripts_updates"),id:"run_script_updates",button:!0,image:"update"});80<=w.values.configMode&&b.items.push({name:l.getMessage("Report_a_bug"),
image:"bug",url:"https://www.tampermonkey.net/bug",newtab:!0});C.RUNTIME.SAFARI||b.items.push({name:l.getMessage("Please_consider_a_contribution"),image:"contrib",url:"https://www.tampermonkey.net/contrib.php?src=a"+(a?"&locale="+a:""),newtab:!0});c.push(b);return A.Pledge(c)}},options:{root:function(){return p([n("options.general"),n("options.verification"),n("options.scripts"),n("options.settings")])},general:function(){let c,a=[];rea.extension.inIncognitoContext&&"temporary"==w.values.incognito_mode?
a.push({globalhint:!0,options:{image:"critical",text:l.getMessage("All_modifications_are_only_kept_until_this_incognito_session_is_closed_")}}):(c=fa.optionsStatus().map(b=>({options:b,globalhint:!0})))&&c.length?a=a.concat(c):(c=Ca.updateAvailable())&&a.push({globalhint:!0,options:{image:"info",class:"information",text:l.getMessage("0name0_0version0_is_available__Please_re_start_your_browser_to_update_",rea.extension.manifest.name,c)}});return A.Pledge(a)},verification:function(){const c=[];Ga.getWarnings().forEach(a=>
{c.push({globalhint:!0,options:{image:"critical",class:"warning",text:a.text,title:a.description,info_url:a.url}})});return A.Pledge(c)},scripts:{root:function(c,a){const b=A(),d={name:l.getMessage("Installed_userscripts"),main_menu_item:!0,scriptTab:!0,id:"dashboard"};(()=>{if(c.complete||!a)return p(M.map(["options.scripts.userscripts","options.scripts.new"],f=>n(f)));d.referrer="options.scripts";d.partial=!0;return p([n("options.scripts.new")])})().done(f=>{d.items=f;b.resolve([d])}).fail(b.reject);
return b.promise()},"new":function(){const c=[];c.push({name:l.getMessage("New_userscript"),id:null,image:"script_add",icon:ia.images.origin("unknown"),nnew:!0,uuid:"new-user-script",position:-1,positionof:C.RUNTIME.MAX_SCRIPTS,enabled:!0,userscript:!0});return A.Pledge(c)},userscripts:{root:function(c,a){c=c.complete||!a?null:"options.scripts.userscripts";c=Ma(L.determineScriptsToRun(null),{options_page:!0,referrer:c});a=c.length;const b=l.getLocale();c.push({name:l.getMessage("No_script_is_installed"),
image:"info",visible:!a});c.push({name:l.getMessage("Get_some_scripts___"),image:"edit_add",url:"https://www.tampermonkey.net/scripts.php"+(b?"?locale="+b:""),newtab:!0,visible:!a});return A.Pledge(c)},matches:function(c){var a=c.filter,b;if(!a)return A.Pledge([]);a=/\/(.*)\/(.*)/.exec(a.code);const d=new RegExp(a[1],a[2]);c.uuid?(c=Q.getByUid(c.uuid),c.script&&c.cond&&(b=[c.script])):b=L.determineScriptsToRun(null);return b?(b=b.map(f=>-1!=f.textContent.search(d)?f.uuid:null).filter(f=>f),A.Pledge(b)):
A.Pledge([])},source:function(c){if(!c.uuid)return A.Pledge([]);c=Q.getByUid(c.uuid);if(c.script&&c.cond)return c=w.values.showFixedSrc?Fa.mkCompat(c.script.textContent,c.script,"off"!=w.values.runtime_strict_mode):c.script.textContent,A.Pledge([c]);B.warn("tree: unable to process ",c);return A.Breach()},storage:function(c){return c.uuid?A.Pledge([Q.getStorageByUid(c.uuid).data]):A.Pledge([])},external:function(c){if(!c.uuid)return A.Pledge([]);const a=Q.getByUid(c.uuid);if(a.script&&a.cond){let b;
[].concat(a.script.requires).concat(a.script.resources).some(d=>{d=d.url||O.sanitize(d.unsafe_url,d.abs_url);if(d==c.url&&(d=ha.getElement(c.uuid,d))&&d.data&&d.data.content)return b=d.data.content,!0});return A.Pledge([b])}B.warn("tree: unable to process ",a);return A.Breach()}}},settings:function(c,a){const b=A(),d={name:l.getMessage("Settings"),main_menu_item:!0,id:"settings",selected_default:!0};c.complete||!a?c=A.Pledge(Za.create()):(d.referrer="options.settings",c=A.Pledge());c.done(f=>{d.items=
f;b.resolve([d])}).fail(b.reject);return b.promise()}}};B.debug("tree: loading",m,y);return n(m,!0)()},level:m=>m.replace(/\.$/,"").split(".").length}))(),$a=m=>{const y={};m=null==m||void 0==m?za.list():za.listByTabId(m);for(const p in m){if(!m.hasOwnProperty(p))continue;const n=m[p];(y[n.uuid]=y[n.uuid]||[]).push({name:n.name,uuid:n.uuid,id:n.id,accessKey:n.accessKey,image:"menu_cmd",menucmd:!0})}return y},Ma=(m,y)=>{const p=[];y=y||{};const n=new U.Script;["author","copyright"].forEach(x=>{n[x]=
!1});Object.keys(m).forEach(x=>{const c=m[x];let a;if(y.options_page){a={};const b=["textContent","requires","resources"];Object.keys(n).forEach(d=>{b.includes(d)||(M.toType(n[d]),a[d]=c[d])});y.referrer?(a.referrer=y.referrer,a.length=c.textContent.length):a.code=c.textContent;["requires","resources"].forEach(d=>{a[d]=M.map(c[d],f=>{const k=f.url||O.sanitize(f.unsafe_url,f.abs_url),g=ha.getElement(c.uuid,k);let h=0,v=null,q=null,u,e,r,t;g&&g.data&&(g.data.content&&(t=g.data.content,h=t.length),q=
g.data.sri,v=g.ts,u=g.modified,r=g.data.meta||"text/plain",e="requires"==d||/text\/.*|application\/(?:x-)?(?:java|ecma)script/.test(r));return{display_url:f.url||f.unsafe_url,abs_url:f.abs_url,unsafe_url:f.unsafe_url,url:k,data:{length:h,content:y.externals?t:void 0},sri:q,ts:v,mimetype:r,editable:e,modified:u}})});a.origin=L.determineOrigin(c);a.contexter=L.isContexter(c);a.temp_connects=Ea.getSessionConnects(c.uuid);x=Q.getStorageByUid(c.uuid);a.storage_key_count=Object.keys(x.data).length;a.remote_url=
ca.getSyncRemoteUrl(c);a.lastUpdated=c.lastUpdated}else x=L.determineOrigin(c),a={name:c.name,name_i18n:c.name_i18n,uuid:c.uuid,system:c.system,support:!!c.supportURL||x&&!!x.issue_url,abuse:x&&!!x.abuse_url,active_urls:(y.active_urls||{})[c.uuid],active_count:(y.active_counts||{})[c.uuid],all_time_active_count:(y.all_time_active_counts||{})[c.uuid],referrer:y.referrer,contexter:L.isContexter(c),enabled:c.enabled,position:c.position,deleted:c.deleted};c.evilness&&(c.evilness==Z.SEVERITY_FOISTED_SCRIPT?
a.foisted=l.getMessage("The_origin_of_this_script_cant_be_determined_"):c.evilness>=Math.min(Z.SEVERITY_MAX,w.values.script_blacklist_severity)&&(a.blacklisted=l.getMessage("This_script_is_blacklisted_")));c.evilness&&(a.warnings=Z.getWarningsFor(L.determineSourceURL(c)));a.file_url=c.downloadURL||c.fileURL;a.positionof=m.length;a.userscript=!0;c.icon64||c.icon||(a.icon64=ia.images.origin("unknown"));c.options&&Object.keys(n.options).forEach(b=>{a[b]=c.options[b]});p.push(a)});return p},sa={run:function(m,
y){let p=1;const n=()=>{0==--p&&(y&&y(),rea.page.reload())};if("config"==m){const x=I.listValues();Object.keys(x).forEach(c=>{c=x[c];-1==c.indexOf(C.CONSTANTS.PREFIX.SCRIPT)&&-1==c.indexOf(C.CONSTANTS.PREFIX.COND)&&-1==c.indexOf(C.CONSTANTS.PREFIX.STORE)&&-1==c.indexOf(C.CONSTANTS.PREFIX.META)&&(p++,I.deleteValue(c).always(n))})}else"factory"==m&&(p++,aa.remove_permission().done(n),p++,I.factoryReset().always(n));n()},reset:function(m){sa.run(null,m)},factoryReset:function(m){sa.run("factory",m)},
configReset:function(m){sa.run("config",m)}},ka=(()=>{const m=()=>{rea.runtime.lastError&&void 0},y={init:function(){y.setIcon();let p=w.values.appearance_badge_color||"#ee3131";"#"!==p[0]&&(p="#"+p);rea.browserAction.setBadgeBackgroundColor({color:p});p=w.values.appearance_badge_text_color||"#ffffff";"#"!==p[0]&&(p="#"+p);rea.browserAction.setBadgeTextColor({color:p})},setIcon:p=>{var n;var x=null;let c=n=!1;void 0===p||T.get.empty(p)||(n=T.get.blocker(p),c=T.get.forbidden(p));c?(n="_forbidden",
x=l.getMessage("At_least_one_part_of_this_page_is_listed_at_the_forbidden_pages_setting_")):n?(n="_blocker",x=l.getMessage("Some_scripts_might_be_blocked_by_the_javascript_settings_for_this_page_or_a_script_blocker_")):n=w.values.enabled&&void 0!==p?"":"_grey";B.debug("badge: set icon "+n);n={path:rea.extension.getURL("images/icon"+n+".png")};x={title:x?x:rea.extension.manifest.name};null!=p&&(n.tabId=p,x.tabId=p);try{rea.browserAction.setIcon(n,m),rea.browserAction.setTitle(x)}catch(a){B.warn("bg: ERROR while setIcon! "+
a.message)}},setBadge:p=>{let n=0;"off"==w.values.appearance_badges?n=0:"running"==w.values.appearance_badges?p&&!T.get.empty(p)&&(n=T.get.stats(p).running):"running_unique"==w.values.appearance_badges?p&&!T.get.empty(p)&&(n=T.get.stats(p,!0).unique):"disabled"==w.values.appearance_badges&&p&&!T.get.empty(p)&&(n=T.get.stats(p).disabled);B.debug("badge: set "+n);n?rea.browserAction.setBadgeText({text:n.toString(),tabId:p}):rea.browserAction.setBadgeText({text:"",tabId:p})}};return y})(),ya=(()=>{let m=
null;const y={init:function(){m=I.getValue(C.CONSTANTS.STORAGE.BEGGING,null);let p;const n=Date.now();m?(p=I.getValue(C.CONSTANTS.STORAGE.LAST_START,0))&&12096E5<n-p&&(m.later={type:"after_pause",ts:n},y.save()):(m={first_run:{type:"from_init",ts:n}},y.save())},save:function(){I.setValue(C.CONSTANTS.STORAGE.BEGGING,m)},needed:function(){var p=Date.now();const n=m.first_run?m.first_run.ts+12096E5<p:!0,x=!m.hide,c=!m.contributed;p=m.later?m.later.ts+12096E5<p:!0;if(!C.RUNTIME.SAFARI&&!C.RUNTIME.DOLPHIN&&
n&&x&&c&&p)return m.later?"l":"i"},clicked:function(p,n,x){ea.tG("clicked",p,n+x)},dialog:{shown:function(p){const n=Date.now();m.dialog={ts:n,extra:p};y.save();ea.tG("dialog")}},button:(()=>{const p={};["contributed","later","hide"].forEach(n=>{p[n]=(x,c)=>{const a=Date.now();m[n]={ts:a,type:x,extra:c};y.save();ea.tG("button",n)}});return p})()};return y})(),Da=(()=>{const m=(f,k)=>{B.debug(f,k);if(k&&f.menuItemId){var g=Q.getByUid(f.menuItemId);g&&g.script?Sa.bundle({url:f.frameUrl||f.pageUrl||
"<unknown>"},g.script,!0).then(h=>{const v=A(),q={};h.method="executeScript";void 0!==f.frameId?h.frameId=q.frameId=f.frameId:f.frameUrl?h.url=O.woHash(f.frameUrl):h.topframe=!0;rea.tabs.sendMessage(k.id,h,q,v.resolve);return v.promise()}):B.log("ctxm: unable to find script "+f.menuItemId,f,k)}};let y=[],p=null,n=!1;const x=f=>{const k=[];M.each(f,g=>{const h=A();rea.contextMenus.create({id:g.uuid,contexts:["all"],parentId:p,title:g.name,type:"normal",documentUrlPatterns:["http://*/*","https://*/*",
"file://*/*"]},()=>{h.resolve()});y.push(g.uuid);k.push(h.promise())});return A.when(k)},c=()=>{const f=A();rea.contextMenus.removeAll(()=>{p=null;f.resolve()});return f.promise()},a=()=>{const f=A();c().then(()=>{p=rea.contextMenus.create({contexts:["all"],title:"Tampermonkey",type:"normal",documentUrlPatterns:["http://*/*","https://*/*","file://*/*"]},()=>{f.resolve()})});return f.promise()},b=()=>{const f=qa.getContexters(!0,null);if(f.length){var k=p?A.Pledge():a();return k.then(()=>x(f))}return c().then(d.clean)};
var d={init:function(){rea.contextMenus.supported&&(d.clean().then(b).then(()=>{n=!0}),rea.contextMenus.onClicked.addListener(m))},clean:function(){const f=A();y.forEach(k=>{rea.contextMenus.remove(k)});y=[];f.resolve();return f.promise()},onScriptsChanged:function(){if(rea.contextMenus.supported&&n)return d.clean().then(b)},getContexterCount:function(){return y.length}};return d})(),ua=(()=>{const m={},y={},p=("TM_"+M.createUUID().substr(0,5)).toLowerCase(),n=["content-security-policy","x-content-security-policy",
"x-webkit-csp"],x=rea.webRequest.extraHeaderNeeded,c=[],a=(e,r)=>{e=e.split(",").map(t=>{let z,D,E,F,N;t=t.split(";");t.forEach((J,K)=>{0===J.search(/^\s*script-src /)?D=K:0===J.search(/^\s*default-src /)?E=K:0===J.search(/^\s*img-src /)&&(F=K)});let G,H;void 0!==E&&void 0===D&&(z=!0,t.push(t[E].replace(/default-src /,"script-src ")),D=t.length-1);void 0!==E&&void 0===F&&(z=!0,t.push(t[E].replace(/default-src /,"img-src ")),F=t.length-1);void 0!==F&&(H=!1,G=t[F],-1==G.search(/'data:'/)&&(H=!0,G=G.replace(/img-src /,
"img-src data: ")),-1!=G.search(/'none'/)&&(H=!0,G=G.replace(/ 'none'/,"")),H&&(t[F]=G,z=!0));void 0!==D&&(H=!1,G=t[D],-1==G.search(/'unsafe-eval'/)&&(H=!0,G=G.replace(/script-src /,"script-src 'unsafe-eval' ")),-1!=G.search(/'none'/)&&(H=!0,G=G.replace(/ 'none'/,"")),C.RUNTIME.FIREFOX&&(-1==G.search(/'unsafe-inline'/)&&(H=N=!0,G=G.replace(/script-src /,"script-src 'unsafe-inline' ")),-1==G.search(/'strict-dynamic'/)&&-1!=G.search(/ '(nonce|sha[0-9]+)-[^']+'/)&&(H=!0,G=G.replace(/ '(nonce|sha[0-9]+)-[^']+'/g,
" *"))),H&&(t[D]=G,z=!0));void 0!==E&&(H=!1,G=t[E],N&&-1!=G.search(/ 'self'/)&&(H=!0,t[E]=G.replace(/default-src /,"default-src blob: data: ")),H&&(z=!0));return z?t.filter(J=>J).join(";"):null}).filter(t=>t).join(",");return""===e?null:e},b=(e,r)=>{let t,z;e=e.split(";");e.forEach((E,F)=>{0===E.search(/^\s*sync-xhr /)&&(z=F)});let D;void 0!==z&&(D=!1,r=e[z],-1!=r.search(/'none'/)&&(D=!0,r=r.replace(/ 'none'/," *")),D&&(e[z]=r,t=!0));return t?e.join(";"):null},d=(e,r)=>{let t={};const z=e.url;Object.keys(r).forEach(D=>
{const E=r[D];M.each(E.rules,(F,N)=>{var G;let H;if((G=F.selector)&&(H=F.action)){var J=E.id+"/"+N;(N=ba.items.regexp.get(J))||(N=L.regexify({inc:G.include,match:G.match,exc:G.exclude}),ba.items.regexp.set(J,N));if(L.validUrl(z,N)){if(H.cancel)return B.log("webRequest: request was canceled by script "+E.uuid,z,F,E),E.callback&&E.callback({type:"cancel",details:{rule:F,url:z}}),t={cancel:!0},!1;if(H.redirect){let K,X,R,S;H.redirect.url?K=H.redirect.url:(X=H.redirect.from)&&(R=H.redirect.to)&&(S=z.match(X,
R))&&(S.shift(),K=R,S.concat(["","",""]).forEach((P,da)=>{K=K.replace("$"+(da+1),P||"")}));G=P=>{B.warn("webRequest: error while request redirect by script "+E.uuid,z,F,E);E.callback&&E.callback({type:"redirect",message:"error",details:{description:P,rule:F,url:z,redirect_url:K}})};K?(K=O.woHash(K),pa.isAllowed(K)?L.scriptWillRun(E.uuid,K)?(B.log("webRequest: request was redirected by script "+E.uuid,z,K,F,E),E.callback&&E.callback({type:"redirect",details:{rule:F,url:z,redirect_url:K}}),t.redirectUrl=
K):G("the redirect URL needs to be included by the scripts @include or @match tag"):G("the redirect URL is filtered by the security settings")):G("unable to determine the redirect URL")}}}})});return t},f=e=>{let r;C.RUNTIME.CHROME&&63<=C.RUNTIME.BROWSER_VERSION?r=e.initiator:C.RUNTIME.FIREFOX&&(r=e.originUrl);return r&&0!==(r+"/").indexOf(rea.extension.getURL("/"))?r:null},k=e=>{if(!f(e)){var r=[],t=e.requestHeaders||[],z,D,E={},F=new RegExp("^"+p);t=t.filter(N=>{if(N.name&&0==N.name.search(F))D=
N.name.replace(F,""),E[D.toLowerCase()]=!0,"internal"==D?y[e.requestId]=N.value:N.value&&r.push({name:D,value:Y.decodeS(N.value)}),z=!0;else return!0});if(z)return{requestHeaders:t.filter(N=>!N.name||!E[N.name.toLowerCase()]).concat(r)}}},g=e=>{if(W.late)if("main_frame"==e.type){if(T.events.reset(e.tabId,!0),0<e.tabId&&"POST"!=e.method&&"auto"==w.values.scriptUrlDetection&&Ia.isScriptUrl(e.url))return L.installFromUrl(e.url,{},{silent_fail:!0}).fail(r=>{B.info("webRequest: user script detected @ "+
e.url+" was invalid",r?r.messages:"");rea.tabs.update(e.tabId,{url:e.url+"#bypass=true"},()=>{})}).done(()=>{C.RUNTIME.EDGE&&rea.tabs.query({windowType:"normal"},r=>{r.forEach(t=>{t.id===e.tabId&&rea.tabs.update(t.id,{url:t.url},()=>{})})})}),C.RUNTIME.EDGE?{cancel:!0}:{redirectUrl:"javascript:history.back()"}}else{let r,t;if((r=T.get.requests(e.tabId,e.frameId))&&(t=d(e,r)))return t}else W.registerLateCallback(()=>{g(e)})},h=(e,r)=>{if(W.late){var t=e.responseHeaders||[];if("xmlhttprequest"==e.type){let R;
if(y[e.requestId]){C.XMLHTTPREQUEST.COOKIE_PASSTHROUGH||t.forEach(S=>{S.name&&S.value&&S.name.toLowerCase().includes("set-cookie")&&(t.push({name:"tm-setcookie"+rea.runtime.short_id.toLowerCase(),value:S.value}),R=!0)});if(r=m[e.requestId])t.push({name:"tm-finalurl"+rea.runtime.short_id.toLowerCase(),value:r}),R=!0;if(R)return{responseHeaders:t};return}if(C.RUNTIME.FIREFOX&&-1===e.parentFrameId&&-1===e.tabId&&t.some(S=>S.name&&S.value&&"content-type"===S.name.toLowerCase()&&-1!=S.value.toLowerCase().indexOf("text/html")))B.log("webRequest: service worker cache request detected",
e);else return}var z,D,E,F=C.OPTIONS.HAS_CSP&&"remove"==w.values.webrequest_fixCSP,N=F||C.OPTIONS.HAS_CSP&&"yes"==w.values.webrequest_fixCSP,G=N&&C.RUNTIME.CHROME&&60<=C.RUNTIME.BROWSER_VERSION;t.some(R=>{if(R.name)return R=R.name.toLowerCase(),z|="location"==R,N&&(D|=n.includes(R)),G&&(E|="feature-policy"==R),z});if(!z){var H="xmlhttprequest"==e.type?qa.get(e.frameId,e.url).runners.length:T.events.response(e.tabId,e.frameId,e.url);H&&(D||E)&&t.forEach((R,S)=>{if(R.name&&R.value){var P=R.name.toLowerCase();
if(n.includes(P)){let da;if(F)X=!0,t[S]={name:R.name,value:void 0};else if(da=a(R.value,e))X=!0,C.RUNTIME.FIREFOX?(t[S]={name:R.name,value:void 0},R.name!==n[1]&&t.push({name:n[1],value:da})):t[S]={name:R.name,value:da}}"feature-policy"==P&&(P=b(R.value,e))&&(X=!0,t[S]={name:R.name,value:P})}});var J;if(C.RUNTIME.FAST_EXEC_SUPPORT&&["instant"].includes(w.values.runtime_inject_mode)&&(!C.RUNTIME.FIREFOX||"firefox-default"===e.cookieStoreId)&&(J=T.events.run(e.tabId,e.frameId,null,e.url))){var K=O.parse(e.url);
K=K.pathname+K.search;K="TM_"+rea.runtime.short_id+Y.Base64.encode(K.length+K).substr(0,255).replace(/[#=\/]/g,"_")+Date.now();J=qa.answer(J,e.url);J=JSON.stringify(J);J=new Blob([J],{type:"binary/octet-stream"});J=URL.createObjectURL(J);T.set.objurl(e.tabId,e.frameId,J);t.push({name:"set-cookie",value:K+"="+window.encodeURIComponent(J)+"; max-age=15;"});var X=!0}if(H&&!r&&rea.webRequest.filterResponseData&&C.OPTIONS.HAS_CSP&&["yes","remove"].includes(w.values.webrequest_fixCSP)&&"yes"==w.values.webrequest_fixContentCSP&&
["main_frame","sub_frame"].includes(e.type)){let R;t.some(S=>{if(S.name&&S.value&&"content-type"==S.name.toLowerCase()&&"text/html"==S.value.split(";")[0].toLowerCase().trim())return R=!0});if(R){let S=rea.webRequest.filterResponseData(e.requestId);S.ondata=P=>{var da=(new TextDecoder("x-user-defined")).decode(P.data,{stream:!0});const ja=new RegExp('(<head>[\\s\\S]*)(<meta[^>]+http-equiv="(?:'+n.join("|")+')"[^>]*>)([\\s\\S]*?<\\/head>)',"i");let ra;da=da.replace(ja,(ib,ab,bb,cb)=>ab+bb.replace(/(content=")([^">]+)(")/,
(Va,db,Wa,eb)=>{if(Va=a(Wa||"",e))ra=!0;return db+(Va||Wa)+eb})+cb);ra?S.write(Y.str2arrbuf(da)):S.write(P.data);S.disconnect();S=null};S.onstop=()=>{S&&S.disconnect()}}}if(X)return C.RUNTIME.FIREFOX&&(t=t.filter(R=>"cache-control"!=R.name.toLowerCase()),t.push({name:"cache-control",value:"no-cache, no-store, must-revalidate"})),t=t.filter(R=>void 0!==R.value),{responseHeaders:t}}}else W.registerLateCallback(()=>{h(e,!0)})},v=e=>{m[e.requestId]=e.redirectUrl;y[e.requestId]&&c.forEach(r=>r({url:e.redirectUrl}))},
q=e=>{W.late?"xmlhttprequest"==e.type?(delete y[e.requestId],delete m[e.requestId]):e.fromCache&&T.events.response(e.tabId,e.frameId,e.url):W.registerLateCallback(()=>{q(e)})},u=e=>{"xmlhttprequest"==e.type?(delete y[e.requestId],delete m[e.requestId]):T.events.reset(e.tabId,!0)};return{getPrefix:function(){return p},init:function(e){try{let r;r=C.RUNTIME.EDGE?["http://*/*","https://*/*"]:["http://*/*","https://*/*","ftp://*/*","file:///*"].concat(C.RUNTIME.WEBREQUEST_WEBSOCKET?["ws://*/*","wss://*/*"]:
[]);e?(rea.webRequest.onBeforeRequest.addListener(g,{urls:r,types:["main_frame","sub_frame","script","xmlhttprequest"].concat(C.RUNTIME.WEBREQUEST_WEBSOCKET?["websocket"]:[])},["blocking"]),rea.webRequest.onHeadersReceived.addListener(h,{urls:r,types:["main_frame","sub_frame","xmlhttprequest"]},["blocking","responseHeaders"].concat(x?["extraHeaders"]:[])),C.RUNTIME.WEBREQUEST_XHR_SUPPORT&&rea.webRequest.onBeforeRedirect.addListener(v,{urls:r,types:["xmlhttprequest"]},[]),rea.webRequest.onResponseStarted.addListener(q,
{urls:r,types:["main_frame","sub_frame","xmlhttprequest"]},[]),rea.webRequest.onErrorOccurred.addListener(u,{urls:r,types:["main_frame","xmlhttprequest"]})):C.RUNTIME.WEBREQUEST_XHR_SUPPORT&&"no"!=w.values.webrequest_modHeaders&&rea.webRequest.onBeforeSendHeaders.addListener(k,{urls:r,types:["xmlhttprequest"]},["blocking","requestHeaders"].concat(x?["extraHeaders"]:[]));rea.webRequest.handlerBehaviorChanged()}catch(r){B.warn("webRequest: error initializings",r.message)}},addRedirectListener:e=>c.push(e),
scripts:{set:function(e,r,t,z,D){const E=[];z.forEach(F=>{const N="string"===typeof F.selector?{include:[F.selector]}:F.selector;["include","match","exclude"].forEach(H=>{"string"===typeof F.selector[H]&&(F.selector[H]=[F.selector[H]])});let G=F.action;if("string"===typeof G){const H=G;G={};G[H]=!0}"string"===typeof F.action.redirect&&(F.action.redirect={url:F.action.redirect});E.push({selector:N,action:G})});T.set.requests(e,r,t,{id:t+"@"+e+":"+r+"#"+Date.now(),rules:E,uuid:t,callback:D})}}}})(),
W={late:!1,callbacks:[],init:function(){},registerLateCallback:function(m){B.debug("toea: register callback");W.callbacks.push(m)},ensureLate:function(m){W.late?m():W.registerLateCallback(m)},setReady:function(){B.debug("toea: run "+W.callbacks.length+" callbacks");W.late=!0;for(let m=0;m<W.callbacks.length;m++)W.callbacks[m]();W.callbacks=[]}},fb=(()=>{let m=!1,y=null;const p=()=>{m||(B.debug("Unloader.onbeforeunload()"),y&&y(),m=!0)};return{init:function(n){y=n;window.addEventListener("beforeunload",
p,!1)}}})(),Ca=(()=>{let m=null;var y=rea.extension.manifest.version,p=null,n=!1,x=!1;const c=()=>{if(W.late){var h="version="+y+"&ext="+rea.runtime.short_id+"&updated=true";if(n){var v="https://www.tampermonkey.net/installed.php?"+h;x=!0}else h+="&old="+p,v="https://www.tampermonkey.net/changelog.php?"+h;"off"!=w.values.notification_showUpdate&&("notification"==w.values.notification_showUpdate?oa.showUpdate(l.getMessage("Updated_to__0version0",y),l.getMessage("Click_here_to_see_the_recent_changes"),
ia.images.brand("tampermonkey"),q=>{q.clicked&&rea.tabs.create({url:v},()=>{})}):"changelog"==w.values.notification_showUpdate&&(x||(v+="&intr=true"),x=!0,rea.tabs.create({url:v,active:x},()=>{})))}else W.registerLateCallback(c)},a=()=>{let h=null,v;const q=A(),u=()=>{v&&(v=null,q.resolve(!!h))};v=window.setTimeout(u,300);rea.idle.queryState(C.MISC.IDLE_TIMEOUT,e=>{h="active"==e;u()});return q.promise()},b=(()=>{const h=A(),v=()=>{var q=Date.now(),u=I.getValue(C.CONSTANTS.STORAGE.LAST_START,0);q=
Math.round((q-u)/1E3);u=q<=C.MISC.DISTURBANCE_ALLOWED;B.log("upd: restart?",u,"(",q,"seconds ago)");h.resolve(u)};W.late?v():W.registerLateCallback(v);return h.promise()})(),d=()=>{let h=!1,v=!1;a().then(q=>{v=q;return b}).then(q=>{h=q}).always(()=>{x=!v||h;c();k=!0})};let f=null;var k=!1;const g={scheduleNotification:function(h,v){k||(p=h,n|=v,f&&window.clearTimeout(f),f=window.setTimeout(d,1E3))},updateAvailable:function(){return m},onInstalled:function(){g.scheduleNotification(null,!0)},onUpdated:function(h){g.scheduleNotification(h,
!1)},onUpdateAvailable:h=>{B.info("An update to version",h.version,"is available");m=h.version;window.setTimeout(()=>{oa.show(l.getMessage("Update"),l.getMessage("0name0_0version0_is_available__Please_re_start_your_browser_to_update_",rea.extension.manifest.name,h.version),ia.images.brand("tampermonkey"),{timeout:6E4})},864E5)}};(()=>{W.registerLateCallback(()=>{I.setValue(C.CONSTANTS.STORAGE.LAST_START,Date.now())})})();return g})(),gb=m=>{(()=>{const y=A();"activate"==m?(rea.browserAction.openPopup(),
y.resolve()):"toggle-enable"==m?(w.values.enabled=!w.values.enabled,y.resolve()):rea.tabs.getSelected(null,p=>{let n;"open-dashboard"==m?n=rea.extension.getURL("options.html")+"#nav=dashboard":"open-dashboard-with-running-scripts"==m?n=rea.extension.getURL("options.html")+"#nav=dashboard&filter="+encodeURIComponent(p.url):"open-new-script"==m&&(n=rea.extension.getURL("options.html")+"#url="+Y.Base64.encode(p.url)+"&nav=new-user-script");y.resolve(n?{url:n,active:!0,parent:p}:null)});return y.promise()})().then(y=>
{y&&rea.tabs.create(y)})},Ua=(()=>{const m={};let y;const p=({tabId:n,frameId:x,url:c})=>{m[n].forEach(a=>{a({tabId:n,frameId:x,url:c})})};return{addListener:(n,x)=>{m[n]=m[n]||[];m[n].push(x);!y&&Object.keys(m).length&&(rea.webNavigation.supported&&rea.webNavigation.onUrlUpdated&&rea.webNavigation.onUrlUpdated.addListener(p),y=!0)},removeListener:(n,x)=>{let c;const a=m[n];a&&-1<(c=a.indexOf(x))&&a.splice(c,1);0===a.length&&delete m[n]},removeListeners:n=>{delete m[n]}}})(),Oa=(()=>{const m=[],y=
(a,b,d)=>{if(W.late){var f=d.pendingUrl||d.url;"auto"==w.values.scriptUrlDetection&&Ia.isScriptUrl(f)&&L.installFromUrl(f,{},{silent_fail:!0});f?"loading"==b.status?T.events.loading(d.id,0,f):"complete"==b.status&&T.events.complete(d.id,0,f):B.warn("tabUpdates: no tab url set! ",d);m.forEach(k=>{k({reason:"updated",status:b.status},d)})}else window.setTimeout(()=>{y(a,b,d)},100)},p=(a,b)=>{Ba[a]&&(Ba[a].onClose(),delete Ba[a]);T.events.remove(a);m.forEach(d=>{d({reason:"removed"},{id:a})})},n=(a,
b)=>{p(b,{});ka.setIcon(a);ka.setBadge(a);m.forEach(d=>{d({reason:"replaced"},a)})},x=a=>{W.late?(T.events.commited(a.tabId,a.frameId,a.url),0===a.frameId&&m.forEach(b=>{b({reason:"commited"},{url:a.url,id:a.tabId})})):window.setTimeout(()=>{x(a)},100)},c={init:function(){rea.tabs.onUpdated.addListener(y);rea.tabs.onRemoved.addListener(p);rea.tabs.onReplaced.addListener(n);rea.webNavigation.supported&&rea.webNavigation.onCommitted.addListener(x)},openAndWatch:function(a,b){let d=null;const f=(k,g)=>
{null!==d&&g.id===d&&(["updated","commited"].includes(k.reason)?b(g):"removed"==k.reason&&(c.removeListener(f),b()))};rea.tabs.create(a,k=>{d=k.id;b(k)});c.addListener(f);return{cancel:function(){c.removeListener(f);null!==d&&rea.tabs.remove(d,()=>{const k=rea.runtime.lastError;k?B.warn("tab.close",k.message):d=null})}}},addListener:function(a){m.push(a)},removeListener:function(a){let b;m&&-1<(b=m.indexOf(a))&&m.splice(b,1)}};return c})(),Ta=()=>{const m="temporary"==w.values.incognito_mode&&rea.extension.inIncognitoContext;
I.setTemporary(m);m&&(w.values.sync_enabled=!1,w.values.scriptUpdateCheckPeriod=0,w.values.sync_type=0,w.values.statistics_enabled=!1)},hb=()=>{B.set(w.values.logLevel);l.setLocale(w.values.i18n);var m=C.RUNTIME.WEBREQUEST_XHR_SUPPORT&&"no"!=w.values.webrequest_modHeaders;ma=Registry.get("xmlhttprequest");ma.setConfig({prefix:m?ua.getPrefix():null,mozAnon:C.RUNTIME.FIREFOX});wa.init();ea.init("bg",rea.extension.manifest.version,w.values.statistics_enabled,!0);T.listeners.add.onReset((y,p)=>{za.clearByTabId(y);
Q.removeStorageListeners({tabid:y},!1);p||ka.setIcon(y)});m=y=>{0<=y&&rea.tabs.get(y,p=>{!rea.runtime.lastError&&p&&(ka.setIcon(y),ka.setBadge(y))})};T.listeners.add.onCommited(m);T.listeners.add.onCompleted(m);T.listeners.add.onReset(Ea.purgeAppeals);T.listeners.add.onRemoved(Ea.purgeAppeals);T.listeners.add.onRemoved(Ha.cleanTab);ca.init().done(y=>{y&&ca.sync()});pa.init();Z.init();Q.init();m=()=>{aa.set_mode(w.values.downloads_mode);aa.set_whitelist(w.values.downloads_extension_whitelist)};m();
aa.config_changed_listener=m;La.init();ua.init();Da.init();ya.init();xa.init()},ma,Fa,U,V,Na;init=()=>{l.init();W.init();ua.init(!0);Oa.init();Ra.init();rea.commands.supported&&rea.commands.onCommand.addListener(gb);rea.runtime.setUninstallURL(`https://www.tampermonkey.net/uninstall.php?ext=${rea.runtime.short_id}`);fb.init(()=>{ca.finalize()});Fa=Registry.get("compat",C);U=Registry.get("parser");U.init(Fa);V=Registry.get("syncinfo",Oa);Na=Registry.get("test");rea.browserAction.setIcon({path:rea.extension.getURL("images/icon_grey.png")});
rea.browserAction.setPopup({popup:"action.html"});rea.browserAction.setTitle({title:"Tampermonkey"});rea.runtime.onUpdateAvailable.addListener(Ca.onUpdateAvailable);rea.runtime.onInstalled.addListener(m=>{B.log("bg: onInstalled",m);m||(m={reason:"mandatory_argument_is_not_set"});if("install"==m.reason)Ka.onInstalled();else if("update"==m.reason)Ka.onUpdated(m.previousVersion);W.ensureLate(()=>{if("chrome_update"==m.reason)ea.tB({updated:!0});else if("install"==m.reason)Ca.onInstalled();else if("update"==
m.reason)Ca.onUpdated(m.previousVersion)})});I.init().then(Xa).then(Ka.init).then(w.init).then(()=>{cfgo=w;Ta();hb();Ya();ka.init();window.setTimeout(xa.check,1E4);Ka.check().then(()=>{B.log("Listeners registered!");window.setTimeout(W.setReady,1)})})};init()}});
